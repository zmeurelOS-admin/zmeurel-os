This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
0
11.10.0
BACKUP-INSTRUCTIONS.md
components.json
eslint.config.mjs
GIT-BACKUP-SCRIPT.bat
id
next.config.ts
npm
package.json
parseInt(id!.substring(3)))
postcss.config.mjs
PROGRES.md
PROGRESS.md
public/file.svg
public/globe.svg
public/next.svg
public/vercel.svg
public/window.svg
r.id_culegator)
README.md
scripts/check-env.js
src/app/(auth)/login/page.tsx
src/app/(auth)/reset-password/page.tsx
src/app/(dashboard)/activitati-agricole/ActivitatiAgricolePageClient.tsx
src/app/(dashboard)/activitati-agricole/page.tsx
src/app/(dashboard)/cheltuieli/CheltuialaPageClient.tsx
src/app/(dashboard)/cheltuieli/page.tsx
src/app/(dashboard)/clienti/ClientPageClient.tsx
src/app/(dashboard)/clienti/page.tsx
src/app/(dashboard)/culegatori/CulegatorPageClient.tsx
src/app/(dashboard)/culegatori/page.tsx
src/app/(dashboard)/dashboard/page.tsx
src/app/(dashboard)/investitii/InvestitiiPageClient.tsx
src/app/(dashboard)/investitii/page.tsx
src/app/(dashboard)/layout.tsx
src/app/(dashboard)/parcele/page.tsx
src/app/(dashboard)/parcele/ParcelaPageClient.tsx
src/app/(dashboard)/recoltari/page.tsx
src/app/(dashboard)/recoltari/RecoltariPageClient.tsx
src/app/(dashboard)/vanzari-butasi/page.tsx
src/app/(dashboard)/vanzari-butasi/VanzariButasiPageClient.tsx
src/app/(dashboard)/vanzari/page.tsx
src/app/(dashboard)/vanzari/VanzariPageClient.tsx
src/app/auth/callback/route.ts
src/app/callback/route.ts
src/app/globals.css
src/app/layout.tsx
src/app/login/page
src/app/page.tsx
src/app/providers.tsx
src/components/activitati-agricole/ActivitateAgricolaCard.tsx
src/components/activitati-agricole/AddActivitateAgricolaDialog.tsx
src/components/activitati-agricole/EditActivitateAgricolaDialog.tsx
src/components/cheltuieli/AddCheltuialaDialog.tsx
src/components/cheltuieli/CheltuialaCard.tsx
src/components/cheltuieli/EditCheltuialaDialog.tsx
src/components/clienti/AddClientDialog.tsx
src/components/clienti/ClientCard.tsx
src/components/clienti/EditClientDialog.tsx
src/components/culegatori/AddCulegatorDialog.tsx
src/components/culegatori/CulegatorCard.tsx
src/components/culegatori/EditCulegatorDialog.tsx
src/components/dashboard/DashboardHome.tsx
src/components/investitii/AddInvestitieDialog.tsx
src/components/investitii/EditInvestitieDialog.tsx
src/components/investitii/InvestitieCard.tsx
src/components/layout/Sidebar.tsx
src/components/LogoutButton.tsx
src/components/Navbar.tsx
src/components/parcele/AddParcelaDialog.tsx
src/components/parcele/DeleteConfirmDialog.tsx
src/components/parcele/EditParcelaDialog.tsx
src/components/parcele/ParcelaCard.tsx
src/components/recoltari/AddRecoltareDialog.tsx
src/components/recoltari/EditRecoltareDialog.tsx
src/components/recoltari/RecoltareCard.tsx
src/components/Toaster.tsx
src/components/ui/alert-dialog.tsx
src/components/ui/badge.tsx
src/components/ui/button.tsx
src/components/ui/card.tsx
src/components/ui/dialog.tsx
src/components/ui/form.tsx
src/components/ui/input.tsx
src/components/ui/label.tsx
src/components/ui/select.tsx
src/components/ui/sonner.tsx
src/components/ui/table.tsx
src/components/ui/textarea.tsx
src/components/Untitled
src/components/vanzari-butasi/AddVanzareButasiDialog.tsx
src/components/vanzari-butasi/EditVanzareButasiDialog.tsx
src/components/vanzari-butasi/VanzareButasiCard.tsx
src/components/vanzari/AddVanzareDialog.tsx
src/components/vanzari/EditVanzareDialog.tsx
src/components/vanzari/VanzareCard.tsx
src/lib/debug/rls-check.ts
src/lib/supabase/client.ts
src/lib/supabase/queries/activitati-agricole.ts
src/lib/supabase/queries/cheltuieli.ts
src/lib/supabase/queries/clienti.ts
src/lib/supabase/queries/culegatori.ts
src/lib/supabase/queries/investitii.ts
src/lib/supabase/queries/parcele.ts
src/lib/supabase/queries/recoltari.ts
src/lib/supabase/queries/vanzari-butasi.ts
src/lib/supabase/queries/vanzari.ts
src/lib/supabase/server.ts
src/lib/utils.ts
src/middleware.ts
src/types/supabase.ts
tatus
tsconfig.json
type
types/database.types.ts
vercel
ZMEUREL_CLEAN_EXPORT.zip
zmeurel@0.1.0
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="0">

</file>

<file path="id">

</file>

<file path="parseInt(id!.substring(3)))">

</file>

<file path="r.id_culegator)">

</file>

<file path="11.10.0">
Unknown command: "notice"

To see a list of supported npm commands, run:
  npm help
</file>

<file path="BACKUP-INSTRUCTIONS.md">
# ğŸ’¾ BACKUP ZMEUREL OS - InstrucÈ›iuni Complete

**Data:** 12 Februarie 2026  
**Status proiect:** Modul Parcele 100% funcÈ›ional  

---

## ğŸ“‚ FIÈ˜IERE CRITICE (DE SALVAT OBLIGATORIU)

### **1. Environment Variables**
```
.env.local
```
**âš ï¸ ATENÈšIE:** ConÈ›ine credenÈ›iale Supabase - NU pune pe GitHub public!

---

### **2. Supabase Configuration**
```
lib/supabase/
â”œâ”€â”€ client.ts        â† Browser client (@supabase/ssr)
â”œâ”€â”€ server.ts        â† Server client (@supabase/ssr)
â””â”€â”€ queries/
    â””â”€â”€ parcele.ts   â† CRUD operations cu debugging
```

---

### **3. Modul Parcele (100% funcÈ›ional)**
```
app/(dashboard)/
â”œâ”€â”€ layout.tsx           â† Dashboard layout cu Providers
â”œâ”€â”€ providers.tsx        â† QueryClient + Toaster setup
â””â”€â”€ parcele/
    â”œâ”€â”€ page.tsx         â† Server component, data fetching
    â””â”€â”€ ParcelaPageClient.tsx  â† Client component, UI logic

components/parcele/
â”œâ”€â”€ ParcelaCard.tsx      â† Display card cu metrici
â”œâ”€â”€ AddParcelaDialog.tsx â† Create dialog
â”œâ”€â”€ EditParcelaDialog.tsx â† Update dialog
â””â”€â”€ DeleteConfirmDialog.tsx â† Delete confirmation
```

---

### **4. UI Components (shadcn/ui customizate)**
```
components/ui/
â”œâ”€â”€ dialog.tsx           â† FIX inline styles pentru backdrop
â”œâ”€â”€ alert-dialog.tsx     â† FIX inline styles
â”œâ”€â”€ select.tsx           â† FIX background white
â”œâ”€â”€ button.tsx
â”œâ”€â”€ card.tsx
â”œâ”€â”€ input.tsx
â”œâ”€â”€ textarea.tsx         â† NEW pentru ObservaÈ›ii
â”œâ”€â”€ form.tsx             â† NEW pentru React Hook Form
â”œâ”€â”€ label.tsx            â† NEW pentru form labels
â””â”€â”€ badge.tsx            â† Pentru status (Activ/Inactiv)
```

---

### **5. Configuration Files**
```
package.json             â† DependinÈ›e (IMPORTANT!)
tsconfig.json
next.config.js
tailwind.config.ts
.gitignore
```

---

### **6. DocumentaÈ›ie**
```
PROGRES.md              â† Acest fiÈ™ier (tracking progres)
README.md               â† InstrucÈ›iuni quick start
```

---

## ğŸ—„ï¸ DATABASE BACKUP (Supabase)

### **Schema SQL de salvat:**

**Tabele:**
- tenants
- nomenclatoare
- parcele
- culegatori, recoltari, clienti, vanzari, vanzari_butasi
- investitii, activitati_agricole, cheltuieli_diverse

### **Cum sÄƒ faci backup SQL din Supabase:**

1. Mergi la https://supabase.com/dashboard
2. SelecteazÄƒ project **zmeurel-os**
3. **Database** â†’ **Backups** (sidebar)
4. Click **Download backup** (cel mai recent)

**SAU** export manual cu SQL:

```sql
-- Export nomenclatoare (soiuri importante!)
COPY (SELECT * FROM nomenclatoare WHERE tip = 'Soi') 
TO '/tmp/nomenclatoare_soiuri.csv' 
WITH CSV HEADER;

-- Export parcele
COPY (SELECT * FROM parcele) 
TO '/tmp/parcele_backup.csv' 
WITH CSV HEADER;
```

**SalveazÄƒ:**
- `nomenclatoare_soiuri.csv` - Soiurile (Polka, Tulameen, etc.)
- `parcele_backup.csv` - Toate parcelele

---

## ğŸ’» GIT BACKUP (GitHub)

### **PASUL 1: VerificÄƒ status**

```bash
cd C:\Users\Andrei\Desktop\zmeurel

git status
```

**Ar trebui sÄƒ vezi fiÈ™ierele modificate:**
- `lib/supabase/client.ts` (NEW)
- `lib/supabase/server.ts` (NEW)
- `lib/supabase/queries/parcele.ts` (MODIFIED)
- `app/(dashboard)/layout.tsx` (NEW)
- `app/(dashboard)/providers.tsx` (NEW)
- `components/ui/dialog.tsx` (MODIFIED)
- `components/parcele/AddParcelaDialog.tsx` (MODIFIED)
- etc.

---

### **PASUL 2: AdaugÄƒ toate fiÈ™ierele**

```bash
git add .
```

**âš ï¸ VerificÄƒ .gitignore exclude .env.local:**

```bash
# .gitignore ar trebui sÄƒ conÈ›inÄƒ:
.env.local
.env*.local
node_modules/
.next/
```

---

### **PASUL 3: Commit cu mesaj descriptiv**

```bash
git commit -m "âœ… Modul Parcele 100% funcÈ›ional - Sesiunea 12 Feb 2026

FEATURES:
- CRUD complet parcele (Create, Read, Update, Delete)
- Auto-generated IDs (P001, P002...)
- Dropdown soiuri funcÈ›ional (5 soiuri)
- Calcule automate (densitate, vÃ¢rstÄƒ plantaÈ›ie)
- Delete confirmation dialog

FIXES:
- Supabase connection cu @supabase/ssr (Next.js 15 compatible)
- Dialog backdrop cu inline styles (Tailwind v4 alpha fix)
- Dropdown native select (Radix UI workaround)
- Hydration errors (eliminat toLocaleString)
- QueryClient Provider setup
- Import paths Ã®n queries/parcele.ts

TECH STACK:
- Next.js 16.1.6 (Turbopack)
- Supabase (@supabase/ssr)
- React Query (TanStack Query v5)
- shadcn/ui + Tailwind CSS v4 alpha
- TypeScript + Zod validation

STATUS: ~40% MVP complet"
```

---

### **PASUL 4: Push la GitHub**

```bash
git push origin main
```

**DacÄƒ e prima oarÄƒ sau branch nou:**

```bash
git branch -M main
git remote add origin https://github.com/zmeurelOS-admin/zmeurel-os.git
git push -u origin main
```

---

### **PASUL 5: VerificÄƒ pe GitHub**

Mergi la: https://github.com/zmeurelOS-admin/zmeurel-os

**Ar trebui sÄƒ vezi:**
- Commit-ul nou cu mesajul
- Toate fiÈ™ierele actualizate
- **NU** ar trebui sÄƒ vezi `.env.local` (exclus prin .gitignore)

---

## ğŸ“¦ BACKUP LOCAL (ZIP arhivÄƒ)

### **Windows File Explorer:**

1. Deschide `C:\Users\Andrei\Desktop`
2. Click dreapta pe folder `zmeurel`
3. **Send to** â†’ **Compressed (zipped) folder**
4. RedenumeÈ™te: `zmeurel-backup-12feb2026.zip`
5. CopiazÄƒ pe USB / Google Drive / OneDrive

**SAU Command Prompt:**

```bash
cd C:\Users\Andrei\Desktop

# ArhiveazÄƒ cu WinRAR (dacÄƒ e instalat):
"C:\Program Files\WinRAR\WinRAR.exe" a -r zmeurel-backup-12feb2026.rar zmeurel

# SAU arhiveazÄƒ cu 7-Zip (dacÄƒ e instalat):
"C:\Program Files\7-Zip\7z.exe" a -tzip zmeurel-backup-12feb2026.zip zmeurel
```

---

## â˜ï¸ CLOUD BACKUP (Google Drive / OneDrive)

### **Google Drive:**

1. Mergi la https://drive.google.com
2. **New** â†’ **Folder upload**
3. SelecteazÄƒ `C:\Users\Andrei\Desktop\zmeurel`
4. **Upload**

**Folder structure Ã®n Drive:**
```
Zmeurel OS Backups/
â””â”€â”€ 2026-02-12-modul-parcele-complete/
    â”œâ”€â”€ zmeurel/ (tot proiectul)
    â””â”€â”€ PROGRES.md
```

---

### **OneDrive:**

DacÄƒ ai OneDrive sync:

1. CopiazÄƒ folder `zmeurel` Ã®n `C:\Users\Andrei\OneDrive\`
2. AÈ™teaptÄƒ sync automat
3. VerificÄƒ pe https://onedrive.live.com

---

## ğŸ” BACKUP CREDENÈšIALE (SECURIZAT!)

### **Supabase Credentials:**

**âš ï¸ NU pune pe GitHub public!**

**SalveazÄƒ Ã®ntr-un fiÈ™ier SECURIZAT (Password Manager sau fisier local criptat):**

```
ZMEUREL OS - Supabase Credentials
==================================

Project URL: https://ilybohhdeplwcrbpblqw.supabase.co
Anon/Public Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

Database Password: [password_aici]

Email login: popa.andrei.sv@gmail.com
Tenant ID: b68a19a7-c5fc-4f30-94a2-b3c17af68f76
```

**OpÈ›iuni salvare securizatÄƒ:**
1. **LastPass / 1Password / Bitwarden** (Password Manager)
2. **VeraCrypt** encrypted volume
3. **Windows Credential Manager** (Control Panel â†’ Credential Manager)
4. **Excel file** cu parolÄƒ (Save As â†’ Tools â†’ General Options â†’ Password)

---

## âœ… CHECKLIST BACKUP COMPLET

**VERIFICÄ‚:**

- [ ] Git commit cu mesaj descriptiv
- [ ] Git push la GitHub (verificat Ã®n browser)
- [ ] .env.local salvat separat (SECURIZAT)
- [ ] ZIP arhivÄƒ localÄƒ (`zmeurel-backup-12feb2026.zip`)
- [ ] Cloud backup (Google Drive / OneDrive)
- [ ] Database backup din Supabase (Download backup)
- [ ] PROGRES.md actualizat
- [ ] CredenÈ›iale salvate Ã®n Password Manager

---

## ğŸ”„ RESTORE DIN BACKUP (CÃ¢nd e nevoie)

### **Scenariul 1: Proiect È™ters accidental**

```bash
# Clone din GitHub:
git clone https://github.com/zmeurelOS-admin/zmeurel-os.git
cd zmeurel-os

# InstaleazÄƒ dependinÈ›e:
npm install

# CreeazÄƒ .env.local cu credenÈ›iale salvate (din Password Manager)
# CopiazÄƒ:
NEXT_PUBLIC_SUPABASE_URL=https://ilybohhdeplwcrbpblqw.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGci...

# RuleazÄƒ:
npm run dev
```

---

### **Scenariul 2: Database È™ters**

1. Mergi la Supabase Dashboard â†’ Database â†’ Backups
2. Click **Restore** pe backup-ul dorit
3. Confirm restore

**SAU** import manual CSV:

```sql
-- Ãn SQL Editor:
COPY nomenclatoare(id, tip, valoare, descriere)
FROM '/path/to/nomenclatoare_soiuri.csv'
WITH CSV HEADER;
```

---

### **Scenariul 3: FiÈ™ier corupt**

1. GÄƒseÈ™te commit-ul bun pe GitHub
2. Click pe fiÈ™ier â†’ **History**
3. GÄƒseÈ™te versiunea funcÈ›ionalÄƒ
4. **Copy raw contents**
5. ÃnlocuieÈ™te Ã®n proiect

**SAU** revert commit:

```bash
git log  # GÄƒseÈ™te commit ID bun
git checkout <commit-id> -- lib/supabase/client.ts
git commit -m "Revert client.ts la versiune funcÈ›ionalÄƒ"
```

---

## ğŸ“Š BACKUP SCHEDULE (Recomandare)

**DupÄƒ fiecare sesiune dezvoltare:**
- âœ… Git commit + push
- âœ… ActualizeazÄƒ PROGRES.md

**SÄƒptÄƒmÃ¢nal:**
- âœ… Database backup din Supabase
- âœ… ZIP arhivÄƒ localÄƒ

**Lunar:**
- âœ… Cloud backup complet (Google Drive)
- âœ… Test restore (verificÄƒ cÄƒ backup-ul merge)

---

## ğŸ†˜ RECOVERY ÃN CAZ DE URGENÈšÄ‚

**DacÄƒ TOTUL e pierdut (laptop furat/stricat):**

1. **GitHub** â†’ Clone proiect
2. **Password Manager** â†’ RecupereazÄƒ credenÈ›iale Supabase
3. **Supabase** â†’ Restore database din backup
4. **npm install** â†’ ReinstaleazÄƒ dependinÈ›e
5. **npm run dev** â†’ AplicaÈ›ia ar trebui sÄƒ meargÄƒ

**Timp estimat recovery:** 30 minute (dacÄƒ ai backup-urile corecte)

---

**BACKUP = LINIÈ˜TE SUFLETEASCÄ‚!** ğŸ’¾âœ…

Nu mai pierzi niciodatÄƒ munca! ğŸš€
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "iconLibrary": "lucide",
  "rtl": false,
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "registries": {}
}
</file>

<file path="eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="GIT-BACKUP-SCRIPT.bat">
# ğŸ’¾ GIT BACKUP COMPLETE - COPY-PASTE ÃN COMMAND PROMPT

# IMPORTANT: RuleazÄƒ aceste comenzi Ã®n Command Prompt (nu PowerShell!)
# Location: C:\Users\Andrei\Desktop\zmeurel

# ============================================
# PASUL 1: VerificÄƒ locaÈ›ia
# ============================================
cd C:\Users\Andrei\Desktop\zmeurel
echo "Current directory: %cd%"

# ============================================
# PASUL 2: VerificÄƒ fiÈ™iere modificate
# ============================================
git status

# Ar trebui sÄƒ vezi:
# - PROGRES.md (NEW)
# - BACKUP-INSTRUCTIONS.md (NEW)
# - README.md (NEW or MODIFIED)
# - lib/supabase/client.ts (NEW)
# - lib/supabase/server.ts (NEW)
# - lib/supabase/queries/parcele.ts (MODIFIED)
# - app/(dashboard)/layout.tsx (NEW)
# - app/(dashboard)/providers.tsx (NEW)
# - components/ui/dialog.tsx (MODIFIED)
# - components/parcele/AddParcelaDialog.tsx (MODIFIED)
# - + alte fiÈ™iere

# ============================================
# PASUL 3: AdaugÄƒ toate fiÈ™ierele
# ============================================
git add .

# VerificÄƒ ce s-a adÄƒugat:
git status

# ============================================
# PASUL 4: Commit cu mesaj descriptiv
# ============================================
git commit -m "âœ… SESIUNEA 12 FEB 2026 - Modul Parcele 100%% FuncÈ›ional + DocumentaÈ›ie CompletÄƒ

MODULES COMPLETE:
âœ… Parcele - CRUD complet (Create, Read, Update, Delete)
  - Auto-generated IDs (P001, P002, P003...)
  - Dropdown soiuri funcÈ›ional (5 soiuri: Polka, Tulameen, Heritage, Loch Ness, Chester)
  - Calcule automate: densitate plante/mÂ², vÃ¢rstÄƒ plantaÈ›ie
  - Delete confirmation dialog
  - Edit dialog cu toate cÃ¢mpurile
  - Responsive design (mobile-first)

CRITICAL FIXES:
âœ… Supabase Connection (@supabase/ssr pentru Next.js 15)
  - Migrat de la @supabase/supabase-js la @supabase/ssr
  - Browser client: createBrowserClient()
  - Server client: createServerClient() cu cookies handler
  - Fix import path: '../client' Ã®n queries/parcele.ts

âœ… Dialog Backdrop (Tailwind v4 alpha + Turbopack incompatibility)
  - Style inline pentru DialogOverlay: backgroundColor rgba(0,0,0,0.8)
  - z-index hierarchy: backdrop 50, content 60
  - Fundal negru 80%% opacitate funcÈ›ional

âœ… Dropdown Soiuri
  - Native HTML select Ã®n loc de Radix UI Select
  - SQL INSERT Ã®n nomenclatoare (5 soiuri)
  - Debugging logs Ã®n page.tsx È™i AddParcelaDialog.tsx

âœ… Delete Handler
  - State management corect: deletingParcela cu { id, name }
  - Handler function: handleConfirmDelete()
  - Mutation cu invalidateQueries

âœ… Hydration Errors
  - Eliminat toLocaleString() (server vs client mismatch)
  - Plain values Ã®n ParcelaCard.tsx

âœ… QueryClient Provider
  - Creat app/(dashboard)/providers.tsx
  - Creat app/(dashboard)/layout.tsx
  - Toaster pentru notifications (sonner)

DOCUMENTATION:
ğŸ“š PROGRES.md - Log complet dezvoltare (40+ pagini)
  - Istoric sesiuni
  - Erori rezolvate È™i soluÈ›ii
  - Lessons learned
  - Next steps

ğŸ“š BACKUP-INSTRUCTIONS.md - Ghid backup È™i recovery
  - FiÈ™iere critice de salvat
  - Git workflow
  - Database backup din Supabase
  - Cloud backup (Google Drive/OneDrive)
  - Recovery procedures

ğŸ“š README.md - Quick start È™i overview proiect
  - Installation guide
  - Project structure
  - Tech stack
  - Development workflow
  - Troubleshooting

NEW COMPONENTS:
- components/ui/textarea.tsx (pentru ObservaÈ›ii)
- components/ui/form.tsx (React Hook Form integration)
- components/ui/label.tsx (form labels)
- app/(dashboard)/providers.tsx (QueryClient + Toaster)
- app/(dashboard)/layout.tsx (Dashboard layout)

MODIFIED COMPONENTS:
- components/ui/dialog.tsx (inline styles backdrop fix)
- components/ui/alert-dialog.tsx (inline styles backdrop fix)
- components/ui/select.tsx (background white forced)
- components/parcele/AddParcelaDialog.tsx (native select + debugging)
- components/parcele/EditParcelaDialog.tsx (native select)
- components/parcele/ParcelaCard.tsx (no toLocaleString)
- app/(dashboard)/parcele/page.tsx (debugging logs soiuri)
- app/(dashboard)/parcele/ParcelaPageClient.tsx (delete handler fix)

PACKAGES INSTALLED:
- @supabase/ssr (latest)
- class-variance-authority
- @radix-ui/react-label
- @radix-ui/react-slot

DATABASE:
âœ… nomenclatoare table populated cu 5 soiuri
âœ… RLS policies active (tenant isolation)
âœ… Multi-tenant architecture funcÈ›ional

PROGRESS: 35%% â†’ 40%% MVP

NEXT SESSION: Module CRUD simple (ClienÈ›i sau CulegÄƒtori)

Tech Stack: Next.js 16.1.6 | Supabase @supabase/ssr | React Query v5 | TypeScript | Tailwind v4 alpha"

# ============================================
# PASUL 5: Push la GitHub
# ============================================
git push origin main

# DacÄƒ e prima datÄƒ (branch nou):
# git branch -M main
# git remote add origin https://github.com/zmeurelOS-admin/zmeurel-os.git
# git push -u origin main

# ============================================
# PASUL 6: VerificÄƒ pe GitHub
# ============================================
echo "âœ… BACKUP COMPLET!"
echo "VerificÄƒ pe: https://github.com/zmeurelOS-admin/zmeurel-os"
echo ""
echo "UrmÄƒtorii paÈ™i:"
echo "1. VerificÄƒ commit-ul pe GitHub"
echo "2. Download backup database din Supabase"
echo "3. CreeazÄƒ ZIP arhivÄƒ localÄƒ (optional)"
echo "4. Cloud backup Google Drive (optional)"
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
};

export default nextConfig;
</file>

<file path="npm">

</file>

<file path="postcss.config.mjs">
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;
</file>

<file path="PROGRESS.md">
# ZMEUREL OS - PROGRESS TRACKING

**Ultima actualizare:** 08 Februarie 2026, 22:00  
**Developer:** Popa Andrei  
**Assistant:** Claude (Anthropic)  
**Status MVP:** 95% COMPLET âœ…

---

## ğŸ“Š OVERVIEW PROGRES

```
MVP FEATURES:
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 95%

Navigare & Layout:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
Module CRUD (9/9):    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
Database & RLS:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
Auth & Multi-tenant:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
UI/UX Polish:         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  40%
Dashboard Analytics:  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%
Deployment:           â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%
Documentation:        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  40%
```

---

## âœ… COMPLETED FEATURES

### **CORE INFRASTRUCTURE** âœ…
- [x] Next.js 15 setup cu App Router
- [x] TypeScript configuration
- [x] Tailwind CSS v4 alpha
- [x] shadcn/ui components (11/11)
- [x] Supabase client setup (browser + SSR)
- [x] React Query state management
- [x] StructurÄƒ `src/` folder
- [x] Path alias `@/` â†’ `./src/*`

### **AUTHENTICATION & MULTI-TENANCY** âœ…
- [x] Supabase Auth integration
- [x] Email + Password login
- [x] Tenant system (tenants table)
- [x] Row Level Security policies
- [x] User session management
- [x] Protected routes

### **DATABASE SCHEMA** âœ…
- [x] 11 tabele create Ã®n Supabase
- [x] Nomenclatoare (soiuri, categorii)
- [x] RLS policies pentru toate tabelele
- [x] Foreign keys & constraints
- [x] Indexes pentru performanÈ›Äƒ
- [x] Seed data (5 soiuri zmeurÄƒ/mure)

### **NAVIGARE & LAYOUT** âœ…
- [x] Sidebar component cu 9 module
- [x] Dashboard homepage
- [x] Responsive layout
- [x] (dashboard) route group
- [x] Root layout cu Providers
- [x] Global CSS cu branding colors

### **MODULE CRUD (9/9)** âœ…

#### **1. PARCELE** âœ…
- [x] Lista parcele (grid cards)
- [x] AdÄƒugare parcelÄƒ (dialog)
- [x] Editare parcelÄƒ
- [x] È˜tergere parcelÄƒ (cu confirmare)
- [x] Filtrare dupÄƒ status
- [x] Search
- [x] Auto-generated ID (P001, P002...)
- [x] Calcule: densitate plante, vÃ¢rstÄƒ ani

#### **2. CULEGÄ‚TORI** âœ…
- [x] Lista culegÄƒtori
- [x] AdÄƒugare culegÄƒtor
- [x] Editare culegÄƒtor
- [x] È˜tergere culegÄƒtor
- [x] Filtrare Activ/Inactiv
- [x] Tarif lei/kg tracking
- [x] Auto-generated ID (C001, C002...)

#### **3. CLIENÈšI** âœ…
- [x] Lista clienÈ›i
- [x] AdÄƒugare client
- [x] Editare client
- [x] È˜tergere client
- [x] Separare: PreÈ› Special vs Standard
- [x] Search multi-field
- [x] Auto-generated ID (CL001, CL002...)
- [x] Tracking lÄƒdiÈ›e returnabile

#### **4. RECOLTÄ‚RI** âœ…
- [x] Lista recoltÄƒri
- [x] AdÄƒugare recoltare
- [x] Editare recoltare
- [x] È˜tergere recoltare
- [x] Calcul automat: kg brut, net, valoare muncÄƒ
- [x] Filtrare dupÄƒ datÄƒ, culegÄƒtor, parcelÄƒ
- [x] Auto-generated ID (R001, R002...)

#### **5. VÃ‚NZÄ‚RI** âœ…
- [x] Lista vÃ¢nzÄƒri
- [x] AdÄƒugare vÃ¢nzare
- [x] Editare vÃ¢nzare
- [x] È˜tergere vÃ¢nzare
- [x] Calcul valoare totalÄƒ
- [x] Status platÄƒ (PlÄƒtit/RestanÈ›Äƒ/Avans)
- [x] Auto-generated ID (V001, V002...)

#### **6. VÃ‚NZÄ‚RI BUTAÈ˜I** âœ…
- [x] Lista vÃ¢nzÄƒri butaÈ™i
- [x] AdÄƒugare vÃ¢nzare butaÈ™i
- [x] Editare vÃ¢nzare butaÈ™i
- [x] È˜tergere vÃ¢nzare butaÈ™i
- [x] Tracking soi + parcelÄƒ sursÄƒ
- [x] Auto-generated ID (VB001, VB002...)

#### **7. ACTIVITÄ‚ÈšI AGRICOLE** âœ…
- [x] Lista activitÄƒÈ›i
- [x] AdÄƒugare activitate
- [x] Editare activitate
- [x] È˜tergere activitate
- [x] Calcul automat: data recoltare permisÄƒ
- [x] Status pauzÄƒ pesticide (OK/PauzÄƒ)
- [x] Auto-generated ID (AA001, AA002...)
- [x] Tipuri: Fungicid, Insecticid, Erbicid, etc.

#### **8. INVESTIÈšII** âœ…
- [x] Lista investiÈ›ii
- [x] AdÄƒugare investiÈ›ie
- [x] Editare investiÈ›ie
- [x] È˜tergere investiÈ›ie
- [x] Categorii: ButaÈ™i, Spalieri, IrigaÈ›ie, etc.
- [x] Badge-uri colorate per categorie
- [x] Auto-generated ID (I001, I002...)
- [x] Upload facturÄƒ (placeholder)

#### **9. CHELTUIELI DIVERSE** âœ…
- [x] Lista cheltuieli
- [x] AdÄƒugare cheltuialÄƒ
- [x] Editare cheltuialÄƒ
- [x] È˜tergere cheltuialÄƒ
- [x] Categorii: Electricitate, MotorinÄƒ, etc.
- [x] Auto-generated ID (CH001, CH002...)

---

## ğŸ”§ FIXES & OPTIMIZATIONS

### **CRITICAL BUGS FIXED** âœ…
- [x] **generateNextId bug** - sortare cronologicÄƒ vs alfabeticÄƒ (9 module)
- [x] **Path resolution** - tsconfig.json `@/*` mapping
- [x] **Supabase SSR** - createServerClient cu cookies async
- [x] **Name conflicts** - createClient â†’ createNewClient
- [x] **Missing exports** - STATUS_PLATA, TIPURI_ACTIVITATI, etc.
- [x] **Cache issues** - Turbopack .next/ blocking
- [x] **Duplicate folders** - app/ vs src/app/

### **PERFORMANCE OPTIMIZATIONS** âœ…
- [x] React Query caching
- [x] Supabase RLS pentru security
- [x] Index-uri database
- [x] Component lazy loading (implicit Next.js)

---

## ğŸš§ IN PROGRESS / TODO

### **UI/UX IMPROVEMENTS** ğŸ”„
- [ ] Branding complet (#F16B6B + #312E3F)
- [ ] Cards polished (shadows, hover effects)
- [ ] Badge-uri colorate consistente
- [ ] Empty states custom
- [ ] Loading skeletons
- [ ] Page transitions
- [ ] Toast notifications polished
- [ ] Mobile refinements

### **DASHBOARD ANALYTICS** ğŸ“Š
- [ ] KPI Cards:
  - [ ] Venituri Totale
  - [ ] Cheltuieli Totale
  - [ ] Profit Net + MarjÄƒ %
  - [ ] Recoltare AstÄƒzi
- [ ] Grafice Recharts:
  - [ ] ProducÈ›ie ZilnicÄƒ (line chart)
  - [ ] DistribuÈ›ie Cheltuieli (pie chart)
  - [ ] Top 5 ClienÈ›i (bar chart)
- [ ] Alerte:
  - [ ] Parcele Ã®n pauzÄƒ pesticide
  - [ ] ClienÈ›i cu restanÈ›e
  - [ ] Stock produse scÄƒzut

### **FEATURES ADVANCED** ğŸ¯
- [ ] Export PDF rapoarte
- [ ] Export CSV date
- [ ] Upload facturi (Supabase Storage)
- [ ] Fotografii tratamente
- [ ] Date range picker
- [ ] Multi-select filters
- [ ] Bulk operations
- [ ] Print receipts

### **DEPLOYMENT & DEVOPS** ğŸš€
- [ ] Connect zmeurel.ro la Vercel
- [ ] Environment variables setup
- [ ] Production deployment
- [ ] Custom domain DNS
- [ ] SSL certificate
- [ ] Error monitoring (Sentry)
- [ ] Analytics (Vercel Analytics)

### **DOCUMENTATION** ğŸ“
- [ ] README.md complet
- [ ] API documentation
- [ ] User manual (romÃ¢nÄƒ)
- [ ] Screenshots pentru portofoliu
- [ ] Video demo
- [ ] Changelog

---

## ğŸ“… TIMELINE

### **SÄ‚PTÄ‚MÃ‚NA 1 (FinalizatÄƒ)** âœ…
- [x] Setup proiect
- [x] Database schema
- [x] Auth implementation
- [x] Primele 3 module (Parcele, CulegÄƒtori, ClienÈ›i)

### **SÄ‚PTÄ‚MÃ‚NA 2 (FinalizatÄƒ)** âœ…
- [x] Restul modulelor (6/6)
- [x] Navigare Sidebar
- [x] Bug fixes majore
- [x] generateNextId fix

### **SÄ‚PTÄ‚MÃ‚NA 3 (Ãn curs)** ğŸ”„
- [ ] Test CRUD complet
- [ ] UI polish
- [ ] Dashboard analytics
- [ ] Deploy Vercel
- [ ] Test cu Elena

### **SÄ‚PTÄ‚MÃ‚NA 4** ğŸ“…
- [ ] Feedback Elena
- [ ] Bug fixes
- [ ] Features advanced
- [ ] Documentation

---

## ğŸ› KNOWN ISSUES

### **CRITICE** âŒ
*Niciuna momentan!* âœ…

### **MINORE** âš ï¸
- [ ] Validare date Ã®n formular (edge cases)
- [ ] Error messages Ã®n romÃ¢nÄƒ inconsistent
- [ ] Mobile keyboard overlap inputs
- [ ] Toast position pe mobile

### **NICE TO HAVE** ğŸ’¡
- [ ] Dark mode
- [ ] PWA offline support
- [ ] Push notifications
- [ ] Multi-language (RO/EN)

---

## ğŸ“ˆ METRICI

### **CODE STATS**
```
Total Files:      ~150
Total Lines:      ~15,000
TypeScript:       ~12,000 LOC
React Components: ~50
Database Tables:  11
Git Commits:      25+
```

### **TESTING**
```
Unit Tests:       0 / TBD
E2E Tests:        0 / TBD
Manual Testing:   ONGOING
```

### **PERFORMANCE**
```
First Load:       TBD (dupÄƒ deploy)
Time to Interactive: TBD
Lighthouse Score: TBD
```

---

## ğŸ¯ NEXT MILESTONES

### **MILESTONE 1: MVP COMPLETE** (95% âœ…)
- [x] Toate modulele CRUD funcÈ›ionale
- [x] Navigare completÄƒ
- [x] Database + RLS
- [ ] Test CRUD exhaustive (URGENT)
- [ ] UI polish minimal

### **MILESTONE 2: PRODUCTION READY** (Target: SÄƒptÄƒmÃ¢na 3)
- [ ] Deploy Vercel
- [ ] Test cu Elena
- [ ] Bug fixes
- [ ] Documentation basic

### **MILESTONE 3: FEATURE COMPLETE** (Target: SÄƒptÄƒmÃ¢na 4)
- [ ] Dashboard analytics
- [ ] Export PDF/CSV
- [ ] Upload files
- [ ] Advanced filters

### **MILESTONE 4: PUBLIC LAUNCH** (Target: Luna 2)
- [ ] Landing page zmeurel.ro
- [ ] Pricing page
- [ ] Terms & Privacy
- [ ] Multi-tenant onboarding

---

## ğŸ’¾ GIT COMMITS HISTORY

```
a8673b2 - FIX: generateNextId in toate modulele + constante lipsa (2026-02-08)
a6d3ae1 - NAVIGARE SIDEBAR + 9 MODULE FUNCTIONALE - MVP COMPLET (2026-02-08)
ea0cdaf - [commits anterioare...]
```

---

## ğŸ”— LINKS UTILE

- **GitHub:** https://github.com/zmeurelOS-admin/zmeurel-os
- **Supabase:** https://supabase.com/dashboard
- **Deployment:** TBD (Vercel)
- **Domeniu:** zmeurel.ro (DNS nesetat)

---

## ğŸ“ NOTES

### **PENTRU ELENA (User)**
- AplicaÈ›ia e ~95% gata pentru testare
- Login: popa.andrei.sv@gmail.com
- Toate modulele funcÈ›ioneazÄƒ
- UrmeazÄƒ: UI polish + deployment

### **PENTRU ANDREI (Developer)**
- PÄƒstreazÄƒ fiÈ™ierul acesta actualizat dupÄƒ fiecare sesiune
- Commit regulat Ã®n Git
- Test Ã®nainte de push
- Backup baza de date lunar

### **PENTRU CLAUDE (AI Assistant)**
- Acest fiÈ™ier = sursa de adevÄƒr pentru progres
- ActualizeazÄƒ dupÄƒ fiecare feature completÄƒ
- VerificÄƒ statusul Ã®nainte de a propune next steps

---

**ULTIMA SESIUNE:**  
Data: 08 Februarie 2026  
Durata: ~6 ore  
Status: SUCCESS - MVP 95% complet!  
Next: Test CRUD + UI Polish + Deploy
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="scripts/check-env.js">
// scripts/check-env.js

// ğŸ”¹ ÃncarcÄƒ .env.local explicit
require('dotenv').config({ path: '.env.local' });

const required = [
  "NEXT_PUBLIC_SUPABASE_URL",
  "NEXT_PUBLIC_SUPABASE_ANON_KEY",
];

const missing = required.filter(
  (k) => !process.env[k] || String(process.env[k]).trim() === ""
);

if (missing.length > 0) {
  console.error("\nâŒ Lipsesc variabile de mediu necesare pentru Supabase:");
  for (const k of missing) console.error(" - " + k);

  console.error("\nâœ… Fix: completeazÄƒ fiÈ™ierul .env.local din rÄƒdÄƒcina proiectului cu:");
  console.error("NEXT_PUBLIC_SUPABASE_URL=...");
  console.error("NEXT_PUBLIC_SUPABASE_ANON_KEY=...\n");

  process.exit(1);
}

console.log("âœ… Env vars ok:", required.join(", "));
</file>

<file path="src/app/(auth)/login/page.tsx">
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { createClient } from '@/lib/supabase/client';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { toast } from 'sonner';

export default function LoginPage() {
  const router = useRouter();
  const supabase = createClient();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    const { error } = await supabase.auth.signInWithPassword({
      email,
      password,
    });

    if (error) {
      toast.error('Email sau parolÄƒ incorectÄƒ!');
    } else {
      router.push('/dashboard');
      router.refresh();
    }

    setLoading(false);
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <div className="bg-white p-8 rounded-2xl shadow-md w-full max-w-md">
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold text-[#312E3F]">ğŸ“ Zmeurel OS</h1>
          <p className="text-gray-500 mt-2">AutentificÄƒ-te Ã®n contul tÄƒu</p>
        </div>

        <form onSubmit={handleLogin} className="space-y-4">
          <div>
            <Label htmlFor="email">Email</Label>
            <Input
              id="email"
              type="email"
              placeholder="email@exemplu.ro"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
            />
          </div>

          <div>
            <Label htmlFor="password">ParolÄƒ</Label>
            <Input
              id="password"
              type="password"
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
            />
          </div>

          <Button
            type="submit"
            className="w-full bg-[#F16B6B] hover:bg-[#e05555] text-white"
            disabled={loading}
          >
            {loading ? 'Se autentificÄƒ...' : 'IntrÄƒ Ã®n cont'}
          </Button>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="src/app/(auth)/reset-password/page.tsx">
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { createClient } from '@/lib/supabase/client';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { toast } from 'sonner';

export default function ResetPasswordPage() {
  const router = useRouter();
  const supabase = createClient();
  const [password, setPassword] = useState('');
  const [confirm, setConfirm] = useState('');
  const [loading, setLoading] = useState(false);

  const handleReset = async (e: React.FormEvent) => {
    e.preventDefault();

    if (password !== confirm) {
      toast.error('Parolele nu coincid!');
      return;
    }

    if (password.length < 6) {
      toast.error('Parola trebuie sÄƒ aibÄƒ minim 6 caractere!');
      return;
    }

    setLoading(true);

    const { error } = await supabase.auth.updateUser({ password });

    if (error) {
      toast.error('Eroare la schimbarea parolei. ÃncearcÄƒ din nou.');
    } else {
      toast.success('Parola schimbatÄƒ cu succes!');
      router.push('/dashboard');
    }

    setLoading(false);
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <div className="bg-white p-8 rounded-2xl shadow-md w-full max-w-md">
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold text-[#312E3F]">ğŸ“ Zmeurel OS</h1>
          <p className="text-gray-500 mt-2">SeteazÄƒ o parolÄƒ nouÄƒ</p>
        </div>

        <form onSubmit={handleReset} className="space-y-4">
          <div>
            <Label htmlFor="password">ParolÄƒ nouÄƒ</Label>
            <Input
              id="password"
              type="password"
              placeholder="Minim 6 caractere"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
            />
          </div>

          <div>
            <Label htmlFor="confirm">ConfirmÄƒ parola</Label>
            <Input
              id="confirm"
              type="password"
              placeholder="RepetÄƒ parola"
              value={confirm}
              onChange={(e) => setConfirm(e.target.value)}
              required
            />
          </div>

          <Button
            type="submit"
            className="w-full bg-[#F16B6B] hover:bg-[#e05555] text-white"
            disabled={loading}
          >
            {loading ? 'Se salveazÄƒ...' : 'SalveazÄƒ parola'}
          </Button>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="src/app/(dashboard)/vanzari/page.tsx">
// src/app/(dashboard)/vanzari/page.tsx
import { cookies } from 'next/headers';
import { createServerClient } from '@supabase/ssr';
import { VanzariPageClient } from './VanzariPageClient';

export default async function VanzariPage() {
  const cookieStore = await cookies();
  
  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
      },
    }
  );

  // Get current user
  const {
    data: { user },
  } = await supabase.auth.getUser();

  if (!user) {
    return <div>Autentificare necesarÄƒ</div>;
  }

  // Fetch vÃ¢nzÄƒri iniÈ›ial (pentru SSR) - RLS handles tenant filtering
  const { data: vanzari = [] } = await supabase
    .from('vanzari')
    .select('*')
    .order('data', { ascending: false });

  // Fetch clienti pentru mapping (nume clienti) - RLS handles tenant filtering
  const { data: clienti = [] } = await supabase
    .from('clienti')
    .select('id, nume_client')
    .order('created_at', { ascending: false });

  // Map to Client interface expected by VanzariPageClient
  const mappedClienti = (clienti || []).map(c => ({
    id: c.id,
    nume: c.nume_client
  }));

  return (
    <VanzariPageClient
      initialVanzari={vanzari || []}
      clienti={mappedClienti}
    />
  );
}
</file>

<file path="src/app/auth/callback/route.ts">
import { createServerClient } from '@supabase/ssr';
import { cookies } from 'next/headers';
import { NextResponse, type NextRequest } from 'next/server';

export async function GET(request: NextRequest) {
  const { searchParams, origin } = new URL(request.url);
  const token_hash = searchParams.get('token_hash');
  const code = searchParams.get('code');
  const type = searchParams.get('type');

  const cookieStore = await cookies();
  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) =>
            cookieStore.set(name, value, options)
          );
        },
      },
    }
  );

  if (token_hash && type) {
    const { error } = await supabase.auth.verifyOtp({
      token_hash,
      type: type as 'recovery' | 'email' | 'signup',
    });

    if (!error) {
      if (type === 'recovery') {
        return NextResponse.redirect(`${origin}/reset-password`);
      }
      return NextResponse.redirect(`${origin}/dashboard`);
    }
  }

  if (code) {
    const { error } = await supabase.auth.exchangeCodeForSession(code);
    if (!error) {
      return NextResponse.redirect(`${origin}/dashboard`);
    }
  }

  return NextResponse.redirect(`${origin}/login`);
}
</file>

<file path="src/app/callback/route.ts">
import { createServerClient } from '@supabase/ssr';
import { cookies } from 'next/headers';
import { NextResponse, type NextRequest } from 'next/server';

export async function GET(request: NextRequest) {
  const { searchParams, origin } = new URL(request.url);
  const code = searchParams.get('code');
  const type = searchParams.get('type');

  if (code) {
    const cookieStore = await cookies();
    const supabase = createServerClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL!,
      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
      {
        cookies: {
          getAll() {
            return cookieStore.getAll();
          },
          setAll(cookiesToSet) {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            );
          },
        },
      }
    );

    const { error } = await supabase.auth.exchangeCodeForSession(code);

    if (!error) {
      if (type === 'recovery') {
        return NextResponse.redirect(`${origin}/reset-password`);
      }
      return NextResponse.redirect(`${origin}/dashboard`);
    }
  }

  return NextResponse.redirect(`${origin}/login`);
}
</file>

<file path="src/app/globals.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --primary: #F16B6B;
  --secondary: #312E3F;
}

body {
  margin: 0;
  padding: 0;
}
</file>

<file path="src/app/layout.tsx">
import type { Metadata } from 'next';
import { Inter } from 'next/font/google';
import './globals.css';
import { Providers } from './providers';

const inter = Inter({ subsets: ['latin'] });

export const metadata: Metadata = {
  title: 'Zmeurel OS - ERP Agricol',
  description: 'AplicaÈ›ie ERP pentru plantaÈ›ii zmeurÄƒ È™i mure',
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="ro">
      <body className={inter.className}>
        <Providers>{children}</Providers>
      </body>
    </html>
  );
}
</file>

<file path="src/app/login/page">
'use client';

import { useState } from 'react';
import { createClient } from '@/lib/supabase/client';
import { useRouter } from 'next/navigation';

export default function LoginPage() {
  const supabase = createClient();
  const router = useRouter();

  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);

  const handleLogin = async () => {
    setLoading(true);

    const { error } = await supabase.auth.signInWithPassword({
      email,
      password,
    });

    setLoading(false);

    if (error) {
      alert(error.message);
      return;
    }

    router.push('/dashboard');
  };

  return (
    <div style={{ padding: 40 }}>
      <h1>Login</h1>

      <input
        placeholder="Email"
        value={email}
        onChange={(e) => setEmail(e.target.value)}
        style={{ display: 'block', marginBottom: 10 }}
      />

      <input
        type="password"
        placeholder="Password"
        value={password}
        onChange={(e) => setPassword(e.target.value)}
        style={{ display: 'block', marginBottom: 10 }}
      />

      <button onClick={handleLogin} disabled={loading}>
        {loading ? 'Loading...' : 'Login'}
      </button>
    </div>
  );
}
</file>

<file path="src/app/page.tsx">
import { redirect } from 'next/navigation';

export default function HomePage() {
  redirect('/dashboard');
}
</file>

<file path="src/app/providers.tsx">
'use client';

import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { Toaster } from 'sonner';
import { useState } from 'react';

export function Providers({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(
    () =>
      new QueryClient({
        defaultOptions: {
          queries: {
            staleTime: 60 * 1000, // 1 minute
            refetchOnWindowFocus: false,
          },
        },
      })
  );

  return (
    <QueryClientProvider client={queryClient}>
      {children}
      <Toaster position="top-right" richColors />
    </QueryClientProvider>
  );
}
</file>

<file path="src/components/cheltuieli/AddCheltuialaDialog.tsx">
// src/components/cheltuieli/AddCheltuialaDialog.tsx
'use client';

import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Loader2 } from 'lucide-react';

// ========================================
// CATEGORII CHELTUIELI (din nomenclatoare)
// ========================================

const CATEGORII_CHELTUIELI = [
  'Electricitate',
  'MotorinÄƒ Transport',
  'Ambalaje',
  'Etichete',
  'ReparaÈ›ii Utilaje',
  'Scule',
  'Fertilizare',
  'Pesticide',
  'ÃntreÈ›inere CurentÄƒ',
  'Cules',
  'Material SÄƒditor',
  'Sistem SusÈ›inere',
  'Sistem Irigatie',
  'Altele',
];

// ========================================
// ZOD VALIDATION SCHEMA
// ========================================

const cheltuialaSchema = z.object({
  data: z.string().min(1, 'Data este obligatorie'),
  categorie: z.string().min(1, 'SelecteazÄƒ categoria'),
  suma_lei: z.string().min(1, 'Suma este obligatorie'),
  furnizor: z.string().optional(),
  descriere: z.string().optional(),
});

type CheltuialaFormData = z.infer<typeof cheltuialaSchema>;

// ========================================
// COMPONENT
// ========================================

interface AddCheltuialaDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onSubmit: (data: CheltuialaFormData) => Promise<void>;
}

export function AddCheltuialaDialog({
  open,
  onOpenChange,
  onSubmit,
}: AddCheltuialaDialogProps) {
  const [isSubmitting, setIsSubmitting] = useState(false);

  const form = useForm<CheltuialaFormData>({
    resolver: zodResolver(cheltuialaSchema),
    defaultValues: {
      data: new Date().toISOString().split('T')[0], // Data de azi
      categorie: '',
      suma_lei: '',
      furnizor: '',
      descriere: '',
    },
  });

  const handleSubmit = async (data: CheltuialaFormData) => {
    setIsSubmitting(true);
    try {
      await onSubmit(data);
      form.reset({
        data: new Date().toISOString().split('T')[0],
        categorie: '',
        suma_lei: '',
        furnizor: '',
        descriere: '',
      });
      onOpenChange(false);
    } catch (error) {
      console.error('Error creating cheltuiala:', error);
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent
        className="sm:max-w-[600px] max-h-[90vh] overflow-y-auto"
        style={{ backgroundColor: 'white' }}
      >
        <DialogHeader>
          <DialogTitle>AdaugÄƒ CheltuialÄƒ NouÄƒ</DialogTitle>
        </DialogHeader>

        <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-4">
          {/* Data */}
          <div className="space-y-2">
            <Label htmlFor="data">
              Data <span className="text-red-500">*</span>
            </Label>
            <Input
              id="data"
              {...form.register('data')}
              type="date"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            {form.formState.errors.data && (
              <p className="text-sm text-red-500">
                {form.formState.errors.data.message}
              </p>
            )}
          </div>

          {/* Categorie */}
          <div className="space-y-2">
            <Label htmlFor="categorie">
              Categorie <span className="text-red-500">*</span>
            </Label>
            <select
              id="categorie"
              {...form.register('categorie')}
              className="w-full rounded-md border border-input px-3 py-2 text-sm"
              style={{ backgroundColor: 'white', color: 'black' }}
            >
              <option value="">SelecteazÄƒ categoria...</option>
              {CATEGORII_CHELTUIELI.map((cat) => (
                <option key={cat} value={cat}>
                  {cat}
                </option>
              ))}
            </select>
            {form.formState.errors.categorie && (
              <p className="text-sm text-red-500">
                {form.formState.errors.categorie.message}
              </p>
            )}
          </div>

          {/* SumÄƒ */}
          <div className="space-y-2">
            <Label htmlFor="suma_lei">
              SumÄƒ (lei) <span className="text-red-500">*</span>
            </Label>
            <Input
              id="suma_lei"
              {...form.register('suma_lei')}
              type="number"
              step="0.01"
              min="0"
              placeholder="Ex: 150.50"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            {form.formState.errors.suma_lei && (
              <p className="text-sm text-red-500">
                {form.formState.errors.suma_lei.message}
              </p>
            )}
          </div>

          {/* Furnizor */}
          <div className="space-y-2">
            <Label htmlFor="furnizor">Furnizor / Magazin</Label>
            <Input
              id="furnizor"
              {...form.register('furnizor')}
              placeholder="Ex: Lidl, Dedeman, Petrom"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
          </div>

          {/* Descriere */}
          <div className="space-y-2">
            <Label htmlFor="descriere">Descriere</Label>
            <Textarea
              id="descriere"
              {...form.register('descriere')}
              placeholder="Ex: Electricitate casÄƒ + pompÄƒ. Factura nr. 12345"
              rows={3}
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            <p className="text-xs text-muted-foreground">
              Detalii suplimentare despre cheltuialÄƒ (numÄƒr facturÄƒ, etc.)
            </p>
          </div>

          <DialogFooter>
            <Button
              type="button"
              variant="outline"
              onClick={() => onOpenChange(false)}
              disabled={isSubmitting}
            >
              AnuleazÄƒ
            </Button>
            <Button
              type="submit"
              disabled={isSubmitting}
              style={{ backgroundColor: '#F16B6B', color: 'white' }}
            >
              {isSubmitting ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  Se salveazÄƒ...
                </>
              ) : (
                'SalveazÄƒ CheltuialÄƒ'
              )}
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/dashboard/DashboardHome.tsx">
'use client';

import Link from 'next/link';
import {
  MapPin,
  Users,
  UserCheck,
  PackageOpen,
  ShoppingCart,
  TrendingUp,
  Sprout,
  Receipt,
  ShoppingBag,
} from 'lucide-react';

const modules = [
  {
    href: '/parcele',
    label: 'Parcele',
    description: 'GestioneazÄƒ terenurile',
    icon: MapPin,
    color: '#F16B6B',
  },
  {
    href: '/culegatori',
    label: 'CulegÄƒtori',
    description: 'Personal recoltare',
    icon: Users,
    color: '#F16B6B',
  },
  {
    href: '/clienti',
    label: 'ClienÈ›i',
    description: 'Baza de cumpÄƒrÄƒtori',
    icon: UserCheck,
    color: '#F16B6B',
  },
  {
    href: '/recoltari',
    label: 'RecoltÄƒri',
    description: 'ProducÈ›ie zilnicÄƒ',
    icon: PackageOpen,
    color: '#F16B6B',
  },
  {
    href: '/vanzari',
    label: 'VÃ¢nzÄƒri Fructe',
    description: 'VÃ¢nzÄƒri fructe proaspete',
    icon: ShoppingCart,
    color: '#F16B6B',
  },
  {
    href: '/vanzari-butasi',
    label: 'VÃ¢nzÄƒri ButaÈ™i',
    description: 'Material sÄƒditor',
    icon: ShoppingBag,
    color: '#F16B6B',
  },
  {
    href: '/activitati-agricole',
    label: 'ActivitÄƒÈ›i Agricole',
    description: 'Tratamente & fertilizÄƒri',
    icon: Sprout,
    color: '#F16B6B',
  },
  {
    href: '/investitii',
    label: 'InvestiÈ›ii',
    description: 'Cheltuieli de capital',
    icon: TrendingUp,
    color: '#F16B6B',
  },
  {
    href: '/cheltuieli',
    label: 'Cheltuieli',
    description: 'Costuri operaÈ›ionale',
    icon: Receipt,
    color: '#F16B6B',
  },
];

export function DashboardHome() {
  return (
    <div className="min-h-screen bg-gray-50 p-6 lg:p-8">
      {/* Header */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-[#312E3F]">
          Bun venit! ğŸ‘‹
        </h1>
        <p className="text-gray-500 mt-1 text-base">
          SelecteazÄƒ un modul pentru a Ã®ncepe
        </p>
      </div>

      {/* Grid */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4">
        {modules.map(({ href, label, description, icon: Icon }) => (
          <Link
            key={href}
            href={href}
            className="group bg-white rounded-2xl p-6 flex flex-col items-center text-center
              border border-gray-100 shadow-sm
              hover:shadow-xl hover:-translate-y-1.5 hover:border-[#F16B6B]/20
              transition-all duration-250 ease-out cursor-pointer"
          >
            {/* Icon bubble */}
            <div
              className="w-16 h-16 rounded-2xl flex items-center justify-center mb-4
                bg-[#F16B6B]/10 group-hover:bg-[#F16B6B]/20 transition-colors duration-200"
            >
              <Icon
                className="w-7 h-7 text-[#F16B6B] group-hover:scale-110 transition-transform duration-200"
              />
            </div>

            {/* Text */}
            <p className="text-[#312E3F] font-semibold text-sm leading-tight mb-1">
              {label}
            </p>
            <p className="text-gray-400 text-xs leading-snug">
              {description}
            </p>
          </Link>
        ))}
      </div>
    </div>
  );
}
</file>

<file path="src/components/parcele/DeleteConfirmDialog.tsx">
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog";

interface DeleteConfirmDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onConfirm: () => void;
  itemName: string;
  itemType: string;
}

export function DeleteConfirmDialog({
  open,
  onOpenChange,
  onConfirm,
  itemName,
  itemType = "", // Fallback pentru a preveni undefined
}: DeleteConfirmDialogProps) {
  
  const getDeleteMessage = () => {
    // VerificÄƒm dacÄƒ itemType existÄƒ, dacÄƒ nu, folosim un string gol
    const type = (itemType || "").toLowerCase();
    
    switch (type) {
      case 'parcelÄƒ':
        return 'Parcela va fi È™tearsÄƒ permanent din sistem, Ã®mpreunÄƒ cu toate datele asociate (recoltÄƒri, activitÄƒÈ›i).';
      case 'culegÄƒtor':
        return 'CulegÄƒtorul va fi È™ters permanent din sistem, Ã®mpreunÄƒ cu toate datele asociate.';
      case 'client':
        return 'Clientul va fi È™ters permanent din sistem.';
      case 'investiÈ›ie':
        return 'InvestiÈ›ia va fi È™tearsÄƒ permanent din sistem.';
      case 'cheltuialÄƒ':
        return 'Cheltuiala va fi È™tearsÄƒ permanent din sistem.';
      default:
        return 'AceastÄƒ Ã®nregistrare va fi È™tearsÄƒ permanent din sistem.';
    }
  };

  return (
    <AlertDialog open={open} onOpenChange={onOpenChange}>
      <AlertDialogContent className="bg-white">
        <AlertDialogHeader>
          <AlertDialogTitle>EÈ™ti absolut sigur?</AlertDialogTitle>
          <AlertDialogDescription>
            AceastÄƒ acÈ›iune nu poate fi anulatÄƒ. <strong>{itemName}</strong> va fi È™ters(Äƒ) permanent din sistem.
            <br /><br />
            {getDeleteMessage()}
          </AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel>AnuleazÄƒ</AlertDialogCancel>
          <AlertDialogAction
            onClick={onConfirm}
            className="bg-red-600 hover:bg-red-700 text-white border-0"
          >
            È˜terge
          </AlertDialogAction>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
}
</file>

<file path="src/components/recoltari/RecoltareCard.tsx">
// src/components/recoltari/RecoltareCard.tsx
'use client';

import { Card, CardContent, CardHeader } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Pencil, Trash2, Calendar, User, Package, DollarSign } from 'lucide-react';
import { Recoltare } from '@/lib/supabase/queries/recoltari';

interface RecoltareCardProps {
  recoltare: Recoltare;
  culegatorNume?: string;
  culegatorTarif?: number; // Tarif lei/kg din tabela culegatori
  parcelaNume?: string;
  onEdit: (recoltare: Recoltare) => void;
  onDelete: (recoltare: Recoltare) => void;
}

export function RecoltareCard({
  recoltare,
  culegatorNume,
  culegatorTarif,
  parcelaNume,
  onEdit,
  onDelete,
}: RecoltareCardProps) {
  // Format date pentru display: DD.MM.YYYY
  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('ro-RO', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
    });
  };

  // Format numere
  const formatNumber = (num: number) => {
    return new Intl.NumberFormat('ro-RO', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    }).format(num);
  };

  // Calcule automate
  const cantitateBrutaKg = recoltare.nr_caserole * 0.5; // 1 caserola = 0.5 kg
  const cantitateNetaKg = cantitateBrutaKg - recoltare.tara_kg;
  const valoareMuncaLei = culegatorTarif ? cantitateNetaKg * culegatorTarif : 0;

  return (
    <Card className="hover:shadow-md transition-shadow">
      <CardHeader className="pb-3">
        <div className="flex items-start justify-between">
          <div className="flex-1">
            {/* ID recoltare */}
            <div className="flex items-center gap-2 mb-2">
              <span className="font-semibold text-lg text-gray-900">
                {recoltare.id_recoltare}
              </span>
            </div>

            {/* Data */}
            <div className="flex items-center gap-1.5 text-sm text-gray-600 mb-1">
              <Calendar className="h-4 w-4" />
              <span>{formatDate(recoltare.data)}</span>
            </div>

            {/* CulegÄƒtor */}
            {recoltare.culegator_id && culegatorNume && (
              <div className="flex items-center gap-1.5 text-sm text-gray-600 mb-1">
                <User className="h-4 w-4" />
                <span>{culegatorNume}</span>
              </div>
            )}

            {/* ParcelÄƒ */}
            {recoltare.parcela_id && parcelaNume && (
              <div className="flex items-center gap-1.5 text-sm text-gray-600">
                <Package className="h-4 w-4" />
                <span>{parcelaNume}</span>
              </div>
            )}
          </div>

          {/* AcÈ›iuni */}
          <div className="flex gap-1">
            <Button
              variant="ghost"
              size="icon"
              onClick={() => onEdit(recoltare)}
              className="h-8 w-8"
            >
              <Pencil className="h-4 w-4" />
            </Button>
            <Button
              variant="ghost"
              size="icon"
              onClick={() => onDelete(recoltare)}
              className="h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50"
            >
              <Trash2 className="h-4 w-4" />
            </Button>
          </div>
        </div>
      </CardHeader>

      <CardContent className="pt-0">
        {/* CantitÄƒÈ›i */}
        <div className="grid grid-cols-3 gap-2 mb-3 p-3 bg-blue-50 rounded-lg border border-blue-100">
          <div className="text-center">
            <div className="text-xs text-gray-600 mb-1">Caserole</div>
            <div className="text-lg font-bold text-gray-900">
              {recoltare.nr_caserole}
            </div>
          </div>
          <div className="text-center">
            <div className="text-xs text-gray-600 mb-1">Brut (kg)</div>
            <div className="text-lg font-bold text-blue-600">
              {formatNumber(cantitateBrutaKg)}
            </div>
          </div>
          <div className="text-center">
            <div className="text-xs text-gray-600 mb-1">Net (kg)</div>
            <div className="text-lg font-bold text-blue-700">
              {formatNumber(cantitateNetaKg)}
            </div>
          </div>
        </div>

        {/* TarÄƒ (dacÄƒ existÄƒ) */}
        {recoltare.tara_kg > 0 && (
          <div className="text-sm mb-2 text-gray-600">
            TarÄƒ: {formatNumber(recoltare.tara_kg)} kg
          </div>
        )}

        {/* Valoare MuncÄƒ (dacÄƒ existÄƒ tarif) */}
        {culegatorTarif && culegatorTarif > 0 && (
          <div className="flex items-center gap-2 mb-3 p-3 bg-red-50 rounded-lg border border-red-100">
            <DollarSign className="h-5 w-5 text-red-600" />
            <div className="flex-1">
              <div className="text-xs text-gray-600 mb-0.5">
                Valoare muncÄƒ ({formatNumber(culegatorTarif)} lei/kg)
              </div>
              <div className="text-2xl font-bold text-red-600">
                -{formatNumber(valoareMuncaLei)} lei
              </div>
            </div>
          </div>
        )}

        {/* CulegÄƒtor cu tarif 0 (Salarizat fix) */}
        {culegatorTarif === 0 && (
          <div className="text-sm text-gray-600 mb-2">
            CulegÄƒtor salarizat fix (fÄƒrÄƒ tarif/kg)
          </div>
        )}

        {/* ObservaÈ›ii */}
        {recoltare.observatii && (
          <div className="text-sm text-gray-600 border-t pt-2 mt-2">
            {recoltare.observatii}
          </div>
        )}
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/Toaster.tsx">
'use client';

import { Toaster as SonnerToaster } from 'sonner';

export function Toaster() {
  return (
    <SonnerToaster
      position="top-right"
      toastOptions={{
        style: {
          background: 'white',
          color: '#312E3F',
          border: '1px solid #e5e7eb',
          borderRadius: '12px',
        },
        className: 'sonner-toast',
        descriptionClassName: 'sonner-toast-description',
        actionButtonStyle: {
          background: '#F16B6B',
          color: 'white',
        },
        cancelButtonStyle: {
          background: '#f3f4f6',
          color: '#312E3F',
        },
      }}
    />
  );
}
</file>

<file path="src/components/ui/alert-dialog.tsx">
"use client"

import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    ref={ref}
    style={{
      position: 'fixed',
      inset: 0,
      zIndex: 50,
      backgroundColor: 'rgba(0, 0, 0, 0.8)'
    }}
    className={cn(
      "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <div 
      style={{
        position: 'fixed',
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
        zIndex: 50,
        backgroundColor: 'rgba(0, 0, 0, 0.8)'
      }}
      aria-hidden="true" 
    />
    <AlertDialogPrimitive.Content
      ref={ref}
      style={{ 
        backgroundColor: 'white',
        borderRadius: '0.5rem'
      }}
      className={cn(
        "fixed left-[50%] top-[50%] z-[60] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}
</file>

<file path="src/components/ui/badge.tsx">
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { Slot } from "radix-ui"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-full border border-transparent px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border-border text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
        ghost: "[a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
        link: "text-primary underline-offset-4 [a&]:hover:underline",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Badge({
  className,
  variant = "default",
  asChild = false,
  ...props
}: React.ComponentProps<"span"> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot.Root : "span"

  return (
    <Comp
      data-slot="badge"
      data-variant={variant}
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  )
}

export { Badge, badgeVariants }
</file>

<file path="src/components/ui/button.tsx">
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { Slot } from "radix-ui"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        xs: "h-6 gap-1 rounded-md px-2 text-xs has-[>svg]:px-1.5 [&_svg:not([class*='size-'])]:size-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
        "icon-xs": "size-6 rounded-md [&_svg:not([class*='size-'])]:size-3",
        "icon-sm": "size-8",
        "icon-lg": "size-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Button({
  className,
  variant = "default",
  size = "default",
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean
  }) {
  const Comp = asChild ? Slot.Root : "button"

  return (
    <Comp
      data-slot="button"
      data-variant={variant}
      data-size={size}
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Button, buttonVariants }
</file>

<file path="src/components/ui/card.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
        className
      )}
      {...props}
    />
  )
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className
      )}
      {...props}
    />
  )
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-title"
      className={cn("leading-none font-semibold", className)}
      {...props}
    />
  )
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className
      )}
      {...props}
    />
  )
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6", className)}
      {...props}
    />
  )
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
      {...props}
    />
  )
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
}
</file>

<file path="src/components/ui/dialog.tsx">
"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    style={{
      position: 'fixed',
      inset: 0,
      zIndex: 50,
      backgroundColor: 'rgba(0, 0, 0, 0.8)'
    }}
    className={cn(
      "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <div 
      style={{
        position: 'fixed',
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
        zIndex: 50,
        backgroundColor: 'rgba(0, 0, 0, 0.8)'
      }}
      aria-hidden="true" 
    />
    <DialogPrimitive.Content
      ref={ref}
      style={{ 
        backgroundColor: 'white',
        borderRadius: '0.5rem'
      }}
      className={cn(
        "fixed left-[50%] top-[50%] z-[60] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close 
        style={{ backgroundColor: 'transparent' }}
        className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-slate-950 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-slate-100 data-[state=open]:text-slate-500"
      >
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-slate-500", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}
</file>

<file path="src/components/ui/form.tsx">
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  ControllerProps,
  FieldPath,
  FieldValues,
  FormProvider,
  useFormContext,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-sm text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message) : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-sm font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}
</file>

<file path="src/components/ui/input.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className
      )}
      {...props}
    />
  )
}

export { Input }
</file>

<file path="src/components/ui/label.tsx">
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }
</file>

<file path="src/components/ui/select.tsx">
"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    style={{ backgroundColor: 'white' }}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Content
    ref={ref}
    style={{ 
      backgroundColor: 'white',
      borderRadius: '0.375rem',
      position: 'absolute',
      zIndex: 9999
    }}
    className={cn(
      "relative max-h-96 min-w-[8rem] overflow-hidden border shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      position === "popper" &&
        "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
      className
    )}
    position={position}
    {...props}
  >
    <SelectScrollUpButton />
    <SelectPrimitive.Viewport
      className={cn(
        "p-1",
        position === "popper" &&
          "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
      )}
    >
      {children}
    </SelectPrimitive.Viewport>
    <SelectScrollDownButton />
  </SelectPrimitive.Content>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    style={{ backgroundColor: 'white' }}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none hover:bg-gray-100 focus:bg-gray-100 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}
</file>

<file path="src/components/ui/sonner.tsx">
"use client"

import {
  CircleCheckIcon,
  InfoIcon,
  Loader2Icon,
  OctagonXIcon,
  TriangleAlertIcon,
} from "lucide-react"
import { useTheme } from "next-themes"
import { Toaster as Sonner, type ToasterProps } from "sonner"

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      icons={{
        success: <CircleCheckIcon className="size-4" />,
        info: <InfoIcon className="size-4" />,
        warning: <TriangleAlertIcon className="size-4" />,
        error: <OctagonXIcon className="size-4" />,
        loading: <Loader2Icon className="size-4 animate-spin" />,
      }}
      style={
        {
          "--normal-bg": "var(--popover)",
          "--normal-text": "var(--popover-foreground)",
          "--normal-border": "var(--border)",
          "--border-radius": "var(--radius)",
        } as React.CSSProperties
      }
      {...props}
    />
  )
}

export { Toaster }
</file>

<file path="src/components/ui/table.tsx">
"use client"

import * as React from "react"

import { cn } from "@/lib/utils"

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn("w-full caption-bottom text-sm", className)}
        {...props}
      />
    </div>
  )
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return (
    <thead
      data-slot="table-header"
      className={cn("[&_tr]:border-b", className)}
      {...props}
    />
  )
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return (
    <tbody
      data-slot="table-body"
      className={cn("[&_tr:last-child]:border-0", className)}
      {...props}
    />
  )
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
        className
      )}
      {...props}
    />
  )
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
        className
      )}
      {...props}
    />
  )
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<"caption">) {
  return (
    <caption
      data-slot="table-caption"
      className={cn("text-muted-foreground mt-4 text-sm", className)}
      {...props}
    />
  )
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}
</file>

<file path="src/components/Untitled">
'use client';

import { useRouter } from 'next/navigation';
import { useState } from 'react';
import { supabase } from '@/lib/supabase/client';

export default function LogoutButton() {
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(false);

  const handleLogout = async () => {
    try {
      setIsLoading(true);
      const { error } = await supabase.auth.signOut();
      
      if (error) {
        console.error('Eroare logout:', error);
        alert('Eroare la deconectare. ÃncearcÄƒ din nou.');
        return;
      }

      // Redirect la login
      router.push('/login');
      router.refresh();
    } catch (err) {
      console.error('Eroare logout:', err);
      alert('Eroare la deconectare. ÃncearcÄƒ din nou.');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <button
      onClick={handleLogout}
      disabled={isLoading}
      className="px-4 py-2 text-sm font-medium text-white bg-red-500 rounded-lg hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
    >
      {isLoading ? 'Se deconecteazÄƒ...' : 'ğŸšª IeÈ™ire'}
    </button>
  );
}
</file>

<file path="src/components/vanzari-butasi/VanzareButasiCard.tsx">
// src/components/vanzari-butasi/VanzareButasiCard.tsx
'use client';

import { Card, CardContent, CardHeader } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Pencil, Trash2, Calendar, DollarSign, User, Package } from 'lucide-react';
import { VanzareButasi } from '@/lib/supabase/queries/vanzari-butasi';

interface VanzareButasiCardProps {
  vanzare: VanzareButasi;
  clientNume?: string; // Nume client pentru display (optional)
  parcelaNume?: string; // Nume parcelÄƒ pentru display (optional)
  onEdit: (vanzare: VanzareButasi) => void;
  onDelete: (vanzare: VanzareButasi) => void;
}

export function VanzareButasiCard({
  vanzare,
  clientNume,
  parcelaNume,
  onEdit,
  onDelete,
}: VanzareButasiCardProps) {
  // Format date pentru display: DD.MM.YYYY
  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('ro-RO', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
    });
  };

  // Format sumÄƒ cu separator mii È™i 2 zecimale
  const formatSuma = (suma: number) => {
    return new Intl.NumberFormat('ro-RO', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    }).format(suma);
  };

  // Calcul valoare totalÄƒ
  const valoareTotala = vanzare.cantitate_butasi * vanzare.pret_unitar_lei;

  return (
    <Card className="hover:shadow-md transition-shadow">
      <CardHeader className="pb-3">
        <div className="flex items-start justify-between">
          <div className="flex-1">
            {/* ID vÃ¢nzare + Soi */}
            <div className="flex items-center gap-2 mb-2">
              <span className="font-semibold text-lg text-gray-900">
                {vanzare.id_vanzare_butasi}
              </span>
              <span className="px-2 py-1 rounded-md text-xs font-medium bg-green-100 text-green-800">
                {vanzare.soi_butasi}
              </span>
            </div>

            {/* Data */}
            <div className="flex items-center gap-1.5 text-sm text-gray-600 mb-1">
              <Calendar className="h-4 w-4" />
              <span>{formatDate(vanzare.data)}</span>
            </div>

            {/* Client (dacÄƒ existÄƒ) */}
            {vanzare.client_id && clientNume && (
              <div className="flex items-center gap-1.5 text-sm text-gray-600 mb-1">
                <User className="h-4 w-4" />
                <span>Client: {clientNume}</span>
              </div>
            )}

            {/* ParcelÄƒ sursÄƒ (dacÄƒ existÄƒ) */}
            {vanzare.parcela_sursa_id && parcelaNume && (
              <div className="flex items-center gap-1.5 text-sm text-gray-600">
                <Package className="h-4 w-4" />
                <span>SursÄƒ: {parcelaNume}</span>
              </div>
            )}
          </div>

          {/* AcÈ›iuni */}
          <div className="flex gap-1">
            <Button
              variant="ghost"
              size="icon"
              onClick={() => onEdit(vanzare)}
              className="h-8 w-8"
            >
              <Pencil className="h-4 w-4" />
            </Button>
            <Button
              variant="ghost"
              size="icon"
              onClick={() => onDelete(vanzare)}
              className="h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50"
            >
              <Trash2 className="h-4 w-4" />
            </Button>
          </div>
        </div>
      </CardHeader>

      <CardContent className="pt-0">
        {/* Cantitate È™i PreÈ› */}
        <div className="grid grid-cols-2 gap-2 mb-3">
          <div className="text-sm">
            <span className="text-gray-600">Cantitate:</span>{' '}
            <span className="font-medium text-gray-900">
              {vanzare.cantitate_butasi} butaÈ™i
            </span>
          </div>
          <div className="text-sm">
            <span className="text-gray-600">PreÈ›/buc:</span>{' '}
            <span className="font-medium text-gray-900">
              {formatSuma(vanzare.pret_unitar_lei)} lei
            </span>
          </div>
        </div>

        {/* Valoare TotalÄƒ (highlight verde - income) */}
        <div className="flex items-center gap-2 mb-3 p-3 bg-green-50 rounded-lg border border-green-100">
          <DollarSign className="h-5 w-5 text-green-600" />
          <div className="flex-1">
            <div className="text-xs text-gray-600 mb-0.5">Valoare totalÄƒ</div>
            <div className="text-2xl font-bold text-green-600">
              +{formatSuma(valoareTotala)} lei
            </div>
          </div>
        </div>

        {/* ObservaÈ›ii */}
        {vanzare.observatii && (
          <div className="text-sm text-gray-600 border-t pt-2 mt-2">
            {vanzare.observatii}
          </div>
        )}
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/vanzari/VanzareCard.tsx">
// src/components/vanzari/VanzareCard.tsx
'use client';

import { Card, CardContent, CardHeader } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Pencil, Trash2, Calendar, User, DollarSign, Package } from 'lucide-react';
import { Vanzare } from '@/lib/supabase/queries/vanzari';

interface VanzareCardProps {
  vanzare: Vanzare;
  clientNume?: string;
  onEdit: (vanzare: Vanzare) => void;
  onDelete: (vanzare: Vanzare) => void;
}

export function VanzareCard({
  vanzare,
  clientNume,
  onEdit,
  onDelete,
}: VanzareCardProps) {
  // Format date pentru display: DD.MM.YYYY
  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('ro-RO', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
    });
  };

  // Format sumÄƒ cu separator mii È™i 2 zecimale
  const formatSuma = (suma: number) => {
    return new Intl.NumberFormat('ro-RO', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    }).format(suma);
  };

  // Calcul valoare totalÄƒ
  const valoareTotala = vanzare.cantitate_kg * vanzare.pret_lei_kg;

  // Culori badge status platÄƒ
  const getBadgeColor = (status: string) => {
    switch (status) {
      case 'PlÄƒtit':
        return 'bg-green-100 text-green-800';
      case 'RestanÈ›Äƒ':
        return 'bg-red-100 text-red-800';
      case 'Avans':
        return 'bg-yellow-100 text-yellow-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  };

  return (
    <Card className="hover:shadow-md transition-shadow">
      <CardHeader className="pb-3">
        <div className="flex items-start justify-between">
          <div className="flex-1">
            {/* ID vÃ¢nzare + Status platÄƒ */}
            <div className="flex items-center gap-2 mb-2">
              <span className="font-semibold text-lg text-gray-900">
                {vanzare.id_vanzare}
              </span>
              <span className={`px-2 py-1 rounded-md text-xs font-medium ${getBadgeColor(vanzare.status_plata)}`}>
                {vanzare.status_plata}
              </span>
            </div>

            {/* Data */}
            <div className="flex items-center gap-1.5 text-sm text-gray-600 mb-1">
              <Calendar className="h-4 w-4" />
              <span>{formatDate(vanzare.data)}</span>
            </div>

            {/* Client (dacÄƒ existÄƒ) */}
            {vanzare.client_id && clientNume && (
              <div className="flex items-center gap-1.5 text-sm text-gray-600">
                <User className="h-4 w-4" />
                <span>Client: {clientNume}</span>
              </div>
            )}
          </div>

          {/* AcÈ›iuni */}
          <div className="flex gap-1">
            <Button
              variant="ghost"
              size="icon"
              onClick={() => onEdit(vanzare)}
              className="h-8 w-8"
            >
              <Pencil className="h-4 w-4" />
            </Button>
            <Button
              variant="ghost"
              size="icon"
              onClick={() => onDelete(vanzare)}
              className="h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50"
            >
              <Trash2 className="h-4 w-4" />
            </Button>
          </div>
        </div>
      </CardHeader>

      <CardContent className="pt-0">
        {/* Cantitate È™i PreÈ› */}
        <div className="grid grid-cols-2 gap-2 mb-3">
          <div className="text-sm">
            <span className="text-gray-600">Cantitate:</span>{' '}
            <span className="font-medium text-gray-900">
              {formatSuma(vanzare.cantitate_kg)} kg
            </span>
          </div>
          <div className="text-sm">
            <span className="text-gray-600">PreÈ›/kg:</span>{' '}
            <span className="font-medium text-gray-900">
              {formatSuma(vanzare.pret_lei_kg)} lei
            </span>
          </div>
        </div>

        {/* Valoare TotalÄƒ (highlight verde - income) */}
        <div className="flex items-center gap-2 mb-3 p-3 bg-green-50 rounded-lg border border-green-100">
          <DollarSign className="h-5 w-5 text-green-600" />
          <div className="flex-1">
            <div className="text-xs text-gray-600 mb-0.5">Valoare totalÄƒ</div>
            <div className="text-2xl font-bold text-green-600">
              +{formatSuma(valoareTotala)} lei
            </div>
          </div>
        </div>

        {/* ObservaÈ›ii lÄƒdiÈ›e */}
        {vanzare.observatii_ladite && (
          <div className="flex items-start gap-2 text-sm text-gray-600 border-t pt-2 mt-2">
            <Package className="h-4 w-4 mt-0.5 flex-shrink-0" />
            <div>
              <span className="font-medium">LÄƒdiÈ›e:</span> {vanzare.observatii_ladite}
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/lib/debug/rls-check.ts">
// ============================================================================
// RLS DEBUG CHECKER
// Temporary test script to verify RLS and tenant_id auto-population
// DO NOT EXPOSE TO PRODUCTION ROUTES
// ============================================================================

import { createClient } from '@/lib/supabase/client';

export async function testRLSAutoPopulation() {
  const supabase = createClient();

  console.log('ğŸ” Starting RLS Check...');

  // 1. Get current user
  const { data: { user }, error: userError } = await supabase.auth.getUser();
  
  if (userError || !user) {
    console.error('âŒ User not authenticated:', userError);
    return { success: false, error: 'User not authenticated' };
  }

  console.log('âœ… Authenticated user:', user.id);

  // 2. Get user's tenant
  const { data: tenant, error: tenantError } = await supabase
    .from('tenants')
    .select('id')
    .eq('owner_user_id', user.id)
    .single();

  if (tenantError || !tenant) {
    console.error('âŒ Tenant not found:', tenantError);
    return { success: false, error: 'Tenant not found' };
  }

  console.log('âœ… User tenant_id:', tenant.id);

  // 3. Insert a test client record WITHOUT tenant_id
  const testClientName = `RLS_TEST_${Date.now()}`;
  
  const { data: insertedClient, error: insertError } = await supabase
    .from('clienti')
    .insert({
      nume: testClientName,
      telefon: '0700000000',
      email: 'rls-test@example.com',
      // NOTE: tenant_id is NOT included - should be auto-populated by trigger/RLS
    })
    .select()
    .single();

  if (insertError) {
    console.error('âŒ Insert failed:', insertError);
    return { success: false, error: insertError.message };
  }

  console.log('âœ… Record inserted:', insertedClient);

  // 4. Check if tenant_id was auto-populated
  if (!insertedClient.tenant_id) {
    console.error('âŒ tenant_id was NOT auto-populated!');
    return { 
      success: false, 
      error: 'tenant_id not auto-populated',
      record: insertedClient 
    };
  }

  if (insertedClient.tenant_id !== tenant.id) {
    console.error('âŒ tenant_id mismatch!');
    console.error('Expected:', tenant.id);
    console.error('Got:', insertedClient.tenant_id);
    return { 
      success: false, 
      error: 'tenant_id mismatch',
      expected: tenant.id,
      got: insertedClient.tenant_id 
    };
  }

  console.log('âœ… tenant_id correctly auto-populated:', insertedClient.tenant_id);

  // 5. Verify we can only see our own records (RLS SELECT policy)
  const { data: allClients, error: selectError } = await supabase
    .from('clienti')
    .select('*');

  if (selectError) {
    console.error('âŒ Select failed:', selectError);
  } else {
    const ourClients = allClients?.filter(c => c.tenant_id === tenant.id);
    console.log(`âœ… RLS SELECT working: ${ourClients?.length}/${allClients?.length} records visible`);
  }

  // 6. Clean up test record
  const { error: deleteError } = await supabase
    .from('clienti')
    .delete()
    .eq('id', insertedClient.id);

  if (deleteError) {
    console.warn('âš ï¸ Failed to clean up test record:', deleteError);
  } else {
    console.log('âœ… Test record cleaned up');
  }

  return {
    success: true,
    userId: user.id,
    tenantId: tenant.id,
    autoPopulatedTenantId: insertedClient.tenant_id,
    message: 'RLS and tenant_id auto-population working correctly!'
  };
}

// Export for manual testing in browser console
if (typeof window !== 'undefined') {
  (window as any).testRLS = testRLSAutoPopulation;
}
</file>

<file path="src/lib/supabase/client.ts">
import { createBrowserClient } from '@supabase/ssr';

if (typeof window !== 'undefined') {
  const url = process.env.NEXT_PUBLIC_SUPABASE_URL;
  const key = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
  
  console.log('ğŸ” [Supabase Client Debug]');
  console.log('URL exists:', !!url);
  console.log('URL prefix:', url?.substring(0, 20) + '...');
  console.log('Key exists:', !!key);
  console.log('Key prefix:', key?.substring(0, 20) + '...');
}

export function createClient() {
  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;

  if (!supabaseUrl || !supabaseAnonKey) {
    throw new Error(
      'âŒ Missing Supabase environment variables!\n' +
      `URL: ${!!supabaseUrl}\n` +
      `Key: ${!!supabaseAnonKey}`
    );
  }

  return createBrowserClient(supabaseUrl, supabaseAnonKey);
}
</file>

<file path="src/lib/utils.ts">
import { type ClassValue, clsx } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
</file>

<file path="src/types/supabase.ts">
// Auto-generated Supabase types helper
// This file provides type utilities for Supabase tables

export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[]

export interface Database {
  public: {
    Tables: {
      clienti: {
        Row: {
          id: string
          tenant_id: string
          id_client: string
          nume_client: string
          telefon: string | null
          email: string | null
          adresa: string | null
          pret_negociat_lei_kg: number | null
          observatii: string | null
          created_at: string
          updated_at: string
        }
        Insert: {
          id?: string
          tenant_id?: string
          id_client?: string
          nume_client: string
          telefon?: string | null
          email?: string | null
          adresa?: string | null
          pret_negociat_lei_kg?: number | null
          observatii?: string | null
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: string
          tenant_id?: string
          id_client?: string
          nume_client?: string
          telefon?: string | null
          email?: string | null
          adresa?: string | null
          pret_negociat_lei_kg?: number | null
          observatii?: string | null
          created_at?: string
          updated_at?: string
        }
      }
      parcele: {
        Row: {
          id: string
          tenant_id: string
          id_parcela: string
          nume_parcela: string
          suprafata_m2: number
          soi_plantat: string | null
          an_plantare: number
          nr_plante: number | null
          status: string
          gps_lat: number | null
          gps_lng: number | null
          observatii: string | null
          created_at: string
          updated_at: string
        }
        Insert: {
          id?: string
          tenant_id?: string
          id_parcela?: string
          nume_parcela: string
          suprafata_m2: number
          soi_plantat?: string | null
          an_plantare: number
          nr_plante?: number | null
          status?: string
          gps_lat?: number | null
          gps_lng?: number | null
          observatii?: string | null
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: string
          tenant_id?: string
          id_parcela?: string
          nume_parcela?: string
          suprafata_m2?: number
          soi_plantat?: string | null
          an_plantare?: number
          nr_plante?: number | null
          status?: string
          gps_lat?: number | null
          gps_lng?: number | null
          observatii?: string | null
          created_at?: string
          updated_at?: string
        }
      }
      [key: string]: {
        Row: Record<string, unknown>
        Insert: Record<string, unknown>
        Update: Record<string, unknown>
      }
    }
    Views: {
      [_ in never]: never
    }
    Functions: {
      [_ in never]: never
    }
    Enums: {
      [_ in never]: never
    }
  }
}

export type Tables<T extends keyof Database['public']['Tables']> =
  Database['public']['Tables'][T]['Row']

export type Inserts<T extends keyof Database['public']['Tables']> =
  Database['public']['Tables'][T]['Insert']

export type Updates<T extends keyof Database['public']['Tables']> =
  Database['public']['Tables'][T]['Update']
</file>

<file path="tatus">
warning: in the working copy of 'package-lock.json', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'package.json', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/activitati-agricole/ActivitatiAgricolePageClient.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/cheltuieli/CheltuialaPageClient.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/cheltuieli/page.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/clienti/ClientPageClient.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/clienti/page.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/culegatori/CulegatorPageClient.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/culegatori/page.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/investitii/InvestitiiPageClient.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/investitii/page.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/parcele/ParcelaPageClient.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/parcele/page.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/vanzari-butasi/VanzariButasiPageClient.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/vanzari/VanzariPageClient.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/app/(dashboard)/vanzari/page.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/components/Navbar.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/components/cheltuieli/CheltuialaCard.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/components/investitii/AddInvestitieDialog.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/components/investitii/EditInvestitieDialog.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/components/layout/Sidebar.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/components/parcele/AddParcelaDialog.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/components/parcele/EditParcelaDialog.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/components/vanzari-butasi/AddVanzareButasiDialog.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/components/vanzari-butasi/EditVanzareButasiDialog.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/components/vanzari/AddVanzareDialog.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/components/vanzari/EditVanzareDialog.tsx', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/lib/supabase/queries/activitati-agricole.ts', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/lib/supabase/queries/cheltuieli.ts', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/lib/supabase/queries/clienti.ts', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/lib/supabase/queries/culegatori.ts', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/lib/supabase/queries/investitii.ts', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/lib/supabase/queries/parcele.ts', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/lib/supabase/queries/recoltari.ts', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/lib/supabase/queries/vanzari-butasi.ts', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/lib/supabase/queries/vanzari.ts', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'src/lib/supabase/server.ts', LF will be replaced by CRLF the next time Git touches it
D	middleware.ts
D	next
M	package-lock.json
M	package.json
M	src/app/(dashboard)/activitati-agricole/ActivitatiAgricolePageClient.tsx
M	src/app/(dashboard)/activitati-agricole/page.tsx
M	src/app/(dashboard)/cheltuieli/CheltuialaPageClient.tsx
M	src/app/(dashboard)/cheltuieli/page.tsx
M	src/app/(dashboard)/clienti/ClientPageClient.tsx
M	src/app/(dashboard)/clienti/page.tsx
M	src/app/(dashboard)/culegatori/CulegatorPageClient.tsx
M	src/app/(dashboard)/culegatori/page.tsx
M	src/app/(dashboard)/investitii/InvestitiiPageClient.tsx
M	src/app/(dashboard)/investitii/page.tsx
M	src/app/(dashboard)/parcele/ParcelaPageClient.tsx
M	src/app/(dashboard)/parcele/page.tsx
M	src/app/(dashboard)/recoltari/RecoltariPageClient.tsx
M	src/app/(dashboard)/recoltari/page.tsx
M	src/app/(dashboard)/vanzari-butasi/VanzariButasiPageClient.tsx
M	src/app/(dashboard)/vanzari-butasi/page.tsx
M	src/app/(dashboard)/vanzari/VanzariPageClient.tsx
M	src/components/Navbar.tsx
M	src/components/activitati-agricole/AddActivitateAgricolaDialog.tsx
M	src/components/activitati-agricole/EditActivitateAgricolaDialog.tsx
M	src/components/cheltuieli/CheltuialaCard.tsx
M	src/components/clienti/ClientCard.tsx
M	src/components/clienti/EditClientDialog.tsx
M	src/components/culegatori/CulegatorCard.tsx
M	src/components/culegatori/EditCulegatorDialog.tsx
M	src/components/investitii/AddInvestitieDialog.tsx
M	src/components/investitii/EditInvestitieDialog.tsx
M	src/components/layout/Sidebar.tsx
M	src/components/parcele/AddParcelaDialog.tsx
M	src/components/parcele/EditParcelaDialog.tsx
M	src/components/parcele/ParcelaCard.tsx
M	src/components/recoltari/AddRecoltareDialog.tsx
M	src/components/recoltari/EditRecoltareDialog.tsx
M	src/components/ui/textarea.tsx
M	src/components/vanzari-butasi/AddVanzareButasiDialog.tsx
M	src/components/vanzari-butasi/EditVanzareButasiDialog.tsx
M	src/components/vanzari/AddVanzareDialog.tsx
M	src/components/vanzari/EditVanzareDialog.tsx
M	src/lib/supabase/queries/activitati-agricole.ts
M	src/lib/supabase/queries/cheltuieli.ts
M	src/lib/supabase/queries/clienti.ts
M	src/lib/supabase/queries/culegatori.ts
M	src/lib/supabase/queries/investitii.ts
M	src/lib/supabase/queries/parcele.ts
M	src/lib/supabase/queries/recoltari.ts
M	src/lib/supabase/queries/vanzari-butasi.ts
M	src/lib/supabase/queries/vanzari.ts
M	src/lib/supabase/server.ts
D	src/middleware.ts
</file>

<file path="type">

</file>

<file path="vercel">

</file>

<file path="zmeurel@0.1.0">

</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

.vercel
.env*.local
</file>

<file path="README.md">
# ğŸ“ Zmeurel OS - ERP Agricol pentru PlantaÈ›ii ZmeurÄƒ & Mure

**AplicaÈ›ie ERP specializatÄƒ** pentru managementul plantaÈ›iilor de zmeurÄƒ È™i mure, cu focus pe tracking operaÈ›iuni zilnice, profitabilitate, È™i conformitate legalÄƒ.

---

## ğŸ“Š STATUS PROIECT

**Progres MVP:** ~40% complet  
**Ultima actualizare:** 12 Februarie 2026  

### âœ… **Module funcÈ›ionale:**
- **Parcele** - CRUD complet (Create, Read, Update, Delete) âœ…
- **Authentication** - Supabase Auth cu RLS policies âœ…
- **Database** - 11 tabele cu multi-tenant architecture âœ…

### ğŸš§ **Ãn dezvoltare:**
- ClienÈ›i, CulegÄƒtori (next up)
- RecoltÄƒri, VÃ¢nzÄƒri
- Dashboard cu KPIs

---

## ğŸš€ QUICK START

### **Prerequisites:**

- Node.js 18+ (https://nodejs.org)
- Git (https://git-scm.com)
- Cont Supabase (https://supabase.com)
- Editor: VS Code sau Cursor (recomandat)

---

### **1. Clone repository:**

```bash
git clone https://github.com/zmeurelOS-admin/zmeurel-os.git
cd zmeurel-os
```

---

### **2. Install dependencies:**

```bash
npm install
```

**Pachete principale:**
- Next.js 16.1.6 (Turbopack)
- @supabase/ssr
- @tanstack/react-query
- shadcn/ui components
- Tailwind CSS v4 alpha

---

### **3. Configure environment variables:**

CreeazÄƒ fiÈ™ier `.env.local` Ã®n root:

```env
NEXT_PUBLIC_SUPABASE_URL=https://ilybohhdeplwcrbpblqw.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**âš ï¸ ObÈ›ine credenÈ›iale din:**
- Supabase Dashboard â†’ Settings â†’ API
- **Project URL** â†’ `NEXT_PUBLIC_SUPABASE_URL`
- **anon/public key** â†’ `NEXT_PUBLIC_SUPABASE_ANON_KEY`

---

### **4. Start development server:**

```bash
npm run dev
```

**AplicaÈ›ia va rula pe:** http://localhost:3000

---

### **5. Access aplicaÈ›ia:**

**Login:**
- Email: popa.andrei.sv@gmail.com
- Password: [solicitÄƒ la developer]

**Primera paginÄƒ:** http://localhost:3000/parcele

---

## ğŸ—„ï¸ DATABASE SETUP

### **Schema SQL (Supabase):**

**RuleazÄƒ Ã®n SQL Editor (Supabase Dashboard):**

```sql
-- Creare tabele (vezi schema completÄƒ Ã®n documentaÈ›ie)

-- Populare nomenclatoare cu soiuri:
INSERT INTO nomenclatoare (tip, valoare, descriere) VALUES
('Soi', 'Polka', 'ZmeurÄƒ remontantÄƒ, producÈ›ie iulie-septembrie'),
('Soi', 'Tulameen', 'ZmeurÄƒ neremontantÄƒ, producÈ›ie iunie-iulie'),
('Soi', 'Heritage', 'ZmeurÄƒ remontantÄƒ, producÈ›ie toamnÄƒ'),
('Soi', 'Loch Ness', 'Mure fÄƒrÄƒ spini, producÈ›ie iulie-august'),
('Soi', 'Chester', 'Mure fÄƒrÄƒ spini, producÈ›ie tÃ¢rzie august-septembrie');
```

**RLS Policies:**
```sql
-- Tenant isolation (users vÄƒd doar datele lor)
CREATE POLICY "tenant_isolation" ON parcele
FOR SELECT
USING (
  tenant_id IN (
    SELECT id FROM tenants 
    WHERE owner_user_id = auth.uid()
  )
);
```

---

## ğŸ“‚ PROJECT STRUCTURE

```
zmeurel/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (auth)/              # Authentication pages
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ register/
â”‚   â”œâ”€â”€ (dashboard)/         # Main app
â”‚   â”‚   â”œâ”€â”€ layout.tsx       # Dashboard layout + Providers
â”‚   â”‚   â”œâ”€â”€ providers.tsx    # QueryClient + Toaster
â”‚   â”‚   â””â”€â”€ parcele/         # âœ… Parcele module (CRUD)
â”‚   â”‚       â”œâ”€â”€ page.tsx
â”‚   â”‚       â””â”€â”€ ParcelaPageClient.tsx
â”‚   â”œâ”€â”€ globals.css
â”‚   â””â”€â”€ layout.tsx
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                  # shadcn/ui components
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ parcele/             # Parcele-specific components
â”‚       â”œâ”€â”€ ParcelaCard.tsx
â”‚       â”œâ”€â”€ AddParcelaDialog.tsx
â”‚       â”œâ”€â”€ EditParcelaDialog.tsx
â”‚       â””â”€â”€ DeleteConfirmDialog.tsx
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”œâ”€â”€ client.ts        # Browser Supabase client
â”‚   â”‚   â”œâ”€â”€ server.ts        # Server Supabase client
â”‚   â”‚   â””â”€â”€ queries/
â”‚   â”‚       â””â”€â”€ parcele.ts   # CRUD operations
â”‚   â””â”€â”€ utils.ts
â”œâ”€â”€ .env.local               # Environment variables (NOT in git)
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

---

## ğŸ¨ TECH STACK

### **Frontend:**
- **Framework:** Next.js 16.1.6 (App Router + Turbopack)
- **Language:** TypeScript
- **Styling:** Tailwind CSS v4 alpha
- **UI Components:** shadcn/ui (Radix UI primitives)
- **State Management:** TanStack Query (React Query v5)
- **Forms:** React Hook Form + Zod validation
- **Icons:** Lucide React

### **Backend:**
- **Database:** Supabase PostgreSQL
- **Auth:** Supabase Auth
- **Storage:** Supabase Storage (pentru facturi/documente)
- **Realtime:** Supabase Realtime (sync multi-device)

### **Deployment:**
- **Frontend:** Vercel (zmeurel.ro)
- **Backend:** Supabase Cloud
- **CI/CD:** GitHub Actions (planned)

---

## ğŸ” AUTHENTICATION & SECURITY

**Authentication:**
- Email/Password (Supabase Auth)
- Google OAuth (planned)

**Security:**
- Row Level Security (RLS) on all tables
- Multi-tenant isolation (tenant_id filtering)
- Server-side validation
- Environment variables for secrets

**User roles (planned):**
- Owner (full access)
- Admin (manage all data)
- Operator (limited access)

---

## ğŸ› ï¸ DEVELOPMENT WORKFLOW

### **Branching strategy:**

```bash
main         # Production (auto-deploy Vercel)
develop      # Staging
feature/*    # Feature branches â†’ PR â†’ develop
```

### **Commit messages:**

```bash
feat: Add clienÈ›i CRUD module
fix: Recoltari calculation bug
docs: Update README
style: Format with Prettier
```

### **Testing:**

```bash
# Unit tests (planned):
npm test

# E2E tests (planned):
npm run test:e2e

# Linting:
npm run lint
```

---

## ğŸ“š AVAILABLE SCRIPTS

```bash
# Development:
npm run dev              # Start dev server (localhost:3000)

# Build:
npm run build            # Production build
npm run start            # Start production server

# Code quality:
npm run lint             # ESLint
npm run format           # Prettier format
npm run type-check       # TypeScript check
```

---

## ğŸ› DEBUGGING & TROUBLESHOOTING

### **Common issues:**

**1. Module not found errors:**
```bash
# Clear cache and reinstall:
rm -rf node_modules .next
npm install
```

**2. Supabase connection errors:**
- Check `.env.local` has correct credentials
- Verify Supabase project is running
- Test connection: http://localhost:3000/test-supabase (if page exists)

**3. Tailwind CSS not working:**
- Clear Turbopack cache: Delete `.next` folder
- Restart dev server

**4. TypeScript errors:**
```bash
npm run type-check
```

### **Debug tools:**

**Browser DevTools (F12):**
- Console tab â†’ JavaScript errors
- Network tab â†’ API calls
- React DevTools extension

**Terminal logs:**
- All Supabase queries logged with ğŸ” emoji
- Errors logged with âŒ emoji

---

## ğŸ“– DOCUMENTATION

**Full documentation:**
- `PROGRES.md` - Detailed development progress log
- `BACKUP-INSTRUCTIONS.md` - Backup and recovery guide
- Supabase docs: https://supabase.com/docs
- Next.js docs: https://nextjs.org/docs

---

## ğŸ¤ CONTRIBUTING

**Acest proiect este personal momentan.**

DacÄƒ vrei sÄƒ contribui Ã®n viitor:
1. Fork repository
2. Create feature branch (`git checkout -b feature/amazing-feature`)
3. Commit changes (`git commit -m 'Add amazing feature'`)
4. Push to branch (`git push origin feature/amazing-feature`)
5. Open Pull Request

---

## ğŸ“ SUPPORT

**Developer:** Popa Andrei  
**Email:** popa.andrei.sv@gmail.com  
**GitHub:** https://github.com/zmeurelOS-admin/zmeurel-os

**AI Assistant:** Claude (Anthropic)

---

## ğŸ“„ LICENSE

**Proprietar / Private** (momentan)

Planificat pentru viitor: MIT License cÃ¢nd devine open-source / SaaS public.

---

## ğŸ¯ ROADMAP

### **Q1 2026 (Febr-Mar) - MVP Core:**
- [x] Setup proiect + Supabase
- [x] Authentication system
- [x] Modul Parcele (CRUD complet) âœ…
- [ ] Module CRUD simple: ClienÈ›i, CulegÄƒtori
- [ ] Module complexe: RecoltÄƒri, VÃ¢nzÄƒri
- [ ] Dashboard basic cu KPIs

### **Q2 2026 (Apr-Jun) - Feature Completeness:**
- [ ] ActivitÄƒÈ›i Agricole (tratamente, timp pauzÄƒ)
- [ ] InvestiÈ›ii È™i Cheltuieli
- [ ] VÃ¢nzÄƒri ButaÈ™i
- [ ] Upload facturi (Supabase Storage)
- [ ] Export rapoarte (PDF, Excel)

### **Q3 2026 (Jul-Sep) - Polish & Testing:**
- [ ] UI Polish (branding Zmeurel)
- [ ] PWA (offline mode)
- [ ] Multi-user support
- [ ] Beta testing (5-10 fermieri)

### **Q4 2026 (Oct-Dec) - Public Launch:**
- [ ] Landing page (zmeurel.ro)
- [ ] Pricing tiers (Freemium, Starter, Pro)
- [ ] Stripe integration
- [ ] Marketing & SEO

---

## ğŸ† ACHIEVEMENTS

**Sesiunea 12 Februarie 2026:**
- âœ… Modul Parcele 100% funcÈ›ional
- âœ… Supabase @supabase/ssr migration complete
- âœ… Dialog system cu backdrop fix (Tailwind v4 workaround)
- âœ… Native select dropdown working
- âœ… Delete/Edit operations smooth
- âœ… Auto-generated IDs (P001, P002...)
- âœ… Multi-tenant architecture active

**Progress:** 35% â†’ 40% MVP â¬†ï¸

---

## ğŸ’¡ FUN FACTS

**Numele "Zmeurel"** vine de la:
- ğŸ“ **ZmeurÄƒ** (romÃ¢neÈ™te) = Raspberry (engleza)
- **-el** suffix = diminutiv afectuos (ca "cÄƒsuÈ›Äƒ", "iepuraÈ™")

**Logo:** ğŸ“ (emoji zmeurÄƒ pÃ¢nÄƒ la design final)

**Culori branded:**
- Primary: #F16B6B (Bittersweet)
- Secondary: #312E3F (Charade)

---

**De la fermÄƒ la digital - Zmeurel OS! ğŸ“ğŸ’»âœ¨**

*Built with â¤ï¸ È™i foarte mult debugging Ã®n Suceava, RomÃ¢nia*
</file>

<file path="src/app/(dashboard)/activitati-agricole/page.tsx">
// src/app/(dashboard)/activitati-agricole/page.tsx

import { createClient } from '@/lib/supabase/server'
import { ActivitatiAgricolePageClient } from './ActivitatiAgricolePageClient'

export default async function ActivitatiAgricolePage() {
  const supabase = await createClient() // â† important

  const { data: activitati } = await supabase
    .from('activitati_agricole')
    .select('*')
    .order('data_aplicare', { ascending: false })

  const { data: parcele } = await supabase
    .from('parcele')
    .select('id, id_parcela, nume_parcela')
    .order('created_at', { ascending: false })

  return (
    <ActivitatiAgricolePageClient
      initialActivitati={activitati ?? []}
      parcele={parcele ?? []}
    />
  )
}
</file>

<file path="src/app/(dashboard)/cheltuieli/page.tsx">
import { getCheltuieli } from '@/lib/supabase/queries/cheltuieli';
import { CheltuialaPageClient } from './CheltuialaPageClient';

export default async function CheltuieliPage() {
  const cheltuieli = await getCheltuieli();

  return (
    <CheltuialaPageClient
      initialCheltuieli={cheltuieli || []}
    />
  );
}
</file>

<file path="src/app/(dashboard)/culegatori/CulegatorPageClient.tsx">
'use client'

import { useState } from 'react'
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { toast } from 'sonner'
import { Plus } from 'lucide-react'
import { Button } from '@/components/ui/button'

import {
  Culegator,
  getCulegatori,
  createCulegator,
  updateCulegator,
  deleteCulegator,
  CreateCulegatorInput,
  UpdateCulegatorInput,
} from '@/lib/supabase/queries/culegatori'
import { CulegatorCard } from '@/components/culegatori/CulegatorCard'
import { AddCulegatorDialog } from '@/components/culegatori/AddCulegatorDialog'
import { EditCulegatorDialog } from '@/components/culegatori/EditCulegatorDialog'

interface Props {
  initialCulegatori: Culegator[]
}

export function CulegatorPageClient({ initialCulegatori }: Props) {
  const queryClient = useQueryClient()
  const [showAdd, setShowAdd] = useState(false)
  const [editCulegator, setEditCulegator] = useState<Culegator | null>(null)

  const { data: culegatori = initialCulegatori } = useQuery({
    queryKey: ['culegatori'],
    queryFn: getCulegatori,
    initialData: initialCulegatori,
  })

  const createMutation = useMutation({
    mutationFn: async (formData: any) => {
      const input: CreateCulegatorInput = {
        ...formData,
        tarif_lei_kg: parseFloat(formData.tarif_lei_kg),
      }
      return createCulegator(input)
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['culegatori'] })
      toast.success('CulegÄƒtor adÄƒugat!')
      setShowAdd(false)
    },
    onError: (error) => {
      console.error('Error:', JSON.stringify(error))
      toast.error('Eroare la adÄƒugare')
    },
  })

  const updateMutation = useMutation({
    mutationFn: async ({ id, formData }: { id: string; formData: any }) => {
      const input: UpdateCulegatorInput = {
        ...formData,
        tarif_lei_kg: parseFloat(formData.tarif_lei_kg),
      }
      return updateCulegator(id, input)
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['culegatori'] })
      toast.success('CulegÄƒtor actualizat!')
      setEditCulegator(null)
    },
    onError: (error) => {
      console.error('Error:', JSON.stringify(error))
      toast.error('Eroare la actualizare')
    },
  })

  const deleteMutation = useMutation({
    mutationFn: (id: string) => deleteCulegator(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['culegatori'] })
      toast.success('CulegÄƒtor È™ters!')
    },
    onError: (error) => {
      console.error('Error:', JSON.stringify(error))
      toast.error('Eroare la È™tergere')
    },
  })

  const handleDelete = (id: string, name: string) => {
    if (confirm(`È˜tergi culegÄƒtorul "${name}"?`)) {
      deleteMutation.mutate(id)
    }
  }

  return (
    <div className="space-y-4 p-4">
      <div className="flex items-center justify-between">
        <h1 className="text-3xl font-bold">CulegÄƒtori</h1>
        <Button
          onClick={() => setShowAdd(true)}
          style={{ backgroundColor: '#F16B6B', color: 'white' }}
        >
          <Plus className="w-4 h-4 mr-2" />
          AdaugÄƒ CulegÄƒtor
        </Button>
      </div>

      {culegatori.length === 0 ? (
        <div className="text-center py-12 text-muted-foreground">
          <p>Nu existÄƒ culegÄƒtori Ã®nregistraÈ›i.</p>
          <p className="text-sm mt-1">ApasÄƒ "AdaugÄƒ CulegÄƒtor" pentru a Ã®ncepe.</p>
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {culegatori.map((c) => (
            <CulegatorCard
              key={c.id}
              culegator={c}
              onEdit={setEditCulegator}
              onDelete={handleDelete}
            />
          ))}
        </div>
      )}

      <AddCulegatorDialog
        open={showAdd}
        onOpenChange={setShowAdd}
        onSubmit={async (formData) => {
          await createMutation.mutateAsync(formData)
        }}
      />

      {editCulegator && (
        <EditCulegatorDialog
          open={!!editCulegator}
          onOpenChange={(open) => !open && setEditCulegator(null)}
          culegator={editCulegator}
          onSubmit={async (id, formData) => {
            await updateMutation.mutateAsync({ id, formData })
          }}
        />
      )}
    </div>
  )
}
</file>

<file path="src/app/(dashboard)/recoltari/page.tsx">
// src/app/(dashboard)/recoltari/page.tsx

import { createClient } from '@/lib/supabase/server'
import { RecoltariPageClient } from './RecoltariPageClient'

export default async function RecoltariPage() {
  const supabase = await createClient()

  const { data: recoltari } = await supabase
    .from('recoltari')
    .select('*')
    .order('data', { ascending: false })

  const { data: parcele } = await supabase
    .from('parcele')
    .select('id, id_parcela, nume_parcela')
    .order('created_at', { ascending: false })

  return (
    <RecoltariPageClient
      initialRecoltari={recoltari ?? []}
      parcele={parcele ?? []}
    />
  )
}
</file>

<file path="src/app/(dashboard)/vanzari-butasi/page.tsx">
// src/app/(dashboard)/vanzari-butasi/page.tsx

import { cookies } from 'next/headers'
import { createServerClient } from '@supabase/ssr'
import { VanzariButasiPageClient } from './VanzariButasiPageClient'
import type { VanzareButasi } from '@/lib/supabase/queries/vanzari-butasi'

export default async function VanzariButasiPage() {
  const cookieStore = await cookies()

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll()
        },
      },
    }
  )

  // Verificare user autentificat
  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    return <div>Autentificare necesarÄƒ</div>
  }

  // ğŸ”’ RLS-first: fÄƒrÄƒ tenantId, fÄƒrÄƒ .eq('tenant_id')

  const { data: vanzariButasi } = await supabase
    .from('vanzari_butasi')
    .select('*')
    .order('data', { ascending: false })

  const { data: clienti } = await supabase
    .from('clienti')
    .select('id, id_client, nume_client')

  const { data: parcele } = await supabase
    .from('parcele')
    .select('id, id_parcela, nume_parcela')

  // Type-safe fallback pentru null
  const safeVanzari: VanzareButasi[] = vanzariButasi ?? []
  const safeClienti = clienti ?? []
  const safeParcele = parcele ?? []

  return (
    <VanzariButasiPageClient
      initialVanzari={safeVanzari}
      clienti={safeClienti}
      parcele={safeParcele}
    />
  )
}
</file>

<file path="src/components/activitati-agricole/ActivitateAgricolaCard.tsx">
// src/components/activitati-agricole/ActivitateAgricolaCard.tsx
'use client';

import { Card, CardContent, CardHeader } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Pencil, Trash2, Calendar, Package, AlertCircle, CheckCircle } from 'lucide-react';
import { ActivitateAgricola, calculatePauseStatus } from '@/lib/supabase/queries/activitati-agricole';

interface ActivitateAgricolaCardProps {
  activitate: ActivitateAgricola;
  parcelaNume?: string;
  onEdit: (activitate: ActivitateAgricola) => void;
  onDelete: (activitate: ActivitateAgricola) => void;
}

export function ActivitateAgricolaCard({
  activitate,
  parcelaNume,
  onEdit,
  onDelete,
}: ActivitateAgricolaCardProps) {
  // Format date pentru display: DD.MM.YYYY
  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('ro-RO', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
    });
  };

  // Calcul status pauzÄƒ
  const { dataRecoltarePermisa, status } = calculatePauseStatus(
    activitate.data_aplicare,
    activitate.timp_pauza_zile
  );

  // Culori badge tip activitate
  const getBadgeColor = (tip: string) => {
    if (tip.includes('Fungicid')) return 'bg-purple-100 text-purple-800';
    if (tip.includes('Insecticid')) return 'bg-red-100 text-red-800';
    if (tip.includes('Erbicid')) return 'bg-orange-100 text-orange-800';
    if (tip.includes('Fertilizare')) return 'bg-green-100 text-green-800';
    if (tip.includes('Irigare')) return 'bg-blue-100 text-blue-800';
    return 'bg-gray-100 text-gray-800';
  };

  return (
    <Card className="hover:shadow-md transition-shadow">
      <CardHeader className="pb-3">
        <div className="flex items-start justify-between">
          <div className="flex-1">
            {/* ID activitate + Tip */}
            <div className="flex items-center gap-2 mb-2">
              <span className="font-semibold text-lg text-gray-900">
                {activitate.id_activitate}
              </span>
              <span className={`px-2 py-1 rounded-md text-xs font-medium ${getBadgeColor(activitate.tip_activitate || '')}`}>
                {activitate.tip_activitate || 'Altele'}
              </span>
            </div>

            {/* Data aplicare */}
            <div className="flex items-center gap-1.5 text-sm text-gray-600 mb-1">
              <Calendar className="h-4 w-4" />
              <span>Aplicat: {formatDate(activitate.data_aplicare)}</span>
            </div>

            {/* ParcelÄƒ (dacÄƒ existÄƒ) */}
            {activitate.parcela_id && parcelaNume && (
              <div className="flex items-center gap-1.5 text-sm text-gray-600">
                <Package className="h-4 w-4" />
                <span>{parcelaNume}</span>
              </div>
            )}
          </div>

          {/* AcÈ›iuni */}
          <div className="flex gap-1">
            <Button
              variant="ghost"
              size="icon"
              onClick={() => onEdit(activitate)}
              className="h-8 w-8"
            >
              <Pencil className="h-4 w-4" />
            </Button>
            <Button
              variant="ghost"
              size="icon"
              onClick={() => onDelete(activitate)}
              className="h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50"
            >
              <Trash2 className="h-4 w-4" />
            </Button>
          </div>
        </div>
      </CardHeader>

      <CardContent className="pt-0">
        {/* Produs È™i DozÄƒ */}
        {activitate.produs_utilizat && (
          <div className="text-sm mb-2">
            <span className="text-gray-600">Produs:</span>{' '}
            <span className="font-medium text-gray-900">{activitate.produs_utilizat}</span>
            {activitate.doza && ` (${activitate.doza})`}
          </div>
        )}

        {/* Operator */}
        {activitate.operator && (
          <div className="text-sm mb-3 text-gray-600">
            Operator: {activitate.operator}
          </div>
        )}

        {/* Status PauzÄƒ (CRITICAL pentru legislaÈ›ie) */}
        {activitate.timp_pauza_zile > 0 && (
          <div className={`p-3 rounded-lg border mb-3 ${
            status === 'OK' 
              ? 'bg-green-50 border-green-200' 
              : 'bg-yellow-50 border-yellow-200'
          }`}>
            <div className="flex items-center gap-2 mb-2">
              {status === 'OK' ? (
                <CheckCircle className="h-5 w-5 text-green-600" />
              ) : (
                <AlertCircle className="h-5 w-5 text-yellow-600" />
              )}
              <div className="flex-1">
                <div className={`text-sm font-medium ${
                  status === 'OK' ? 'text-green-800' : 'text-yellow-800'
                }`}>
                  Status: {status}
                </div>
              </div>
            </div>
            <div className="text-xs text-gray-600">
              <div>Timp pauzÄƒ: {activitate.timp_pauza_zile} zile</div>
              <div>Recoltare permisÄƒ de la: {formatDate(dataRecoltarePermisa)}</div>
            </div>
          </div>
        )}

        {/* ObservaÈ›ii */}
        {activitate.observatii && (
          <div className="text-sm text-gray-600 border-t pt-2 mt-2">
            {activitate.observatii}
          </div>
        )}
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/cheltuieli/EditCheltuialaDialog.tsx">
// src/components/cheltuieli/EditCheltuialaDialog.tsx
'use client';

import { useState, useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Loader2 } from 'lucide-react';
import type { Cheltuiala } from '@/lib/supabase/queries/cheltuieli';

// ========================================
// CATEGORII CHELTUIELI (din nomenclatoare)
// ========================================

const CATEGORII_CHELTUIELI = [
  'Electricitate',
  'MotorinÄƒ Transport',
  'Ambalaje',
  'Etichete',
  'ReparaÈ›ii Utilaje',
  'Scule',
  'Fertilizare',
  'Pesticide',
  'ÃntreÈ›inere CurentÄƒ',
  'Cules',
  'Material SÄƒditor',
  'Sistem SusÈ›inere',
  'Sistem Irigatie',
  'Altele',
];

// ========================================
// ZOD VALIDATION SCHEMA
// ========================================

const cheltuialaSchema = z.object({
  data: z.string().min(1, 'Data este obligatorie'),
  categorie: z.string().min(1, 'SelecteazÄƒ categoria'),
  suma_lei: z.string().min(1, 'Suma este obligatorie'),
  furnizor: z.string().optional(),
  descriere: z.string().optional(),
});

type CheltuialaFormData = z.infer<typeof cheltuialaSchema>;

// ========================================
// COMPONENT
// ========================================

interface EditCheltuialaDialogProps {
  cheltuiala: Cheltuiala | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onSubmit: (id: string, data: CheltuialaFormData) => Promise<void>;
}

export function EditCheltuialaDialog({
  cheltuiala,
  open,
  onOpenChange,
  onSubmit,
}: EditCheltuialaDialogProps) {
  const [isSubmitting, setIsSubmitting] = useState(false);

  const form = useForm<CheltuialaFormData>({
    resolver: zodResolver(cheltuialaSchema),
    defaultValues: {
      data: '',
      categorie: '',
      suma_lei: '',
      furnizor: '',
      descriere: '',
    },
  });

  // Populate form cÃ¢nd se deschide dialog-ul cu o cheltuialÄƒ
  useEffect(() => {
    if (cheltuiala && open) {
      form.reset({
        data: cheltuiala.data,
        categorie: cheltuiala.categorie || "",
        suma_lei: String(cheltuiala.suma_lei),
        furnizor: cheltuiala.furnizor || '',
        descriere: cheltuiala.descriere || '',
      });
    }
  }, [cheltuiala, open, form]);

  const handleSubmit = async (data: CheltuialaFormData) => {
    if (!cheltuiala) return;

    setIsSubmitting(true);
    try {
      await onSubmit(cheltuiala.id, data);
      onOpenChange(false);
    } catch (error) {
      console.error('Error updating cheltuiala:', error);
    } finally {
      setIsSubmitting(false);
    }
  };

  if (!cheltuiala) return null;

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent
        className="sm:max-w-[600px] max-h-[90vh] overflow-y-auto"
        style={{ backgroundColor: 'white' }}
      >
        <DialogHeader>
          <DialogTitle>
            EditeazÄƒ CheltuialÄƒ: {cheltuiala.id_cheltuiala}
          </DialogTitle>
        </DialogHeader>

        <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-4">
          {/* Data */}
          <div className="space-y-2">
            <Label htmlFor="data">
              Data <span className="text-red-500">*</span>
            </Label>
            <Input
              id="data"
              {...form.register('data')}
              type="date"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            {form.formState.errors.data && (
              <p className="text-sm text-red-500">
                {form.formState.errors.data.message}
              </p>
            )}
          </div>

          {/* Categorie */}
          <div className="space-y-2">
            <Label htmlFor="categorie">
              Categorie <span className="text-red-500">*</span>
            </Label>
            <select
              id="categorie"
              {...form.register('categorie')}
              className="w-full rounded-md border border-input px-3 py-2 text-sm"
              style={{ backgroundColor: 'white', color: 'black' }}
            >
              <option value="">SelecteazÄƒ categoria...</option>
              {CATEGORII_CHELTUIELI.map((cat) => (
                <option key={cat} value={cat}>
                  {cat}
                </option>
              ))}
            </select>
            {form.formState.errors.categorie && (
              <p className="text-sm text-red-500">
                {form.formState.errors.categorie.message}
              </p>
            )}
          </div>

          {/* SumÄƒ */}
          <div className="space-y-2">
            <Label htmlFor="suma_lei">
              SumÄƒ (lei) <span className="text-red-500">*</span>
            </Label>
            <Input
              id="suma_lei"
              {...form.register('suma_lei')}
              type="number"
              step="0.01"
              min="0"
              placeholder="Ex: 150.50"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            {form.formState.errors.suma_lei && (
              <p className="text-sm text-red-500">
                {form.formState.errors.suma_lei.message}
              </p>
            )}
          </div>

          {/* Furnizor */}
          <div className="space-y-2">
            <Label htmlFor="furnizor">Furnizor / Magazin</Label>
            <Input
              id="furnizor"
              {...form.register('furnizor')}
              placeholder="Ex: Lidl, Dedeman, Petrom"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
          </div>

          {/* Descriere */}
          <div className="space-y-2">
            <Label htmlFor="descriere">Descriere</Label>
            <Textarea
              id="descriere"
              {...form.register('descriere')}
              placeholder="Ex: Electricitate casÄƒ + pompÄƒ. Factura nr. 12345"
              rows={3}
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            <p className="text-xs text-muted-foreground">
              Detalii suplimentare despre cheltuialÄƒ (numÄƒr facturÄƒ, etc.)
            </p>
          </div>

          <DialogFooter>
            <Button
              type="button"
              variant="outline"
              onClick={() => onOpenChange(false)}
              disabled={isSubmitting}
            >
              AnuleazÄƒ
            </Button>
            <Button
              type="submit"
              disabled={isSubmitting}
              style={{ backgroundColor: '#F16B6B', color: 'white' }}
            >
              {isSubmitting ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  Se salveazÄƒ...
                </>
              ) : (
                'SalveazÄƒ ModificÄƒri'
              )}
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/clienti/AddClientDialog.tsx">
// src/components/clienti/AddClientDialog.tsx
'use client';

import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Loader2 } from 'lucide-react';

// ========================================
// ZOD VALIDATION SCHEMA
// ========================================

const clientSchema = z.object({
  nume_client: z.string().min(2, 'Numele trebuie sÄƒ aibÄƒ minim 2 caractere'),
  telefon: z.string().optional(),
  email: z.string().email('Email invalid').or(z.literal('')).optional(),
  adresa: z.string().optional(),
  pret_negociat_lei_kg: z.string().optional(),
  observatii: z.string().optional(),
});

type ClientFormData = z.infer<typeof clientSchema>;

// ========================================
// COMPONENT
// ========================================

interface AddClientDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onSubmit: (data: ClientFormData) => Promise<void>;
}

export function AddClientDialog({
  open,
  onOpenChange,
  onSubmit,
}: AddClientDialogProps) {
  const [isSubmitting, setIsSubmitting] = useState(false);

  const form = useForm<ClientFormData>({
    resolver: zodResolver(clientSchema),
    defaultValues: {
      nume_client: '',
      telefon: '',
      email: '',
      adresa: '',
      pret_negociat_lei_kg: '',
      observatii: '',
    },
  });

  const handleSubmit = async (data: ClientFormData) => {
    setIsSubmitting(true);
    try {
      await onSubmit(data);
      form.reset();
      onOpenChange(false);
    } catch (error) {
      console.error('Error creating client:', JSON.stringify(error, null, 2));
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent
        className="sm:max-w-[500px] max-h-[75vh] overflow-y-auto"
        style={{ backgroundColor: 'white' }}
      >
        <DialogHeader>
          <DialogTitle>AdaugÄƒ Client Nou</DialogTitle>
        </DialogHeader>

        <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-3">
          {/* Nume Client */}
          <div className="space-y-1">
            <Label htmlFor="nume_client" className="text-sm">
              Nume Client <span className="text-red-500">*</span>
            </Label>
            <Input
              id="nume_client"
              {...form.register('nume_client')}
              placeholder="Ex: Restaurant La ZmeurÄƒ"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            {form.formState.errors.nume_client && (
              <p className="text-xs text-red-500">
                {form.formState.errors.nume_client.message}
              </p>
            )}
          </div>

          {/* Telefon */}
          <div className="space-y-1">
            <Label htmlFor="telefon" className="text-sm">Telefon</Label>
            <Input
              id="telefon"
              {...form.register('telefon')}
              placeholder="Ex: 0740123456"
              type="tel"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
          </div>

          {/* Email */}
          <div className="space-y-1">
            <Label htmlFor="email" className="text-sm">Email</Label>
            <Input
              id="email"
              {...form.register('email')}
              placeholder="Ex: contact@restaurant.ro"
              type="email"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            {form.formState.errors.email && (
              <p className="text-xs text-red-500">
                {form.formState.errors.email.message}
              </p>
            )}
          </div>

          {/* AdresÄƒ */}
          <div className="space-y-1">
            <Label htmlFor="adresa" className="text-sm">AdresÄƒ</Label>
            <Textarea
              id="adresa"
              {...form.register('adresa')}
              placeholder="Ex: Str. PrincipalÄƒ nr. 10, Suceava"
              rows={2}
              style={{ backgroundColor: 'white', color: 'black' }}
            />
          </div>

          {/* PreÈ› Negociat */}
          <div className="space-y-1">
            <Label htmlFor="pret_negociat_lei_kg" className="text-sm">
              PreÈ› Negociat (lei/kg)
            </Label>
            <Input
              id="pret_negociat_lei_kg"
              {...form.register('pret_negociat_lei_kg')}
              type="number"
              step="0.01"
              min="0"
              placeholder="Ex: 12.50"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            <p className="text-xs text-gray-500">
              LasÄƒ gol pentru preÈ› standard
            </p>
          </div>

          {/* ObservaÈ›ii */}
          <div className="space-y-1">
            <Label htmlFor="observatii" className="text-sm">ObservaÈ›ii</Label>
            <Textarea
              id="observatii"
              {...form.register('observatii')}
              placeholder="Ex: Are 15 lÄƒdiÈ›e returnabile"
              rows={2}
              style={{ backgroundColor: 'white', color: 'black' }}
            />
          </div>

          <DialogFooter className="pt-2">
            <Button
              type="button"
              variant="outline"
              onClick={() => onOpenChange(false)}
              disabled={isSubmitting}
            >
              AnuleazÄƒ
            </Button>
            <Button
              type="submit"
              disabled={isSubmitting}
              style={{ backgroundColor: '#F16B6B', color: 'white' }}
            >
              {isSubmitting ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  Se salveazÄƒ...
                </>
              ) : (
                'SalveazÄƒ Client'
              )}
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/clienti/ClientCard.tsx">
// src/components/clienti/ClientCard.tsx
'use client';

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Pencil, Trash2, User, Phone, Mail, MapPin, Coins, FileText } from 'lucide-react';
import type { Client } from '@/lib/supabase/queries/clienti';

interface ClientCardProps {
  client: Client;
  onEdit: (client: Client) => void;
  onDelete: (id: string, name: string) => void;
}

export function ClientCard({ client, onEdit, onDelete }: ClientCardProps) {
  const hasPretNegociat = client.pret_negociat_lei_kg !== null && client.pret_negociat_lei_kg > 0;

  return (
    <Card className="hover:shadow-lg transition-shadow">
      <CardHeader className="pb-3">
        <div className="flex items-start justify-between">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center">
              <User className="w-6 h-6 text-primary" />
            </div>
            <div>
              <CardTitle className="text-lg font-semibold">
                {client.nume_client}
              </CardTitle>
              <p className="text-sm text-muted-foreground mt-1">
                ID: {client.id}
              </p>
            </div>
          </div>
          
          {/* PreÈ› negociat badge */}
          {hasPretNegociat && (
            <Badge
              style={{
                backgroundColor: '#10b981',
                color: 'white',
              }}
            >
              PreÈ› special
            </Badge>
          )}
        </div>
      </CardHeader>

      <CardContent className="space-y-3">
        {/* Telefon */}
        {client.telefon && (
          <div className="flex items-center gap-2 text-sm">
            <Phone className="w-4 h-4 text-muted-foreground" />
            <a 
              href={`tel:${client.telefon}`}
              className="hover:text-primary"
            >
              {client.telefon}
            </a>
          </div>
        )}

        {/* Email */}
        {client.email && (
          <div className="flex items-center gap-2 text-sm">
            <Mail className="w-4 h-4 text-muted-foreground" />
            <a 
              href={`mailto:${client.email}`}
              className="hover:text-primary truncate"
            >
              {client.email}
            </a>
          </div>
        )}

        {/* AdresÄƒ */}
        {client.adresa && (
          <div className="flex items-start gap-2 text-sm">
            <MapPin className="w-4 h-4 text-muted-foreground mt-0.5" />
            <span className="text-muted-foreground">{client.adresa}</span>
          </div>
        )}

        {/* PreÈ› negociat */}
        {hasPretNegociat && (
          <div className="flex items-center gap-2 text-sm">
            <Coins className="w-4 h-4 text-muted-foreground" />
            <span className="font-semibold text-green-600">
              {client.pret_negociat_lei_kg} lei/kg
            </span>
            <span className="text-xs text-muted-foreground">(preÈ› special)</span>
          </div>
        )}

        {/* ObservaÈ›ii */}
        {client.observatii && (
          <div className="flex items-start gap-2 text-sm">
            <FileText className="w-4 h-4 text-muted-foreground mt-0.5" />
            <span className="text-muted-foreground text-xs">
              {client.observatii}
            </span>
          </div>
        )}

        {/* Action buttons */}
        <div className="flex gap-2 pt-3 border-t">
          <Button
            variant="outline"
            size="sm"
            className="flex-1"
            onClick={() => onEdit(client)}
          >
            <Pencil className="w-4 h-4 mr-2" />
            EditeazÄƒ
          </Button>
          <Button
            variant="outline"
            size="sm"
            style={{ color: '#ef4444', borderColor: '#ef4444' }}
            onClick={() => onDelete(client.id, client.nume_client)}
          >
            <Trash2 className="w-4 h-4" />
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/clienti/EditClientDialog.tsx">
// src/components/clienti/EditClientDialog.tsx
'use client';

import { useState, useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Loader2 } from 'lucide-react';
import type { Client } from '@/lib/supabase/queries/clienti';

// ========================================
// ZOD VALIDATION SCHEMA
// ========================================

const clientSchema = z.object({
  nume: z.string().min(2, 'Numele trebuie sÄƒ aibÄƒ minim 2 caractere'),
  telefon: z.string().optional(),
  email: z.string().email('Email invalid').or(z.literal('')).optional(),
  adresa: z.string().optional(),
  pret_negociat_lei_kg: z.string().optional(),
  observatii: z.string().optional(),
});

type ClientFormData = z.infer<typeof clientSchema>;

// ========================================
// COMPONENT
// ========================================

interface EditClientDialogProps {
  client: Client | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onSubmit: (id: string, data: ClientFormData) => Promise<void>;
}

export function EditClientDialog({
  client,
  open,
  onOpenChange,
  onSubmit,
}: EditClientDialogProps) {
  const [isSubmitting, setIsSubmitting] = useState(false);

  const form = useForm<ClientFormData>({
    resolver: zodResolver(clientSchema),
    defaultValues: {
      nume: '',
      telefon: '',
      email: '',
      adresa: '',
      pret_negociat_lei_kg: '',
      observatii: '',
    },
  });

  // Populate form cÃ¢nd se deschide dialog-ul cu un client
  useEffect(() => {
    if (client && open) {
      form.reset({
        nume: client.nume_client,
        telefon: client.telefon || '',
        email: client.email || '',
        adresa: client.adresa || '',
        pret_negociat_lei_kg: client.pret_negociat_lei_kg 
          ? String(client.pret_negociat_lei_kg) 
          : '',
        observatii: client.observatii || '',
      });
    }
  }, [client, open, form]);

  const handleSubmit = async (data: ClientFormData) => {
    if (!client) return;

    setIsSubmitting(true);
    try {
      await onSubmit(client.id, data);
      onOpenChange(false);
    } catch (error) {
      console.error('Error updating client:', error);
    } finally {
      setIsSubmitting(false);
    }
  };

  if (!client) return null;

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent
        className="sm:max-w-[600px] max-h-[90vh] overflow-y-auto"
        style={{ backgroundColor: 'white' }}
      >
        <DialogHeader>
          <DialogTitle>
            EditeazÄƒ Client: {client.id}
          </DialogTitle>
        </DialogHeader>

        <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-4">
          {/* Nume Client */}
          <div className="space-y-2">
            <Label htmlFor="nume">
              Nume Client <span className="text-red-500">*</span>
            </Label>
            <Input
              id="nume"
              {...form.register('nume')}
              placeholder="Ex: Restaurant La ZmeurÄƒ"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            {form.formState.errors.nume && (
              <p className="text-sm text-red-500">
                {form.formState.errors.nume.message}
              </p>
            )}
          </div>

          {/* Telefon */}
          <div className="space-y-2">
            <Label htmlFor="telefon">Telefon</Label>
            <Input
              id="telefon"
              {...form.register('telefon')}
              placeholder="Ex: 0740123456"
              type="tel"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
          </div>

          {/* Email */}
          <div className="space-y-2">
            <Label htmlFor="email">Email</Label>
            <Input
              id="email"
              {...form.register('email')}
              placeholder="Ex: contact@restaurant.ro"
              type="email"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            {form.formState.errors.email && (
              <p className="text-sm text-red-500">
                {form.formState.errors.email.message}
              </p>
            )}
          </div>

          {/* AdresÄƒ */}
          <div className="space-y-2">
            <Label htmlFor="adresa">AdresÄƒ</Label>
            <Textarea
              id="adresa"
              {...form.register('adresa')}
              placeholder="Ex: Str. PrincipalÄƒ nr. 10, Suceava"
              rows={2}
              style={{ backgroundColor: 'white', color: 'black' }}
            />
          </div>

          {/* PreÈ› Negociat */}
          <div className="space-y-2">
            <Label htmlFor="pret_negociat_lei_kg">
              PreÈ› Negociat (lei/kg)
            </Label>
            <Input
              id="pret_negociat_lei_kg"
              {...form.register('pret_negociat_lei_kg')}
              type="number"
              step="0.01"
              min="0"
              placeholder="Ex: 12.50 (lasÄƒ gol pentru preÈ› standard)"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            <p className="text-xs text-muted-foreground">
              LasÄƒ gol dacÄƒ clientul plÄƒteÈ™te preÈ›ul standard (fÄƒrÄƒ negociere)
            </p>
          </div>

          {/* ObservaÈ›ii */}
          <div className="space-y-2">
            <Label htmlFor="observatii">ObservaÈ›ii</Label>
            <Textarea
              id="observatii"
              {...form.register('observatii')}
              placeholder="Ex: Are 15 lÄƒdiÈ›e returnabile. PreferÄƒ livrare marÈ›i."
              rows={3}
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            <p className="text-xs text-muted-foreground">
              Tracking lÄƒdiÈ›e returnabile, preferinÈ›e livrare, etc.
            </p>
          </div>

          <DialogFooter>
            <Button
              type="button"
              variant="outline"
              onClick={() => onOpenChange(false)}
              disabled={isSubmitting}
            >
              AnuleazÄƒ
            </Button>
            <Button
              type="submit"
              disabled={isSubmitting}
              style={{ backgroundColor: '#F16B6B', color: 'white' }}
            >
              {isSubmitting ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  Se salveazÄƒ...
                </>
              ) : (
                'SalveazÄƒ ModificÄƒri'
              )}
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/culegatori/AddCulegatorDialog.tsx">
// src/components/culegatori/AddCulegatorDialog.tsx
'use client';

import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Loader2 } from 'lucide-react';

// ========================================
// ZOD VALIDATION SCHEMA
// ========================================

const culegatorSchema = z.object({
  nume_prenume: z.string().min(2, 'Numele trebuie sÄƒ aibÄƒ minim 2 caractere'),
  telefon: z.string().optional(),
  tip_angajare: z.string().min(1, 'SelecteazÄƒ tipul de angajare'),
  tarif_lei_kg: z.string().min(0, 'Tariful trebuie sÄƒ fie mai mare sau egal cu 0'),
  data_angajare: z.string().optional(),
  status_activ: z.boolean().optional(),
});

type CulegatorFormData = z.infer<typeof culegatorSchema>;

// ========================================
// COMPONENT
// ========================================

interface AddCulegatorDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onSubmit: (data: CulegatorFormData) => Promise<void>;
}

export function AddCulegatorDialog({
  open,
  onOpenChange,
  onSubmit,
}: AddCulegatorDialogProps) {
  const [isSubmitting, setIsSubmitting] = useState(false);

  const form = useForm<CulegatorFormData>({
    resolver: zodResolver(culegatorSchema),
    defaultValues: {
      nume_prenume: '',
      telefon: '',
      tip_angajare: 'Sezonier',
      tarif_lei_kg: '0',
      data_angajare: '',
      status_activ: true,
    },
  });

  const handleSubmit = async (data: CulegatorFormData) => {
    setIsSubmitting(true);
    try {
      await onSubmit(data);
      form.reset();
      onOpenChange(false);
    } catch (error) {
      console.error('Error creating culegator:', error);
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent
        className="sm:max-w-[500px]"
        style={{ backgroundColor: 'white' }}
      >
        <DialogHeader>
          <DialogTitle>AdaugÄƒ CulegÄƒtor Nou</DialogTitle>
        </DialogHeader>

        <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-4">
          {/* Nume Prenume */}
          <div className="space-y-2">
            <Label htmlFor="nume_prenume">
              Nume È™i Prenume <span className="text-red-500">*</span>
            </Label>
            <Input
              id="nume_prenume"
              {...form.register('nume_prenume')}
              placeholder="Ex: Popescu Ion"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            {form.formState.errors.nume_prenume && (
              <p className="text-sm text-red-500">
                {form.formState.errors.nume_prenume.message}
              </p>
            )}
          </div>

          {/* Telefon */}
          <div className="space-y-2">
            <Label htmlFor="telefon">Telefon</Label>
            <Input
              id="telefon"
              {...form.register('telefon')}
              placeholder="Ex: 0740123456"
              type="tel"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
          </div>

          {/* Tip Angajare */}
          <div className="space-y-2">
            <Label htmlFor="tip_angajare">
              Tip Angajare <span className="text-red-500">*</span>
            </Label>
            <select
              id="tip_angajare"
              {...form.register('tip_angajare')}
              className="w-full rounded-md border border-input px-3 py-2 text-sm"
              style={{ backgroundColor: 'white', color: 'black' }}
            >
              <option value="Sezonier">Sezonier</option>
              <option value="Permanent">Permanent</option>
              <option value="Zilier">Zilier</option>
              <option value="Colaborator">Colaborator</option>
            </select>
            {form.formState.errors.tip_angajare && (
              <p className="text-sm text-red-500">
                {form.formState.errors.tip_angajare.message}
              </p>
            )}
          </div>

          {/* Tarif lei/kg */}
          <div className="space-y-2">
            <Label htmlFor="tarif_lei_kg">Tarif (lei/kg)</Label>
            <Input
              id="tarif_lei_kg"
              {...form.register('tarif_lei_kg')}
              type="number"
              step="0.01"
              min="0"
              placeholder="Ex: 2.5 (0 = salarizat fix)"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            <p className="text-xs text-muted-foreground">
              LasÄƒ 0 pentru culegÄƒtori salarizaÈ›i fix (nu plÄƒtiÈ›i la kg)
            </p>
            {form.formState.errors.tarif_lei_kg && (
              <p className="text-sm text-red-500">
                {form.formState.errors.tarif_lei_kg.message}
              </p>
            )}
          </div>

          {/* Data Angajare */}
          <div className="space-y-2">
            <Label htmlFor="data_angajare">Data Angajare</Label>
            <Input
              id="data_angajare"
              {...form.register('data_angajare')}
              type="date"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
          </div>

          {/* Status Activ */}
          <div className="flex items-center space-x-2">
            <input
              id="status_activ"
              type="checkbox"
              {...form.register('status_activ')}
              className="w-4 h-4"
              defaultChecked
            />
            <Label htmlFor="status_activ" className="font-normal cursor-pointer">
              CulegÄƒtor activ (bifeazÄƒ pentru activ)
            </Label>
          </div>

          <DialogFooter>
            <Button
              type="button"
              variant="outline"
              onClick={() => onOpenChange(false)}
              disabled={isSubmitting}
            >
              AnuleazÄƒ
            </Button>
            <Button
              type="submit"
              disabled={isSubmitting}
              style={{ backgroundColor: '#F16B6B', color: 'white' }}
            >
              {isSubmitting ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  Se salveazÄƒ...
                </>
              ) : (
                'SalveazÄƒ CulegÄƒtor'
              )}
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/culegatori/CulegatorCard.tsx">
// src/components/culegatori/CulegatorCard.tsx
'use client';

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Pencil, Trash2, User, Phone, Calendar, Briefcase, Coins } from 'lucide-react';
import type { Culegator } from '@/lib/supabase/queries/culegatori';

interface CulegatorCardProps {
  culegator: Culegator;
  onEdit: (culegator: Culegator) => void;
  onDelete: (id: string, name: string) => void;
}

export function CulegatorCard({ culegator, onEdit, onDelete }: CulegatorCardProps) {
  return (
    <Card className="hover:shadow-lg transition-shadow">
      <CardHeader className="pb-3">
        <div className="flex items-start justify-between">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center">
              <User className="w-6 h-6 text-primary" />
            </div>
            <div>
              <CardTitle className="text-lg font-semibold">
                {culegator.nume_prenume}
              </CardTitle>
              <p className="text-sm text-muted-foreground mt-1">
                ID: {culegator.id_culegator}
              </p>
            </div>
          </div>
          
          {/* Status badge */}
          <Badge
            style={{
              backgroundColor: culegator.status_activ ? '#10b981' : '#6b7280',
              color: 'white',
            }}
          >
            {culegator.status_activ ? 'Activ' : 'Inactiv'}
          </Badge>
        </div>
      </CardHeader>

      <CardContent className="space-y-3">
        {/* Telefon */}
        {culegator.telefon && (
          <div className="flex items-center gap-2 text-sm">
            <Phone className="w-4 h-4 text-muted-foreground" />
            <a 
              href={`tel:${culegator.telefon}`}
              className="hover:text-primary"
            >
              {culegator.telefon}
            </a>
          </div>
        )}

        {/* Tip angajare */}
        {culegator.tip_angajare && (
          <div className="flex items-center gap-2 text-sm">
            <Briefcase className="w-4 h-4 text-muted-foreground" />
            <span className="text-muted-foreground">{culegator.tip_angajare}</span>
          </div>
        )}

        {/* Tarif */}
        <div className="flex items-center gap-2 text-sm">
          <Coins className="w-4 h-4 text-muted-foreground" />
          <span className="font-semibold text-green-600">
            {culegator.tarif_lei_kg} lei/kg
          </span>
          {culegator.tarif_lei_kg === 0 && (
            <span className="text-xs text-muted-foreground">(salarizat fix)</span>
          )}
        </div>

        {/* Data angajare */}
        {culegator.data_angajare && (
          <div className="flex items-center gap-2 text-sm">
            <Calendar className="w-4 h-4 text-muted-foreground" />
            <span className="text-muted-foreground">
              {new Date(culegator.data_angajare).toLocaleDateString('ro-RO')}
            </span>
          </div>
        )}

        {/* Action buttons */}
        <div className="flex gap-2 pt-3 border-t">
          <Button
            variant="outline"
            size="sm"
            className="flex-1"
            onClick={() => onEdit(culegator)}
          >
            <Pencil className="w-4 h-4 mr-2" />
            EditeazÄƒ
          </Button>
          <Button
            variant="outline"
            size="sm"
            style={{ color: '#ef4444', borderColor: '#ef4444' }}
            onClick={() => onDelete(culegator.id, culegator.nume_prenume)}
          >
            <Trash2 className="w-4 h-4" />
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/culegatori/EditCulegatorDialog.tsx">
// src/components/culegatori/EditCulegatorDialog.tsx
'use client';

import { useState, useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Loader2 } from 'lucide-react';
import type { Culegator } from '@/lib/supabase/queries/culegatori';

// ========================================
// ZOD VALIDATION SCHEMA
// ========================================

const culegatorSchema = z.object({
  nume_prenume: z.string().min(2, 'Numele trebuie sÄƒ aibÄƒ minim 2 caractere'),
  telefon: z.string().optional(),
  tip_angajare: z.string().min(1, 'SelecteazÄƒ tipul de angajare'),
  tarif_lei_kg: z.string().min(0, 'Tariful trebuie sÄƒ fie mai mare sau egal cu 0'),
  data_angajare: z.string().optional(),
  status_activ: z.boolean(),
});

type CulegatorFormData = z.infer<typeof culegatorSchema>;

// ========================================
// COMPONENT
// ========================================

interface EditCulegatorDialogProps {
  culegator: Culegator | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onSubmit: (id: string, data: CulegatorFormData) => Promise<void>;
}

export function EditCulegatorDialog({
  culegator,
  open,
  onOpenChange,
  onSubmit,
}: EditCulegatorDialogProps) {
  const [isSubmitting, setIsSubmitting] = useState(false);

  const form = useForm<CulegatorFormData>({
    resolver: zodResolver(culegatorSchema),
    defaultValues: {
      nume_prenume: '',
      telefon: '',
      tip_angajare: 'Sezonier',
      tarif_lei_kg: '0',
      data_angajare: '',
      status_activ: true,
    },
  });

  // Populate form cÃ¢nd se deschide dialog-ul cu un culegÄƒtor
  useEffect(() => {
    if (culegator && open) {
      form.reset({
        nume_prenume: culegator.nume_prenume,
        telefon: culegator.telefon ?? '',
        tip_angajare: culegator.tip_angajare ?? '',
        tarif_lei_kg: culegator.tarif_lei_kg.toString(),
        data_angajare: culegator.data_angajare ?? '',
        status_activ: culegator.status_activ,
      });
    }
  }, [culegator, open, form]);

  const handleSubmit = async (data: CulegatorFormData) => {
    if (!culegator) return;

    setIsSubmitting(true);
    try {
      await onSubmit(culegator.id, data);
      onOpenChange(false);
    } catch (error) {
      console.error('Error updating culegator:', error);
    } finally {
      setIsSubmitting(false);
    }
  };

  if (!culegator) return null;

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent
        className="sm:max-w-[500px]"
        style={{ backgroundColor: 'white' }}
      >
        <DialogHeader>
          <DialogTitle>
            EditeazÄƒ CulegÄƒtor: {culegator.id_culegator}
          </DialogTitle>
        </DialogHeader>

        <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-4">
          {/* Nume Prenume */}
          <div className="space-y-2">
            <Label htmlFor="nume_prenume">
              Nume È™i Prenume <span className="text-red-500">*</span>
            </Label>
            <Input
              id="nume_prenume"
              {...form.register('nume_prenume')}
              placeholder="Ex: Popescu Ion"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            {form.formState.errors.nume_prenume && (
              <p className="text-sm text-red-500">
                {form.formState.errors.nume_prenume.message}
              </p>
            )}
          </div>

          {/* Telefon */}
          <div className="space-y-2">
            <Label htmlFor="telefon">Telefon</Label>
            <Input
              id="telefon"
              {...form.register('telefon')}
              placeholder="Ex: 0740123456"
              type="tel"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
          </div>

          {/* Tip Angajare */}
          <div className="space-y-2">
            <Label htmlFor="tip_angajare">
              Tip Angajare <span className="text-red-500">*</span>
            </Label>
            <select
              id="tip_angajare"
              {...form.register('tip_angajare')}
              className="w-full rounded-md border border-input px-3 py-2 text-sm"
              style={{ backgroundColor: 'white', color: 'black' }}
            >
              <option value="Sezonier">Sezonier</option>
              <option value="Permanent">Permanent</option>
              <option value="Zilier">Zilier</option>
              <option value="Colaborator">Colaborator</option>
            </select>
            {form.formState.errors.tip_angajare && (
              <p className="text-sm text-red-500">
                {form.formState.errors.tip_angajare.message}
              </p>
            )}
          </div>

          {/* Tarif lei/kg */}
          <div className="space-y-2">
            <Label htmlFor="tarif_lei_kg">Tarif (lei/kg)</Label>
            <Input
              id="tarif_lei_kg"
              {...form.register('tarif_lei_kg')}
              type="number"
              step="0.01"
              min="0"
              placeholder="Ex: 2.5 (0 = salarizat fix)"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
            <p className="text-xs text-muted-foreground">
              LasÄƒ 0 pentru culegÄƒtori salarizaÈ›i fix (nu plÄƒtiÈ›i la kg)
            </p>
            {form.formState.errors.tarif_lei_kg && (
              <p className="text-sm text-red-500">
                {form.formState.errors.tarif_lei_kg.message}
              </p>
            )}
          </div>

          {/* Data Angajare */}
          <div className="space-y-2">
            <Label htmlFor="data_angajare">Data Angajare</Label>
            <Input
              id="data_angajare"
              {...form.register('data_angajare')}
              type="date"
              style={{ backgroundColor: 'white', color: 'black' }}
            />
          </div>

          {/* Status Activ */}
          <div className="flex items-center space-x-2">
            <input
              id="status_activ"
              type="checkbox"
              {...form.register('status_activ')}
              className="w-4 h-4"
            />
            <Label htmlFor="status_activ" className="font-normal cursor-pointer">
              CulegÄƒtor activ
            </Label>
          </div>

          <DialogFooter>
            <Button
              type="button"
              variant="outline"
              onClick={() => onOpenChange(false)}
              disabled={isSubmitting}
            >
              AnuleazÄƒ
            </Button>
            <Button
              type="submit"
              disabled={isSubmitting}
              style={{ backgroundColor: '#F16B6B', color: 'white' }}
            >
              {isSubmitting ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  Se salveazÄƒ...
                </>
              ) : (
                'SalveazÄƒ ModificÄƒri'
              )}
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/LogoutButton.tsx">
'use client';

import { useRouter } from 'next/navigation';
import { useState } from 'react';
import { createClient } from '@/lib/supabase/client';

export default function LogoutButton() {
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(false);

  const handleLogout = async () => {
    try {
      setIsLoading(true);
      const supabase = createClient();
      const { error } = await supabase.auth.signOut();
      
      if (error) {
        console.error('Eroare logout:', error);
        alert('Eroare la deconectare. ÃncearcÄƒ din nou.');
        return;
      }

      // Redirect la login
      router.push('/login');
      router.refresh();
    } catch (err) {
      console.error('Eroare logout:', err);
      alert('Eroare la deconectare. ÃncearcÄƒ din nou.');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <button
      onClick={handleLogout}
      disabled={isLoading}
      className="px-4 py-2 text-sm font-medium text-white bg-red-500 rounded-lg hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
    >
      {isLoading ? 'Se deconecteazÄƒ...' : 'ğŸšª IeÈ™ire'}
    </button>
  );
}
</file>

<file path="src/components/parcele/ParcelaCard.tsx">
'use client';

import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader } from '@/components/ui/card';
import { Pencil, Trash2 } from 'lucide-react';

interface Parcela {
  id: string;
  id_parcela: string;
  nume_parcela: string;
  suprafata_m2: number;
  soi_plantat: string | null;
  an_plantare: number;
  nr_plante: number | null;
  status: string;
  gps_lat: number | null;
  gps_lng: number | null;
  observatii: string | null;
  created_at: string;
  updated_at: string;
}

interface ParcelaCardProps {
  parcela: Parcela;
  onEdit: () => void;
  onDelete: () => void;
}

export function ParcelaCard({ parcela, onEdit, onDelete }: ParcelaCardProps) {
  const varstaAni = new Date().getFullYear() - parcela.an_plantare;
  const densitateM2 =
    parcela.nr_plante && parcela.suprafata_m2 > 0
      ? parcela.nr_plante / parcela.suprafata_m2
      : 0;

  return (
    <Card className="hover:shadow-lg transition-shadow duration-200">
      <CardHeader className="pb-3">
        <div className="flex items-start justify-between">
          <div>
            <div className="flex items-center gap-2 mb-1">
              <Badge variant="outline" className="text-xs font-mono">
                {parcela.id_parcela}
              </Badge>
              <Badge
                variant={parcela.status === 'Activ' ? 'default' : 'secondary'}
                className="text-xs"
              >
                {parcela.status}
              </Badge>
            </div>
            <h3 className="text-xl font-bold text-gray-900">
              {parcela.nume_parcela}
            </h3>
          </div>
          <span className="text-3xl">ğŸŒ±</span>
        </div>
      </CardHeader>

      <CardContent className="space-y-4">
        {parcela.soi_plantat && (
          <div className="flex items-center gap-2">
            <span className="text-2xl">ğŸ“</span>
            <span className="text-sm font-medium text-gray-700">
              {parcela.soi_plantat}
            </span>
          </div>
        )}

        <div className="grid grid-cols-2 gap-3">
          <div className="bg-gray-50 p-3 rounded-lg">
            <div className="text-xs text-gray-600 mb-1">SuprafaÈ›Äƒ</div>
            <div className="text-lg font-bold text-[#312E3F]">
              {parcela.suprafata_m2} mÂ²
            </div>
          </div>

          <div className="bg-gray-50 p-3 rounded-lg">
            <div className="text-xs text-gray-600 mb-1">An Plantare</div>
            <div className="text-lg font-bold text-[#312E3F]">
              {parcela.an_plantare}
              {varstaAni > 0 && (
                <span className="text-xs text-gray-500 ml-1">
                  ({varstaAni} {varstaAni === 1 ? 'an' : 'ani'})
                </span>
              )}
            </div>
          </div>

          {parcela.nr_plante && (
            <div className="bg-gray-50 p-3 rounded-lg">
              <div className="text-xs text-gray-600 mb-1">Plante</div>
              <div className="text-lg font-bold text-[#312E3F]">
                {parcela.nr_plante}
              </div>
            </div>
          )}

          {parcela.nr_plante && parcela.suprafata_m2 > 0 && (
            <div className="bg-gray-50 p-3 rounded-lg">
              <div className="text-xs text-gray-600 mb-1">Densitate</div>
              <div className="text-lg font-bold text-[#312E3F]">
                {densitateM2.toFixed(2)} pl/mÂ²
              </div>
            </div>
          )}
        </div>

        {parcela.observatii && (
          <div className="text-sm text-gray-600 italic border-l-2 border-gray-300 pl-3">
            {parcela.observatii}
          </div>
        )}

        <div className="flex gap-2 pt-2">
          <Button
            onClick={onEdit}
            variant="outline"
            size="sm"
            className="flex-1 hover:bg-gray-100"
          >
            <Pencil className="h-4 w-4 mr-2" />
            EditeazÄƒ
          </Button>
          <Button
            onClick={onDelete}
            variant="outline"
            size="sm"
            className="flex-1 text-red-600 hover:bg-red-50 hover:text-red-700 border-red-200"
          >
            <Trash2 className="h-4 w-4 mr-2" />
            È˜terge
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/ui/textarea.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>

const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          "flex min-h-[80px] w-full rounded-md border border-input bg-white px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)

Textarea.displayName = "Textarea"

export { Textarea }
</file>

<file path="src/lib/supabase/server.ts">
import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'

export async function createClient() {
  const cookieStore = await cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll()
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) => {
            cookieStore.set(name, value, options)
          })
        },
      },
    }
  )
}
</file>

<file path="src/middleware.ts">
import { createServerClient } from '@supabase/ssr'
import { NextResponse, type NextRequest } from 'next/server'

export async function middleware(request: NextRequest) {
  let supabaseResponse = NextResponse.next({
    request,
  })

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll()
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value }) =>
            request.cookies.set(name, value)
          )
          supabaseResponse = NextResponse.next({
            request,
          })
          cookiesToSet.forEach(({ name, value, options }) =>
            supabaseResponse.cookies.set(name, value, options)
          )
        },
      },
    }
  )

  // Refresh session dacÄƒ e expiratÄƒ
  await supabase.auth.getUser()

  return supabaseResponse
}

export const config = {
  matcher: [
    '/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',
  ],
}
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
</file>

<file path="types/database.types.ts">
// ============================================================================
// ZMEUREL OS - DATABASE TYPES
// TypeScript interfaces pentru toate tabelele Supabase
// Data: 10 Februarie 2026
// ============================================================================

// ============================================================================
// PARCELE (Terenuri plantate)
// ============================================================================

export interface Parcela {
    id: string;
    tenant_id: string;
    id_parcela: string; // "P001", "P002" - ID vizibil
    nume_parcela: string;
    suprafata_m2: number;
    soi_plantat: string | null;
    an_plantare: number;
    nr_plante: number | null;
    status: string;
    gps_lat: number | null;
    gps_lng: number | null;
    observatii: string | null;
    created_at: string;
    updated_at: string;
  }

  // Pentru INSERT (fÄƒrÄƒ id, timestamps auto-generate)
  export interface ParcelaInsert {
    tenant_id: string;
    id_parcela: string;
    nume_parcela: string;
    suprafata_m2: number;
    soi_plantat?: string | null;
    an_plantare: number;
    nr_plante?: number | null;
    status?: string;
    gps_lat?: number | null;
    gps_lng?: number | null;
    observatii?: string | null;
  }

  // Pentru UPDATE (toate cÃ¢mpurile opÈ›ionale)
  export interface ParcelaUpdate {
    id_parcela?: string;
    nume_parcela?: string;
    suprafata_m2?: number;
    soi_plantat?: string | null;
    an_plantare?: number;
    nr_plante?: number | null;
    status?: string;
    gps_lat?: number | null;
    gps_lng?: number | null;
    observatii?: string | null;
  }

  // Extended cu calcule (de la VIEW parcele_extended)
  export interface ParcelaExtended extends Parcela {
    densitate_plante_m2: number; // plante / mÂ²
    varsta_ani: number; // anul curent - an_plantare
  }

  // ============================================================================
  // ACTIVITATI EXTRA-SEASON
  // ============================================================================

  export interface ActivitateExtraSeason {
    id: string;
    tenant_id: string;
    id_activitate: string; // "AES001"
    data: string; // ISO date
    parcela_id: string | null;
    tip_activitate: string;
    descriere: string | null;
    cost_lei: number;
    manopera_ore: number | null;
    manopera_persoane: number | null;
    observatii: string | null;
    created_at: string;
    updated_at: string;
  }

  export interface ActivitateExtraSeasonInsert {
    tenant_id: string;
    id_activitate: string;
    data: string;
    parcela_id?: string | null;
    tip_activitate: string;
    descriere?: string | null;
    cost_lei?: number;
    manopera_ore?: number | null;
    manopera_persoane?: number | null;
    observatii?: string | null;
  }

  export interface ActivitateExtraSeasonUpdate {
    id_activitate?: string;
    data?: string;
    parcela_id?: string | null;
    tip_activitate?: string;
    descriere?: string | null;
    cost_lei?: number;
    manopera_ore?: number | null;
    manopera_persoane?: number | null;
    observatii?: string | null;
  }

  // Extended cu JOIN parcele
  export interface ActivitateExtraSeasonExtended extends ActivitateExtraSeason {
    nume_parcela: string | null;
    soi_plantat: string | null;
    suprafata_m2: number | null;
    cost_lei_per_m2: number;
    cost_lei_per_ora: number;
  }

  // ============================================================================
  // NOMENCLATOARE (Enums/Dropdowns)
  // ============================================================================

  export interface Nomenclator {
    id: string;
    tip: string; // 'Soi', 'Tip_Activitate_Extra', etc.
    valoare: string;
    descriere: string | null;
    created_at: string;
  }

  // Helper pentru dropdown options
  export interface NomenclatorOption {
    value: string;
    label: string;
    descriere?: string;
  }

  // ============================================================================
  // TENANTS (Multi-tenancy)
  // ============================================================================

  export interface Tenant {
    id: string;
    nume_ferma: string;
    owner_user_id: string;
    plan: string; // 'freemium', 'starter', 'pro', 'enterprise'
    created_at: string;
  }

  // ============================================================================
  // HELPER TYPES
  // ============================================================================

  // Response wrapper pentru queries
  export interface ApiResponse<T> {
    data: T | null;
    error: Error | null;
  }

  // Pagination
  export interface PaginationParams {
    page: number;
    pageSize: number;
  }

  export interface PaginatedResponse<T> {
    data: T[];
    total: number;
    page: number;
    pageSize: number;
    totalPages: number;
  }

  // Filter params
  export interface ParcelaFilters {
    soi_plantat?: string;
    status?: string;
    an_plantare_min?: number;
    an_plantare_max?: number;
  }
</file>

<file path="src/app/(dashboard)/cheltuieli/CheltuialaPageClient.tsx">
'use client';

import { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { toast } from 'sonner';
import {
  getCheltuieli,
  createCheltuiala,
  updateCheltuiala,
  deleteCheltuiala,
  type Cheltuiala,
} from '@/lib/supabase/queries/cheltuieli';

interface CheltuialaFormData {
  data: string;
  categorie: string;
  suma_lei: number | string;
  furnizor?: string;
  descriere?: string;
}

interface CheltuialaPageClientProps {
  initialCheltuieli: Cheltuiala[];
}

export function CheltuialaPageClient({
  initialCheltuieli,
}: CheltuialaPageClientProps) {
  const queryClient = useQueryClient();
  const [search, setSearch] = useState('');

  const { data: cheltuieli = initialCheltuieli, isLoading } = useQuery({
    queryKey: ['cheltuieli'],
    queryFn: () => getCheltuieli(),
    initialData: initialCheltuieli,
  });

  const createMutation = useMutation({
    mutationFn: (data: CheltuialaFormData) =>
      createCheltuiala({
        data: data.data,
        categorie: data.categorie,
        suma_lei: Number(data.suma_lei),
        furnizor: data.furnizor || undefined,
        descriere: data.descriere || undefined,
        document_url: undefined,
      }),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['cheltuieli'] });
      toast.success('CheltuialÄƒ adÄƒugatÄƒ');
    },
  });

  const updateMutation = useMutation({
    mutationFn: ({
      id,
      payload,
    }: {
      id: string;
      payload: CheltuialaFormData;
    }) =>
      updateCheltuiala(id, {
        data: payload.data,
        categorie: payload.categorie,
        suma_lei: Number(payload.suma_lei),
        furnizor: payload.furnizor || undefined,
        descriere: payload.descriere || undefined,
      }),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['cheltuieli'] });
      toast.success('CheltuialÄƒ actualizatÄƒ');
    },
  });

  const deleteMutation = useMutation({
    mutationFn: (id: string) => deleteCheltuiala(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['cheltuieli'] });
      toast.success('CheltuialÄƒ È™tearsÄƒ');
    },
  });

  const filtered = cheltuieli.filter((c) =>
    (c.categorie ?? '')
      .toLowerCase()
      .includes(search.toLowerCase())
  );

  const total = filtered.reduce((sum, c) => sum + c.suma_lei, 0);

  return (
    <div style={{ padding: 24 }}>
      <h1>Cheltuieli</h1>

      <input
        placeholder="CautÄƒ categorie..."
        value={search}
        onChange={(e) => setSearch(e.target.value)}
        style={{ padding: 8, marginBottom: 16, width: 300 }}
      />

      <div style={{ marginBottom: 16 }}>
        <strong>Total cheltuieli:</strong> {filtered.length} |
        <strong> SumÄƒ totalÄƒ:</strong> {total.toFixed(2)} lei
      </div>

      {isLoading && <p>Se Ã®ncarcÄƒ...</p>}

      {!isLoading && filtered.length === 0 && (
        <p>Nu existÄƒ cheltuieli.</p>
      )}

      {!isLoading &&
        filtered.map((c) => (
          <div
            key={c.id}
            style={{
              border: '1px solid #ddd',
              padding: 12,
              marginBottom: 8,
              borderRadius: 6,
            }}
          >
            <div>
              <strong>{c.categorie ?? 'FÄƒrÄƒ categorie'}</strong>
            </div>

            <div>{c.suma_lei} lei</div>
            <div>{c.data}</div>

            <button
              onClick={() =>
                updateMutation.mutate({
                  id: c.id,
                  payload: {
                    data: c.data,
                    categorie: c.categorie ?? '',
                    suma_lei: c.suma_lei,
                  },
                })
              }
            >
              Update test
            </button>

            <button
              onClick={() => deleteMutation.mutate(c.id)}
              style={{ marginLeft: 8 }}
            >
              Delete
            </button>
          </div>
        ))}

      <button
        onClick={() =>
          createMutation.mutate({
            data: new Date().toISOString().slice(0, 10),
            categorie: 'Test',
            suma_lei: 100,
          })
        }
        style={{ marginTop: 16 }}
      >
        Add Test CheltuialÄƒ
      </button>
    </div>
  );
}
</file>

<file path="src/app/(dashboard)/clienti/page.tsx">
// src/app/(dashboard)/clienti/page.tsx
import { createClient } from '@/lib/supabase/server';
import { getClienti, type Client } from '@/lib/supabase/queries/clienti';
import { ClientPageClient } from './ClientPageClient';

export const metadata = {
  title: 'ClienÈ›i | Zmeurel OS',
  description: 'GestioneazÄƒ baza de clienÈ›i',
};

export default async function ClientPage() {
  const supabase = await createClient();

  // Get authenticated user
  const {
    data: { user },
  } = await supabase.auth.getUser();

  if (!user) {
    return (
      <div className="container mx-auto p-6">
        <p className="text-red-500">
          Trebuie sÄƒ fii autentificat pentru a accesa aceastÄƒ paginÄƒ.
        </p>
      </div>
    );
  }

  // Fetch clienÈ›i - RLS handles tenant filtering
  let clienti: Client[] = [];
  try {
    clienti = await getClienti();
    console.log('[ClientPage] Fetched clienti:', clienti.length);
  } catch (error) {
    console.error('[ClientPage] Error fetching clienti:', error);
  }

  // Pass data to Client Component
  return <ClientPageClient initialClienti={clienti} />;
}
</file>

<file path="src/app/(dashboard)/culegatori/page.tsx">
import { createClient } from '@/lib/supabase/server'
import { CulegatorPageClient } from './CulegatorPageClient'

export default async function Page() {
  const supabase = await createClient()

  const { data } = await supabase
    .from('culegatori')
    .select('*')
    .order('created_at', { ascending: false })

  return <CulegatorPageClient initialCulegatori={data ?? []} />
}
</file>

<file path="src/app/(dashboard)/dashboard/page.tsx">
import { DashboardHome } from '@/components/dashboard/DashboardHome';

export default function DashboardPage() {
  return <DashboardHome />;
}
</file>

<file path="src/app/(dashboard)/investitii/InvestitiiPageClient.tsx">
// src/app/(dashboard)/investitii/InvestitiiPageClient.tsx
'use client'

import { useState, useMemo } from 'react'
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { toast } from 'sonner'
import { Search, DollarSign, TrendingDown, Calculator } from 'lucide-react'

import { Card, CardContent } from '@/components/ui/card'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'

import {
  Investitie,
  getInvestitii,
  deleteInvestitie,
} from '@/lib/supabase/queries/investitii'

import { InvestitieCard } from '@/components/investitii/InvestitieCard'
import { AddInvestitieDialog } from '@/components/investitii/AddInvestitieDialog'
import { EditInvestitieDialog } from '@/components/investitii/EditInvestitieDialog'
import { DeleteConfirmDialog } from '@/components/parcele/DeleteConfirmDialog'

interface Parcela {
  id: string
  id_parcela: string
  nume_parcela: string
}

interface InvestitiiPageClientProps {
  initialInvestitii: Investitie[]
  parcele: Parcela[]
}

export function InvestitiiPageClient({
  initialInvestitii,
  parcele,
}: InvestitiiPageClientProps) {
  const queryClient = useQueryClient()

  const [searchTerm, setSearchTerm] = useState('')
  const [selectedMonth, setSelectedMonth] = useState<string>('all')
  const [editingInvestitie, setEditingInvestitie] =
    useState<Investitie | null>(null)
  const [deletingInvestitie, setDeletingInvestitie] =
    useState<Investitie | null>(null)

  const { data: investitii = initialInvestitii } = useQuery({
    queryKey: ['investitii'],
    queryFn: getInvestitii,
    initialData: initialInvestitii,
  })

  const deleteMutation = useMutation({
    mutationFn: deleteInvestitie,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['investitii'] })
      toast.success('InvestiÈ›ie È™tearsÄƒ cu succes!')
      setDeletingInvestitie(null)
    },
    onError: (error) => {
      console.error('Error deleting investitie:', error)
      toast.error('Eroare la È™tergerea investiÈ›iei')
    },
  })

  const parcelaMap = useMemo(() => {
    const map: Record<string, string> = {}
    parcele.forEach((p) => {
      map[p.id] = `${p.id_parcela} - ${p.nume_parcela}`
    })
    return map
  }, [parcele])

  const availableMonths = useMemo(() => {
    const months = new Set<string>()
    investitii.forEach((inv) => {
      const date = new Date(inv.data)
      const monthKey = `${date.getFullYear()}-${(date.getMonth() + 1)
        .toString()
        .padStart(2, '0')}`
      months.add(monthKey)
    })
    return Array.from(months).sort().reverse()
  }, [investitii])

  const formatMonth = (monthKey: string) => {
    const [year, month] = monthKey.split('-')
    const date = new Date(parseInt(year), parseInt(month) - 1)
    return date.toLocaleDateString('ro-RO', {
      year: 'numeric',
      month: 'long',
    })
  }

  const filteredInvestitii = useMemo(() => {
    let filtered = investitii

    if (searchTerm) {
      const term = searchTerm.toLowerCase()
      filtered = filtered.filter(
        (inv) =>
          inv.id_investitie.toLowerCase().includes(term) ||
          inv.categorie?.toLowerCase().includes(term) ||
          inv.furnizor?.toLowerCase().includes(term) ||
          inv.descriere?.toLowerCase().includes(term)
      )
    }

    if (selectedMonth !== 'all') {
      filtered = filtered.filter((inv) => {
        const date = new Date(inv.data)
        const monthKey = `${date.getFullYear()}-${(date.getMonth() + 1)
          .toString()
          .padStart(2, '0')}`
        return monthKey === selectedMonth
      })
    }

    return filtered
  }, [investitii, searchTerm, selectedMonth])

  const stats = useMemo(() => {
    const total = filteredInvestitii.length
    const sumaTotala = filteredInvestitii.reduce(
      (sum, inv) => sum + inv.suma_lei,
      0
    )
    const medie = total > 0 ? sumaTotala / total : 0

    return { total, sumaTotala, medie }
  }, [filteredInvestitii])

  const formatSuma = (suma: number) => {
    return new Intl.NumberFormat('ro-RO', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    }).format(suma)
  }

  const handleEdit = (investitie: Investitie) => {
    setEditingInvestitie(investitie)
  }

  const handleDelete = (investitie: Investitie) => {
    setDeletingInvestitie(investitie)
  }

  const confirmDelete = () => {
    if (deletingInvestitie) {
      deleteMutation.mutate(deletingInvestitie.id)
    }
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-gray-900">
            InvestiÈ›ii (CAPEX)
          </h1>
          <p className="text-gray-600 mt-1">
            GestioneazÄƒ investiÈ›iile Ã®n plantaÈ›ie
          </p>
        </div>
        <AddInvestitieDialog />
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">
                  Total InvestiÈ›ii
                </p>
                <p className="text-3xl font-bold text-gray-900 mt-1">
                  {stats.total}
                </p>
              </div>
              <div className="h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center">
                <DollarSign className="h-6 w-6 text-blue-600" />
              </div>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">
                  SumÄƒ TotalÄƒ InvestitÄƒ
                </p>
                <p className="text-3xl font-bold text-red-600 mt-1">
                  -{formatSuma(stats.sumaTotala)} lei
                </p>
              </div>
              <div className="h-12 w-12 bg-red-100 rounded-lg flex items-center justify-center">
                <TrendingDown className="h-6 w-6 text-red-600" />
              </div>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">
                  Medie per InvestiÈ›ie
                </p>
                <p className="text-3xl font-bold text-gray-900 mt-1">
                  {formatSuma(stats.medie)} lei
                </p>
              </div>
              <div className="h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center">
                <Calculator className="h-6 w-6 text-purple-600" />
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {filteredInvestitii.length === 0 ? (
        <Card>
          <CardContent className="p-12 text-center">
            <DollarSign className="h-12 w-12 text-gray-400 mx-auto mb-4" />
            <h3 className="text-lg font-semibold text-gray-900 mb-2">
              Nicio investiÈ›ie gÄƒsitÄƒ
            </h3>
            <p className="text-gray-600">
              AdaugÄƒ prima investiÈ›ie pentru a Ã®ncepe tracking-ul CAPEX
            </p>
          </CardContent>
        </Card>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {filteredInvestitii.map((investitie) => (
            <InvestitieCard
              key={investitie.id}
              investitie={investitie}
              parcelaNume={
                investitie.parcela_id
                  ? parcelaMap[investitie.parcela_id]
                  : undefined
              }
              onEdit={handleEdit}
              onDelete={handleDelete}
            />
          ))}
        </div>
      )}

      <EditInvestitieDialog
        investitie={editingInvestitie}
        open={!!editingInvestitie}
        onOpenChange={(open) => !open && setEditingInvestitie(null)}
      />

      <DeleteConfirmDialog
        open={!!deletingInvestitie}
        onOpenChange={(open) => !open && setDeletingInvestitie(null)}
        onConfirm={confirmDelete}
        itemName={deletingInvestitie?.id_investitie || ''}
        itemType="investiÈ›ie"
      />
    </div>
  )
}
</file>

<file path="src/app/(dashboard)/investitii/page.tsx">
// src/app/(dashboard)/investitii/page.tsx

import { createClient } from '@/lib/supabase/server'
import { InvestitiiPageClient } from './InvestitiiPageClient'

export default async function InvestitiiPage() {
  const supabase = await createClient()

  const { data: investitii } = await supabase
    .from('investitii')
    .select('*')
    .order('data', { ascending: false })

  const { data: parcele } = await supabase
    .from('parcele')
    .select('id, id_parcela, nume_parcela')
    .order('created_at', { ascending: false })

  return (
    <InvestitiiPageClient
      initialInvestitii={investitii ?? []}
      parcele={parcele ?? []}
    />
  )
}
</file>

<file path="src/app/(dashboard)/layout.tsx">
import { Sidebar } from '@/components/layout/Sidebar';

export default function DashboardLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="flex">
      <Sidebar />
      <main className="flex-1 lg:ml-64 min-h-screen">
        {children}
      </main>
    </div>
  );
}
</file>

<file path="src/app/(dashboard)/parcele/page.tsx">
import { getParcele } from '@/lib/supabase/queries/parcele';
import { ParcelaPageClient } from './ParcelaPageClient';

export default async function ParcelePage() {
  const parcele = await getParcele();

  return <ParcelaPageClient initialParcele={parcele || []} />;
}
</file>

<file path="src/app/(dashboard)/parcele/ParcelaPageClient.tsx">
'use client';

import { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { toast } from 'sonner';
import {
  getParcele,
  createParcela,
  updateParcela,
  deleteParcela,
  type Parcela,
} from '@/lib/supabase/queries/parcele';
import { AddParcelaDialog } from '@/components/parcele/AddParcelaDialog';

interface ParcelaFormData {
  nume_parcela: string;
  suprafata_m2: number | string;
  soi_plantat?: string;
  an_plantare: number | string;
  nr_plante?: number | string;
  status: string;
  gps_lat?: number | string;
  gps_lng?: number | string;
  observatii?: string;
}

interface ParcelaPageClientProps {
  initialParcele: Parcela[];
}

export function ParcelaPageClient({
  initialParcele,
}: ParcelaPageClientProps) {
  const queryClient = useQueryClient();
  const [search, setSearch] = useState('');

  const { data: parcele = initialParcele, isLoading } = useQuery({
    queryKey: ['parcele'],
    queryFn: () => getParcele(),
    initialData: initialParcele,
  });

  const createMutation = useMutation({
    mutationFn: (data: ParcelaFormData) =>
      createParcela({
        nume_parcela: data.nume_parcela,
        suprafata_m2: Number(data.suprafata_m2),
        soi_plantat: data.soi_plantat || null,
        an_plantare: Number(data.an_plantare),
        nr_plante: data.nr_plante ? Number(data.nr_plante) : null,
        status: data.status,
        gps_lat: data.gps_lat ? Number(data.gps_lat) : null,
        gps_lng: data.gps_lng ? Number(data.gps_lng) : null,
        observatii: data.observatii || null,
      }),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['parcele'] });
      toast.success('ParcelÄƒ adÄƒugatÄƒ');
    },
  });

  const updateMutation = useMutation({
    mutationFn: ({
      id,
      payload,
    }: {
      id: string;
      payload: ParcelaFormData;
    }) =>
      updateParcela(id, {
        nume_parcela: payload.nume_parcela,
        suprafata_m2: Number(payload.suprafata_m2),
        soi_plantat: payload.soi_plantat || null,
        an_plantare: Number(payload.an_plantare),
        nr_plante: payload.nr_plante
          ? Number(payload.nr_plante)
          : null,
        status: payload.status,
        gps_lat: payload.gps_lat ? Number(payload.gps_lat) : null,
        gps_lng: payload.gps_lng ? Number(payload.gps_lng) : null,
        observatii: payload.observatii || null,
      }),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['parcele'] });
      toast.success('ParcelÄƒ actualizatÄƒ');
    },
  });

  const deleteMutation = useMutation({
    mutationFn: (id: string) => deleteParcela(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['parcele'] });
      toast.success('ParcelÄƒ È™tearsÄƒ');
    },
  });

  const filtered = parcele.filter((p) =>
    p.nume_parcela.toLowerCase().includes(search.toLowerCase())
  );

  return (
    <div style={{ padding: 24 }}>
      <h1>Parcele</h1>

      <input
        placeholder="CautÄƒ parcelÄƒ..."
        value={search}
        onChange={(e) => setSearch(e.target.value)}
        style={{ padding: 8, marginBottom: 16, width: 300 }}
      />

      {isLoading && <p>Se Ã®ncarcÄƒ...</p>}

      {!isLoading &&
        filtered.map((p) => (
          <div
            key={p.id}
            style={{
              border: '1px solid #ddd',
              padding: 12,
              marginBottom: 8,
              borderRadius: 6,
            }}
          >
            <div>
              <strong>{p.nume_parcela}</strong>
            </div>

            <div>{p.suprafata_m2} mÂ²</div>

            <div>Status: {p.status}</div>

            <button
              onClick={() => deleteMutation.mutate(p.id)}
              style={{ marginTop: 8 }}
            >
              Delete
            </button>
          </div>
        ))}

      <div style={{ marginTop: 16 }}>
        <AddParcelaDialog
          soiuriDisponibile={['Delniwa', 'Maravilla', 'Enrosadira', 'Husaria']}
          onSuccess={() => {
            queryClient.invalidateQueries({ queryKey: ['parcele'] });
          }}
        />
      </div>
    </div>
  );
}
</file>

<file path="src/app/(dashboard)/recoltari/RecoltariPageClient.tsx">
'use client'

import { useState, useMemo } from 'react'
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { toast } from 'sonner'
import { Search, Package, TrendingUp } from 'lucide-react'

import { Card, CardContent } from '@/components/ui/card'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'

import {
  Recoltare,
  getRecoltari,
  deleteRecoltare,
} from '@/lib/supabase/queries/recoltari'

import { RecoltareCard } from '@/components/recoltari/RecoltareCard'
import { AddRecoltareDialog } from '@/components/recoltari/AddRecoltareDialog'
import { EditRecoltareDialog } from '@/components/recoltari/EditRecoltareDialog'
import { DeleteConfirmDialog } from '@/components/parcele/DeleteConfirmDialog'

interface Parcela {
  id: string
  id_parcela: string
  nume_parcela: string
}

interface RecoltariPageClientProps {
  initialRecoltari: Recoltare[]
  parcele: Parcela[]
}

export function RecoltariPageClient({
  initialRecoltari,
  parcele,
}: RecoltariPageClientProps) {
  const queryClient = useQueryClient()

  const [searchTerm, setSearchTerm] = useState('')
  const [editingRecoltare, setEditingRecoltare] =
    useState<Recoltare | null>(null)
  const [deletingRecoltare, setDeletingRecoltare] =
    useState<Recoltare | null>(null)

  const { data: recoltari = initialRecoltari } = useQuery({
    queryKey: ['recoltari'],
    queryFn: getRecoltari,
    initialData: initialRecoltari,
  })

  const deleteMutation = useMutation({
    mutationFn: deleteRecoltare,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['recoltari'] })
      toast.success('Recoltare È™tearsÄƒ cu succes!')
      setDeletingRecoltare(null)
    },
    onError: (error) => {
      console.error(error)
      toast.error('Eroare la È™tergerea recoltÄƒrii')
    },
  })

  const parcelaMap = useMemo(() => {
    const map: Record<string, string> = {}
    parcele.forEach((p) => {
      map[p.id] = `${p.id_parcela} - ${p.nume_parcela}`
    })
    return map
  }, [parcele])

  const filteredRecoltari = useMemo(() => {
    if (!searchTerm) return recoltari

    const term = searchTerm.toLowerCase()

    return recoltari.filter(
      (r) =>
        r.id_recoltare.toLowerCase().includes(term) ||
        (r.parcela_id &&
          parcelaMap[r.parcela_id]?.toLowerCase().includes(term))
    )
  }, [recoltari, searchTerm, parcelaMap])

  const totalBrutKg = useMemo(() => {
    return filteredRecoltari.reduce(
      (sum, r) => sum + r.nr_caserole * 0.5,
      0
    )
  }, [filteredRecoltari])

  const totalNetKg = useMemo(() => {
    return filteredRecoltari.reduce((sum, r) => {
      const brut = r.nr_caserole * 0.5
      return sum + (brut - r.tara_kg)
    }, 0)
  }, [filteredRecoltari])

  const handleDelete = (recoltare: Recoltare) => {
    setDeletingRecoltare(recoltare)
  }

  const confirmDelete = () => {
    if (deletingRecoltare) {
      deleteMutation.mutate(deletingRecoltare.id)
    }
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-gray-900">
            RecoltÄƒri
          </h1>
          <p className="text-gray-600 mt-1">
            EvidenÈ›a producÈ›iei recoltate
          </p>
        </div>
        <AddRecoltareDialog />
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <Card>
          <CardContent className="p-6 flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">
                Total Brut (kg)
              </p>
              <p className="text-3xl font-bold mt-1">
                {totalBrutKg.toFixed(2)} kg
              </p>
            </div>
            <Package className="h-8 w-8 text-purple-600" />
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6 flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">
                Total Net (kg)
              </p>
              <p className="text-3xl font-bold mt-1">
                {totalNetKg.toFixed(2)} kg
              </p>
            </div>
            <TrendingUp className="h-8 w-8 text-green-600" />
          </CardContent>
        </Card>
      </div>

      <Card>
        <CardContent className="p-4">
          <Label htmlFor="search">CÄƒutare</Label>
          <div className="relative mt-1">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" />
            <Input
              id="search"
              type="text"
              placeholder="CautÄƒ dupÄƒ ID sau parcelÄƒ..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="pl-10"
            />
          </div>
        </CardContent>
      </Card>

      {filteredRecoltari.length === 0 ? (
        <Card>
          <CardContent className="p-12 text-center">
            <Package className="h-12 w-12 text-gray-400 mx-auto mb-4" />
            <h3 className="text-lg font-semibold text-gray-900">
              Nicio recoltare gÄƒsitÄƒ
            </h3>
          </CardContent>
        </Card>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {filteredRecoltari.map((recoltare) => (
            <RecoltareCard
              key={recoltare.id}
              recoltare={recoltare}
              parcelaNume={
                recoltare.parcela_id
                  ? parcelaMap[recoltare.parcela_id]
                  : undefined
              }
              onDelete={handleDelete}
              onEdit={setEditingRecoltare}
            />
          ))}
        </div>
      )}

      <EditRecoltareDialog
        recoltare={editingRecoltare}
        open={!!editingRecoltare}
        onOpenChange={(open) => !open && setEditingRecoltare(null)}
      />

      <DeleteConfirmDialog
        open={!!deletingRecoltare}
        onOpenChange={(open) => !open && setDeletingRecoltare(null)}
        onConfirm={confirmDelete}
        itemName={deletingRecoltare?.id_recoltare || ''}
        itemType="recoltare"
      />
    </div>
  )
}
</file>

<file path="src/app/(dashboard)/vanzari-butasi/VanzariButasiPageClient.tsx">
'use client';

import { useState, useMemo } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { toast } from 'sonner';
import { Card, CardContent } from '@/components/ui/card';
import { Input } from '@/components/ui/input';

import {
  VanzareButasi,
  getVanzariButasi,
  deleteVanzareButasi,
} from '@/lib/supabase/queries/vanzari-butasi';

import { VanzareButasiCard } from '@/components/vanzari-butasi/VanzareButasiCard';
import { AddVanzareButasiDialog } from '@/components/vanzari-butasi/AddVanzareButasiDialog';
import { EditVanzareButasiDialog } from '@/components/vanzari-butasi/EditVanzareButasiDialog';
import { DeleteConfirmDialog } from '@/components/parcele/DeleteConfirmDialog';

interface Client {
  id: string;
  id_client: string;
  nume_client: string;
}

interface Parcela {
  id: string;
  id_parcela: string;
  nume_parcela: string;
}

interface VanzariButasiPageClientProps {
  initialVanzari: VanzareButasi[];
  clienti: Client[];
  parcele: Parcela[];
}

export function VanzariButasiPageClient({
  initialVanzari,
  clienti,
  parcele,
}: VanzariButasiPageClientProps) {
  const queryClient = useQueryClient();

  const [searchTerm, setSearchTerm] = useState('');
  const [editingVanzare, setEditingVanzare] = useState<VanzareButasi | null>(null);
  const [deletingVanzare, setDeletingVanzare] = useState<VanzareButasi | null>(null);

  const { data: vanzari = initialVanzari } = useQuery({
    queryKey: ['vanzari-butasi'],
    queryFn: getVanzariButasi,
    initialData: initialVanzari,
  });

  const deleteMutation = useMutation({
    mutationFn: deleteVanzareButasi,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['vanzari-butasi'] });
      toast.success('VÃ¢nzare È™tearsÄƒ cu succes!');
      setDeletingVanzare(null);
    },
    onError: () => {
      toast.error('Eroare la È™tergere');
    },
  });

  const clientMap = useMemo(() => {
    const map: Record<string, string> = {};
    clienti.forEach((c) => {
      map[c.id] = `${c.id_client} - ${c.nume_client}`;
    });
    return map;
  }, [clienti]);

  const parcelaMap = useMemo(() => {
    const map: Record<string, string> = {};
    parcele.forEach((p) => {
      map[p.id] = `${p.id_parcela} - ${p.nume_parcela}`;
    });
    return map;
  }, [parcele]);

  const filteredVanzari = useMemo(() => {
    if (!searchTerm) return vanzari;

    const term = searchTerm.toLowerCase();

    return vanzari.filter(
      (vb) =>
        vb.id_vanzare_butasi.toLowerCase().includes(term) ||
        vb.soi_butasi?.toLowerCase().includes(term) ||
        (vb.client_id && clientMap[vb.client_id]?.toLowerCase().includes(term)) ||
        vb.observatii?.toLowerCase().includes(term)
    );
  }, [vanzari, searchTerm, clientMap]);

  const totalVenit = useMemo(() => {
    return filteredVanzari.reduce(
      (sum, vb) => sum + vb.cantitate_butasi * vb.pret_unitar_lei,
      0
    );
  }, [filteredVanzari]);

  const confirmDelete = () => {
    if (deletingVanzare) {
      deleteMutation.mutate(deletingVanzare.id);
    }
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-gray-900">VÃ¢nzÄƒri ButaÈ™i</h1>
          <p className="text-gray-600 mt-1">
            GestioneazÄƒ vÃ¢nzÄƒrile de material sÄƒditor
          </p>
        </div>
        <AddVanzareButasiDialog />
      </div>

      <Card>
        <CardContent className="p-6">
          <p className="text-sm text-gray-600">Venit total</p>
          <p className="text-3xl font-bold text-green-600">
            {totalVenit.toFixed(2)} lei
          </p>
        </CardContent>
      </Card>

      <Card>
        <CardContent className="p-4">
          <Input
            placeholder="CautÄƒ..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
          />
        </CardContent>
      </Card>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {filteredVanzari.map((vanzare) => (
          <VanzareButasiCard
            key={vanzare.id}
            vanzare={vanzare}
            clientNume={
              vanzare.client_id ? clientMap[vanzare.client_id] : undefined
            }
            parcelaNume={
              vanzare.parcela_sursa_id
                ? parcelaMap[vanzare.parcela_sursa_id]
                : undefined
            }
            onEdit={setEditingVanzare}
            onDelete={setDeletingVanzare}
          />
        ))}
      </div>

      <EditVanzareButasiDialog
        vanzare={editingVanzare}
        open={!!editingVanzare}
        onOpenChange={(open) => !open && setEditingVanzare(null)}
      />

      <DeleteConfirmDialog
        open={!!deletingVanzare}
        onOpenChange={(open) => !open && setDeletingVanzare(null)}
        onConfirm={confirmDelete}
        itemName={deletingVanzare?.id_vanzare_butasi || ''}
        itemType="vÃ¢nzare"
      />
    </div>
  );
}
</file>

<file path="src/app/(dashboard)/vanzari/VanzariPageClient.tsx">
'use client';

import { useState, useMemo } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { toast } from 'sonner';
import { Search, DollarSign, TrendingUp, Calculator } from 'lucide-react';

import { Card, CardContent } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';

import {
  Vanzare,
  getVanzari,
  deleteVanzare,
} from '@/lib/supabase/queries/vanzari';

import { VanzareCard } from '@/components/vanzari/VanzareCard';
import { AddVanzareDialog } from '@/components/vanzari/AddVanzareDialog';
import { EditVanzareDialog } from '@/components/vanzari/EditVanzareDialog';
import { DeleteConfirmDialog } from '@/components/parcele/DeleteConfirmDialog';

interface Client {
  id: string;
  nume: string;
}

interface VanzariPageClientProps {
  initialVanzari: Vanzare[];
  clienti: Client[];
}

export function VanzariPageClient({
  initialVanzari,
  clienti,
}: VanzariPageClientProps) {
  const queryClient = useQueryClient();

  const [searchTerm, setSearchTerm] = useState('');
  const [selectedMonth, setSelectedMonth] = useState<string>('all');
  const [editingVanzare, setEditingVanzare] = useState<Vanzare | null>(null);
  const [deletingVanzare, setDeletingVanzare] = useState<Vanzare | null>(null);

  const { data: vanzari = initialVanzari } = useQuery({
    queryKey: ['vanzari'],
    queryFn: () => getVanzari(),
    initialData: initialVanzari,
  });

  const deleteMutation = useMutation({
    mutationFn: deleteVanzare,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['vanzari'] });
      toast.success('VÃ¢nzare È™tearsÄƒ cu succes!');
      setDeletingVanzare(null);
    },
    onError: () => {
      toast.error('Eroare la È™tergerea vÃ¢nzÄƒrii');
    },
  });

  const clientMap = useMemo(() => {
    const map: Record<string, string> = {};
    clienti.forEach((c) => {
      map[c.id] = c.nume;
    });
    return map;
  }, [clienti]);

  const availableMonths = useMemo(() => {
    const months = new Set<string>();
    vanzari.forEach((v) => {
      const date = new Date(v.data);
      const key = `${date.getFullYear()}-${(date.getMonth() + 1)
        .toString()
        .padStart(2, '0')}`;
      months.add(key);
    });
    return Array.from(months).sort().reverse();
  }, [vanzari]);

  const formatMonth = (monthKey: string) => {
    const [year, month] = monthKey.split('-');
    const date = new Date(parseInt(year, 10), parseInt(month, 10) - 1);
    return date.toLocaleDateString('ro-RO', {
      year: 'numeric',
      month: 'long',
    });
  };

  const filteredVanzari = useMemo(() => {
    let filtered = vanzari;

    if (searchTerm) {
      const term = searchTerm.toLowerCase();
      filtered = filtered.filter(
        (v) =>
          v.id_vanzare.toLowerCase().includes(term) ||
          (v.client_id && clientMap[v.client_id]?.toLowerCase().includes(term)) ||
          v.status_plata.toLowerCase().includes(term) ||
          v.observatii_ladite?.toLowerCase().includes(term)
      );
    }

    if (selectedMonth !== 'all') {
      filtered = filtered.filter((v) => {
        const date = new Date(v.data);
        const key = `${date.getFullYear()}-${(date.getMonth() + 1)
          .toString()
          .padStart(2, '0')}`;
        return key === selectedMonth;
      });
    }

    return filtered;
  }, [vanzari, searchTerm, selectedMonth, clientMap]);

  const stats = useMemo(() => {
    const total = filteredVanzari.length;
    const sumaTotala = filteredVanzari.reduce(
      (sum, v) => sum + v.cantitate_kg * v.pret_lei_kg,
      0
    );
    const medie = total > 0 ? sumaTotala / total : 0;

    return { total, sumaTotala, medie };
  }, [filteredVanzari]);

  const formatSuma = (suma: number) =>
    new Intl.NumberFormat('ro-RO', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    }).format(suma);

  const confirmDelete = () => {
    if (deletingVanzare) {
      deleteMutation.mutate(deletingVanzare.id);
    }
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-gray-900">VÃ¢nzÄƒri Fructe</h1>
          <p className="text-gray-600 mt-1">
            GestioneazÄƒ vÃ¢nzÄƒrile de fructe proaspete
          </p>
        </div>
        <AddVanzareDialog />
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Card>
          <CardContent className="p-6">
            <p className="text-sm text-gray-600">Total VÃ¢nzÄƒri</p>
            <p className="text-3xl font-bold">{stats.total}</p>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6">
            <p className="text-sm text-gray-600">Venituri Totale</p>
            <p className="text-3xl font-bold text-green-600">
              +{formatSuma(stats.sumaTotala)} lei
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6">
            <p className="text-sm text-gray-600">Medie per VÃ¢nzare</p>
            <p className="text-3xl font-bold">
              {formatSuma(stats.medie)} lei
            </p>
          </CardContent>
        </Card>
      </div>

      <Card>
        <CardContent className="p-4">
          <Input
            placeholder="CautÄƒ..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
          />
        </CardContent>
      </Card>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {filteredVanzari.map((vanzare) => (
          <VanzareCard
            key={vanzare.id}
            vanzare={vanzare}
            clientNume={
              vanzare.client_id ? clientMap[vanzare.client_id] : undefined
            }
            onEdit={setEditingVanzare}
            onDelete={setDeletingVanzare}
          />
        ))}
      </div>

      <EditVanzareDialog
        vanzare={editingVanzare}
        open={!!editingVanzare}
        onOpenChange={(open) => !open && setEditingVanzare(null)}
      />

      <DeleteConfirmDialog
        open={!!deletingVanzare}
        onOpenChange={(open) => !open && setDeletingVanzare(null)}
        onConfirm={confirmDelete}
        itemName={deletingVanzare?.id_vanzare || ''}
        itemType="vÃ¢nzare"
      />
    </div>
  );
}
</file>

<file path="src/components/activitati-agricole/AddActivitateAgricolaDialog.tsx">
'use client';

import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import { useMutation, useQueryClient, useQuery } from '@tanstack/react-query';
import { toast } from 'sonner';
import { Plus } from 'lucide-react';

import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';

import {
  createActivitateAgricola,
  TIPURI_ACTIVITATI,
} from '@/lib/supabase/queries/activitati-agricole';
import { getParcele } from '@/lib/supabase/queries/parcele';

// ----------------------------
// Schema validare
// ----------------------------

const activitateSchema = z.object({
  data_aplicare: z.string().min(1, 'Data este obligatorie'),
  parcela_id: z.string().optional(),
  tip_activitate: z.string().min(1, 'Tipul este obligatoriu'),
  produs_utilizat: z.string().optional(),
  doza: z.string().optional(),
  timp_pauza_zile: z.string().optional(),
  operator: z.string().optional(),
  observatii: z.string().optional(),
});

type ActivitateFormData = z.infer<typeof activitateSchema>;

// ----------------------------
// ComponentÄƒ
// ----------------------------

export function AddActivitateAgricolaDialog() {
  const [open, setOpen] = useState(false);
  const queryClient = useQueryClient();

  // ğŸ” RLS face izolarea. Nu mai trimitem tenantId.
  const { data: parcele = [] } = useQuery({
    queryKey: ['parcele'],
    queryFn: getParcele,
  });

  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<ActivitateFormData>({
    resolver: zodResolver(activitateSchema),
    defaultValues: {
      data_aplicare: new Date().toISOString().split('T')[0],
      parcela_id: '',
      tip_activitate: '',
      produs_utilizat: '',
      doza: '',
      timp_pauza_zile: '0',
      operator: '',
      observatii: '',
    },
  });

  const createMutation = useMutation({
    mutationFn: createActivitateAgricola,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['activitati-agricole'] });
      toast.success('Activitate agricolÄƒ adÄƒugatÄƒ cu succes!');
      reset();
      setOpen(false);
    },
    onError: (error) => {
      console.error('Error creating activitate agricola:', error);
      toast.error('Eroare la adÄƒugarea activitÄƒÈ›ii');
    },
  });

  const onSubmit = (data: ActivitateFormData) => {
    createMutation.mutate({
      data_aplicare: data.data_aplicare,
      parcela_id: data.parcela_id || undefined,
      tip_activitate: data.tip_activitate,
      produs_utilizat: data.produs_utilizat || undefined,
      doza: data.doza || undefined,
      timp_pauza_zile: data.timp_pauza_zile
        ? Number(data.timp_pauza_zile)
        : 0,
      operator: data.operator || undefined,
      observatii: data.observatii || undefined,
    });
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button className="bg-[#F16B6B] hover:bg-[#E05A5A]">
          <Plus className="h-4 w-4 mr-2" />
          AdaugÄƒ Activitate
        </Button>
      </DialogTrigger>

      <DialogContent className="max-w-3xl max-h-[95vh] overflow-y-auto bg-white">
        <DialogHeader>
          <DialogTitle>AdaugÄƒ Activitate AgricolÄƒ NouÄƒ</DialogTitle>
        </DialogHeader>

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4 pb-4">

          {/* Data Aplicare */}
          <div>
            <Label htmlFor="data_aplicare">
              Data aplicÄƒrii <span className="text-red-500">*</span>
            </Label>
            <Input
              id="data_aplicare"
              type="date"
              {...register('data_aplicare')}
              className={errors.data_aplicare ? 'border-red-500' : ''}
            />
            {errors.data_aplicare && (
              <p className="text-sm text-red-500 mt-1">
                {errors.data_aplicare.message}
              </p>
            )}
          </div>

          {/* Tip Activitate */}
          <div>
            <Label htmlFor="tip_activitate">
              Tip activitate <span className="text-red-500">*</span>
            </Label>
            <select
              id="tip_activitate"
              {...register('tip_activitate')}
              className={`flex h-10 w-full rounded-md border px-3 py-2 text-sm bg-white ${
                errors.tip_activitate ? 'border-red-500' : 'border-gray-300'
              }`}
            >
              <option value="">SelecteazÄƒ tipul...</option>
              {TIPURI_ACTIVITATI.map((tip) => (
                <option key={tip} value={tip}>
                  {tip}
                </option>
              ))}
            </select>
            {errors.tip_activitate && (
              <p className="text-sm text-red-500 mt-1">
                {errors.tip_activitate.message}
              </p>
            )}
          </div>

          {/* ParcelÄƒ */}
          <div>
            <Label htmlFor="parcela_id">ParcelÄƒ (opÈ›ional)</Label>
            <select
              id="parcela_id"
              {...register('parcela_id')}
              className="flex h-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm bg-white"
            >
              <option value="">FÄƒrÄƒ parcelÄƒ specificatÄƒ</option>
              {parcele.map((parcela) => (
                <option key={parcela.id} value={parcela.id}>
                  {parcela.id_parcela} - {parcela.nume_parcela}
                </option>
              ))}
            </select>
          </div>

          {/* Produs */}
          <div>
            <Label htmlFor="produs_utilizat">Produs utilizat</Label>
            <Input
              id="produs_utilizat"
              type="text"
              {...register('produs_utilizat')}
            />
          </div>

          {/* DozÄƒ */}
          <div>
            <Label htmlFor="doza">DozÄƒ</Label>
            <Input
              id="doza"
              type="text"
              {...register('doza')}
            />
          </div>

          {/* Timp pauzÄƒ */}
          <div>
            <Label htmlFor="timp_pauza_zile">
              Timp pauzÄƒ (zile)
            </Label>
            <Input
              id="timp_pauza_zile"
              type="number"
              min="0"
              {...register('timp_pauza_zile')}
            />
          </div>

          {/* Operator */}
          <div>
            <Label htmlFor="operator">Operator</Label>
            <Input
              id="operator"
              type="text"
              {...register('operator')}
            />
          </div>

          {/* ObservaÈ›ii */}
          <div>
            <Label htmlFor="observatii">ObservaÈ›ii</Label>
            <Textarea
              id="observatii"
              rows={2}
              {...register('observatii')}
            />
          </div>

          {/* Buttons */}
          <div className="flex justify-end gap-3 pt-4">
            <Button
              type="button"
              variant="outline"
              onClick={() => {
                reset();
                setOpen(false);
              }}
            >
              AnuleazÄƒ
            </Button>

            <Button
              type="submit"
              disabled={createMutation.isPending}
              className="bg-[#F16B6B] hover:bg-[#E05A5A]"
            >
              {createMutation.isPending ? 'Se salveazÄƒ...' : 'SalveazÄƒ'}
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/activitati-agricole/EditActivitateAgricolaDialog.tsx">
// src/components/activitati-agricole/EditActivitateAgricolaDialog.tsx
'use client'

import { useEffect } from 'react'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import * as z from 'zod'
import { useMutation, useQueryClient, useQuery } from '@tanstack/react-query'
import { toast } from 'sonner'

import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Textarea } from '@/components/ui/textarea'

import {
  ActivitateAgricola,
  updateActivitateAgricola,
  TIPURI_ACTIVITATI,
} from '@/lib/supabase/queries/activitati-agricole'

import { getParcele } from '@/lib/supabase/queries/parcele'

// ===============================
// VALIDATION
// ===============================

const activitateSchema = z.object({
  data_aplicare: z.string().min(1, 'Data este obligatorie'),
  parcela_id: z.string().optional(),
  tip_activitate: z.string().min(1, 'Tipul este obligatoriu'),
  produs_utilizat: z.string().optional(),
  doza: z.string().optional(),
  timp_pauza_zile: z.string().optional(),
  operator: z.string().optional(),
  observatii: z.string().optional(),
})

type ActivitateFormData = z.infer<typeof activitateSchema>

type UpdateActivitateInput = {
  data_aplicare: string
  parcela_id?: string
  tip_activitate: string
  produs_utilizat?: string
  doza?: string
  timp_pauza_zile: number
  operator?: string
  observatii?: string
}

interface EditActivitateAgricolaDialogProps {
  activitate: ActivitateAgricola | null
  open: boolean
  onOpenChange: (open: boolean) => void
}

// ===============================
// COMPONENT
// ===============================

export function EditActivitateAgricolaDialog({
  activitate,
  open,
  onOpenChange,
}: EditActivitateAgricolaDialogProps) {
  const queryClient = useQueryClient()

  // RLS-first: fÄƒrÄƒ tenantId
  const { data: parcele = [] } = useQuery({
    queryKey: ['parcele'],
    queryFn: getParcele,
  })

  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<ActivitateFormData>({
    resolver: zodResolver(activitateSchema),
  })

  useEffect(() => {
    if (activitate && open) {
      reset({
        data_aplicare: activitate.data_aplicare.split('T')[0],
        parcela_id: activitate.parcela_id ?? '',
        tip_activitate: activitate.tip_activitate ?? '',
        produs_utilizat: activitate.produs_utilizat ?? '',
        doza: activitate.doza ?? '',
        timp_pauza_zile: activitate.timp_pauza_zile.toString(),
        operator: activitate.operator ?? '',
        observatii: activitate.observatii ?? '',
      })
    }
  }, [activitate, open, reset])

  const updateMutation = useMutation({
    mutationFn: ({ id, data }: { id: string; data: UpdateActivitateInput }) =>
      updateActivitateAgricola(id, data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['activitati-agricole'] })
      toast.success('Activitate actualizatÄƒ cu succes!')
      onOpenChange(false)
    },
    onError: (error) => {
      console.error('Error updating activitate agricola:', error)
      toast.error('Eroare la actualizarea activitÄƒÈ›ii')
    },
  })

  const onSubmit = (data: ActivitateFormData) => {
    if (!activitate) return

    const payload: UpdateActivitateInput = {
      data_aplicare: data.data_aplicare,
      parcela_id: data.parcela_id || undefined,
      tip_activitate: data.tip_activitate,
      produs_utilizat: data.produs_utilizat || undefined,
      doza: data.doza || undefined,
      timp_pauza_zile: data.timp_pauza_zile
        ? Number(data.timp_pauza_zile)
        : 0,
      operator: data.operator || undefined,
      observatii: data.observatii || undefined,
    }

    updateMutation.mutate({
      id: activitate.id,
      data: payload,
    })
  }

  if (!activitate) return null

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-3xl max-h-[95vh] overflow-y-auto bg-white">
        <DialogHeader>
          <DialogTitle>
            EditeazÄƒ Activitate: {activitate.id_activitate}
          </DialogTitle>
        </DialogHeader>

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4 pb-4">
          <div>
            <Label htmlFor="data_aplicare">
              Data aplicÄƒrii <span className="text-red-500">*</span>
            </Label>
            <Input
              id="data_aplicare"
              type="date"
              {...register('data_aplicare')}
              className={errors.data_aplicare ? 'border-red-500' : ''}
            />
            {errors.data_aplicare && (
              <p className="text-sm text-red-500 mt-1">
                {errors.data_aplicare.message}
              </p>
            )}
          </div>

          <div>
            <Label htmlFor="tip_activitate">
              Tip activitate <span className="text-red-500">*</span>
            </Label>
            <select
              id="tip_activitate"
              {...register('tip_activitate')}
              className={`flex h-10 w-full rounded-md border px-3 py-2 text-sm bg-white ${
                errors.tip_activitate
                  ? 'border-red-500'
                  : 'border-gray-300'
              }`}
            >
              <option value="">SelecteazÄƒ tipul...</option>
              {TIPURI_ACTIVITATI.map((tip) => (
                <option key={tip} value={tip}>
                  {tip}
                </option>
              ))}
            </select>
          </div>

          <div>
            <Label htmlFor="parcela_id">ParcelÄƒ (opÈ›ional)</Label>
            <select
              id="parcela_id"
              {...register('parcela_id')}
              className="flex h-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm bg-white"
            >
              <option value="">FÄƒrÄƒ parcelÄƒ specificatÄƒ</option>
              {parcele.map((parcela: any) => (
                <option key={parcela.id} value={parcela.id}>
                  {parcela.id_parcela} - {parcela.nume_parcela}
                </option>
              ))}
            </select>
          </div>

          <div>
            <Label htmlFor="produs_utilizat">
              Produs utilizat (opÈ›ional)
            </Label>
            <Input
              id="produs_utilizat"
              type="text"
              {...register('produs_utilizat')}
            />
          </div>

          <div>
            <Label htmlFor="doza">DozÄƒ (opÈ›ional)</Label>
            <Input id="doza" type="text" {...register('doza')} />
          </div>

          <div>
            <Label htmlFor="timp_pauza_zile">Timp pauzÄƒ (zile)</Label>
            <Input
              id="timp_pauza_zile"
              type="number"
              min="0"
              {...register('timp_pauza_zile')}
            />
          </div>

          <div>
            <Label htmlFor="operator">Operator (opÈ›ional)</Label>
            <Input id="operator" type="text" {...register('operator')} />
          </div>

          <div>
            <Label htmlFor="observatii">ObservaÈ›ii (opÈ›ional)</Label>
            <Textarea id="observatii" rows={2} {...register('observatii')} />
          </div>

          <div className="flex justify-end gap-3 pt-4">
            <Button
              type="button"
              variant="outline"
              onClick={() => onOpenChange(false)}
            >
              AnuleazÄƒ
            </Button>
            <Button
              type="submit"
              disabled={updateMutation.isPending}
              className="bg-[#F16B6B] hover:bg-[#E05A5A]"
            >
              {updateMutation.isPending
                ? 'Se salveazÄƒ...'
                : 'SalveazÄƒ'}
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  )
}
</file>

<file path="src/components/cheltuieli/CheltuialaCard.tsx">
'use client';

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Pencil, Trash2, Calendar, Coins, ShoppingCart, FileText } from 'lucide-react';
import type { Cheltuiala } from '@/lib/supabase/queries/cheltuieli';

interface CheltuialaCardProps {
  cheltuiala: Cheltuiala;
  onEdit: (cheltuiala: Cheltuiala) => void;
  onDelete: (id: string, name: string) => void;
}

export function CheltuialaCard({ cheltuiala, onEdit, onDelete }: CheltuialaCardProps) {
  const dataFormatted = new Date(cheltuiala.data).toLocaleDateString('ro-RO', {
    day: '2-digit',
    month: 'long',
    year: 'numeric',
  });

  const getCategorieColor = (categorie: string) => {
    const colorMap: Record<string, string> = {
      'Electricitate': 'bg-yellow-100 text-yellow-800',
      'MotorinÄƒ Transport': 'bg-red-100 text-red-800',
      'Ambalaje': 'bg-blue-100 text-blue-800',
      'Fertilizare': 'bg-green-100 text-green-800',
      'Pesticide': 'bg-orange-100 text-orange-800',
      'Cules': 'bg-purple-100 text-purple-800',
      'Material SÄƒditor': 'bg-pink-100 text-pink-800',
    };
    return colorMap[categorie] || 'bg-gray-100 text-gray-800';
  };

  return (
    <Card className="hover:shadow-lg transition-shadow">
      <CardHeader className="pb-3">
        <div className="flex items-start justify-between">
          <div className="flex-1">
            <div className="flex items-center gap-2 mb-2">
              <CardTitle className="text-lg font-semibold">
                {cheltuiala.suma_lei} lei
              </CardTitle>
              <Badge className={getCategorieColor(cheltuiala.categorie || "Altele")}>
                {cheltuiala.categorie || "Altele"}
              </Badge>
            </div>
            <p className="text-sm text-muted-foreground">
              ID: {cheltuiala.id_cheltuiala}
            </p>
          </div>
        </div>
      </CardHeader>

      <CardContent className="space-y-3">
        <div className="flex items-center gap-2 text-sm">
          <Calendar className="w-4 h-4 text-muted-foreground" />
          <span>{dataFormatted}</span>
        </div>

        {cheltuiala.furnizor && (
          <div className="flex items-center gap-2 text-sm">
            <ShoppingCart className="w-4 h-4 text-muted-foreground" />
            <span>{cheltuiala.furnizor}</span>
          </div>
        )}

        {cheltuiala.descriere && (
          <div className="flex items-start gap-2 text-sm">
            <FileText className="w-4 h-4 text-muted-foreground mt-0.5" />
            <span className="text-muted-foreground text-xs line-clamp-2">
              {cheltuiala.descriere}
            </span>
          </div>
        )}

        <div className="flex items-center gap-2 text-sm pt-2 border-t">
          <Coins className="w-4 h-4 text-muted-foreground" />
          <span className="font-semibold text-lg" style={{ color: '#ef4444' }}>
            -{cheltuiala.suma_lei} lei
          </span>
        </div>

        <div className="flex gap-2 pt-3 border-t">
          <Button
            variant="outline"
            size="sm"
            className="flex-1"
            onClick={() => onEdit(cheltuiala)}
          >
            <Pencil className="w-4 h-4 mr-2" />
            EditeazÄƒ
          </Button>
          <Button
            variant="outline"
            size="sm"
            style={{ color: '#ef4444', borderColor: '#ef4444' }}
            onClick={() =>
              onDelete(
                cheltuiala.id,
                `${cheltuiala.categorie || "Altele"} - ${cheltuiala.suma_lei} lei`
              )
            }
          >
            <Trash2 className="w-4 h-4" />
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/investitii/InvestitieCard.tsx">
// src/components/investitii/InvestitieCard.tsx
'use client';

import { Card, CardContent, CardHeader } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Pencil, Trash2, Calendar, DollarSign, Package } from 'lucide-react';
import { Investitie, BADGE_COLORS } from '@/lib/supabase/queries/investitii';

interface InvestitieCardProps {
  investitie: Investitie;
  parcelaNume?: string; // Nume parcelÄƒ pentru display (optional)
  onEdit: (investitie: Investitie) => void;
  onDelete: (investitie: Investitie) => void;
}

export function InvestitieCard({
  investitie,
  parcelaNume,
  onEdit,
  onDelete,
}: InvestitieCardProps) {
  // Format date pentru display: DD.MM.YYYY
  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('ro-RO', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
    });
  };

  // Format sumÄƒ cu separator mii È™i 2 zecimale
  const formatSuma = (suma: number) => {
    return new Intl.NumberFormat('ro-RO', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    }).format(suma);
  };

  return (
    <Card className="hover:shadow-md transition-shadow">
      <CardHeader className="pb-3">
        <div className="flex items-start justify-between">
          <div className="flex-1">
            {/* ID investiÈ›ie + Categorie */}
            <div className="flex items-center gap-2 mb-2">
              <span className="font-semibold text-lg text-gray-900">
                {investitie.id_investitie}
              </span>
              <span
                className={`px-2 py-1 rounded-md text-xs font-medium ${
                  BADGE_COLORS[investitie.categorie || "Altele"] || 'bg-gray-100 text-gray-800'
                }`}
              >
                {investitie.categorie || "Altele"}
              </span>
            </div>

            {/* Data */}
            <div className="flex items-center gap-1.5 text-sm text-gray-600 mb-1">
              <Calendar className="h-4 w-4" />
              <span>{formatDate(investitie.data)}</span>
            </div>

            {/* ParcelÄƒ (dacÄƒ existÄƒ) */}
            {investitie.parcela_id && parcelaNume && (
              <div className="flex items-center gap-1.5 text-sm text-gray-600">
                <Package className="h-4 w-4" />
                <span>ParcelÄƒ: {parcelaNume}</span>
              </div>
            )}
          </div>

          {/* AcÈ›iuni */}
          <div className="flex gap-1">
            <Button
              variant="ghost"
              size="icon"
              onClick={() => onEdit(investitie)}
              className="h-8 w-8"
            >
              <Pencil className="h-4 w-4" />
            </Button>
            <Button
              variant="ghost"
              size="icon"
              onClick={() => onDelete(investitie)}
              className="h-8 w-8 text-red-600 hover:text-red-700 hover:bg-red-50"
            >
              <Trash2 className="h-4 w-4" />
            </Button>
          </div>
        </div>
      </CardHeader>

      <CardContent className="pt-0">
        {/* SumÄƒ (highlight roÈ™u - expense) */}
        <div className="flex items-center gap-2 mb-3 p-3 bg-red-50 rounded-lg border border-red-100">
          <DollarSign className="h-5 w-5 text-red-600" />
          <div className="flex-1">
            <div className="text-xs text-gray-600 mb-0.5">SumÄƒ investitÄƒ</div>
            <div className="text-2xl font-bold text-red-600">
              -{formatSuma(investitie.suma_lei)} lei
            </div>
          </div>
        </div>

        {/* Furnizor */}
        {investitie.furnizor && (
          <div className="text-sm mb-2">
            <span className="text-gray-600">Furnizor:</span>{' '}
            <span className="font-medium text-gray-900">{investitie.furnizor}</span>
          </div>
        )}

        {/* Descriere */}
        {investitie.descriere && (
          <div className="text-sm text-gray-600 border-t pt-2 mt-2">
            {investitie.descriere}
          </div>
        )}
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/Navbar.tsx">
'use client';

import LogoutButton from './LogoutButton';
import Link from 'next/link';
import { useEffect, useState } from 'react';
import { createClient } from '@/lib/supabase/client';
import type { User } from '@supabase/supabase-js';

export default function Navbar() {
  const [user, setUser] = useState<User | null>(null);
  const [farmName, setFarmName] = useState<string>('');
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const supabase = createClient();

    // VerificÄƒ sesiunea la mount
    const checkSession = async () => {
      try {
        const {
          data: { session },
        } = await supabase.auth.getSession();

        if (session?.user) {
          setUser(session.user);

          // Ia numele fermei
          const { data: tenant } = await supabase
            .from('tenants')
            .select('nume_ferma')
            .eq('owner_user_id', session.user.id)
            .single();

          if (tenant?.nume_ferma) {
            setFarmName(tenant.nume_ferma);
          }
        }
      } catch (error) {
        console.error('Eroare verificare sesiune:', error);
      } finally {
        setLoading(false);
      }
    };

    checkSession();

    // AscultÄƒ schimbÄƒri autentificare
    const {
      data: { subscription },
    } = supabase.auth.onAuthStateChange((_event, session) => {
      setUser(session?.user ?? null);
    });

    return () => {
      subscription.unsubscribe();
    };
  }, []);

  // DacÄƒ nu e logat, nu afiÈ™a navbar
  if (loading) return null;
  if (!user) return null;

  return (
    <nav className="bg-white border-b border-gray-200 sticky top-0 z-50">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between items-center h-16">
          {/* Logo + Nume FermÄƒ */}
          <div className="flex items-center gap-4">
            <Link href="/test" className="flex items-center gap-2">
              <span className="text-2xl">ğŸ“</span>
              <span className="text-xl font-bold text-[#312E3F]">Zmeurel OS</span>
            </Link>
            {farmName && (
              <span className="text-sm text-gray-500 hidden sm:block">| {farmName}</span>
            )}
          </div>

          {/* User Info + Logout */}
          <div className="flex items-center gap-4">
            {user.email && (
              <span className="text-sm text-gray-600 hidden md:block">ğŸ‘¤ {user.email}</span>
            )}
            <LogoutButton />
          </div>
        </div>
      </div>
    </nav>
  );
}
</file>

<file path="src/components/parcele/EditParcelaDialog.tsx">
'use client';

// ============================================================================
// EDIT PARCELA DIALOG
// Dialog pentru editare parcelÄƒ existentÄƒ (pre-fill cu date actuale)
// ============================================================================

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { Pencil, Loader2 } from 'lucide-react';
import { toast } from 'sonner';

import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';

import { updateParcela } from '@/lib/supabase/queries/parcele';
import type { Parcela } from '@/lib/supabase/queries/parcele';
type ParcelaUpdate = Partial<Omit<Parcela, 'id' | 'tenant_id' | 'id_parcela' | 'created_at' | 'updated_at'>>;

// ============================================================================
// PROPS
// ============================================================================

interface EditParcelaDialogProps {
  parcela: Parcela | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
  soiuriDisponibile: string[];
  onSuccess?: () => void;
}

// ============================================================================
// COMPONENT
// ============================================================================

export function EditParcelaDialog({
  parcela,
  open,
  onOpenChange,
  soiuriDisponibile,
  onSuccess,
}: EditParcelaDialogProps) {
  const router = useRouter();
  const [loading, setLoading] = useState(false);

  // Form state
  const [formData, setFormData] = useState({
    nume_parcela: '',
    suprafata_m2: '',
    soi_plantat: '',
    an_plantare: '',
    nr_plante: '',
    status: 'Activ',
    observatii: '',
  });

  // Pre-fill form cÃ¢nd se deschide dialog
  useEffect(() => {
    if (parcela) {
      setFormData({
        nume_parcela: parcela.nume_parcela,
        suprafata_m2: parcela.suprafata_m2.toString(),
        soi_plantat: parcela.soi_plantat || '',
        an_plantare: parcela.an_plantare.toString(),
        nr_plante: parcela.nr_plante?.toString() || '',
        status: parcela.status,
        observatii: parcela.observatii || '',
      });
    }
  }, [parcela]);

  // ============================================================================
  // HANDLERS
  // ============================================================================

  const handleInputChange = (field: string, value: string) => {
    setFormData((prev) => ({ ...prev, [field]: value }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!parcela) return;

    setLoading(true);

    try {
      // Validare
      if (!formData.nume_parcela || !formData.suprafata_m2 || !formData.an_plantare) {
        toast.error('CompleteazÄƒ cÃ¢mpurile obligatorii!');
        setLoading(false);
        return;
      }

      // Prepare update data
      const updateData: ParcelaUpdate = {
        nume_parcela: formData.nume_parcela,
        suprafata_m2: parseFloat(formData.suprafata_m2),
        soi_plantat: formData.soi_plantat || null,
        an_plantare: parseInt(formData.an_plantare, 10),
        nr_plante: formData.nr_plante ? parseInt(formData.nr_plante, 10) : null,
        status: formData.status,
        observatii: formData.observatii || null,
      };

      // Update Ã®n Supabase
      await updateParcela(parcela.id, updateData);

      // Success!
      toast.success(`ParcelÄƒ ${parcela.id_parcela} actualizatÄƒ! âœ…`);

      // Close dialog
      onOpenChange(false);

      // Callback
      if (onSuccess) {
        onSuccess();
      } else {
        router.refresh();
      }
    } catch (error) {
      console.error('Error updating parcela:', error);
      toast.error('Eroare la actualizare! ÃncearcÄƒ din nou.');
    } finally {
      setLoading(false);
    }
  };

  if (!parcela) return null;

  // ============================================================================
  // RENDER
  // ============================================================================

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-[500px] max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle className="text-2xl text-[#312E3F]">
            âœï¸ EditeazÄƒ ParcelÄƒ {parcela.id_parcela}
          </DialogTitle>
          <DialogDescription>
            ModificÄƒ detaliile parcelei {parcela.nume_parcela}.
          </DialogDescription>
        </DialogHeader>

        {/* Form */}
        <form onSubmit={handleSubmit} className="space-y-6 mt-4">
          {/* Nume ParcelÄƒ */}
          <div className="space-y-2">
            <Label htmlFor="nume_parcela" className="text-[#312E3F] font-semibold">
              Nume ParcelÄƒ *
            </Label>
            <Input
              id="nume_parcela"
              value={formData.nume_parcela}
              onChange={(e) => handleInputChange('nume_parcela', e.target.value)}
              required
              className="min-h-[48px] rounded-xl"
            />
          </div>

          {/* SuprafaÈ›Äƒ */}
          <div className="space-y-2">
            <Label htmlFor="suprafata_m2" className="text-[#312E3F] font-semibold">
              SuprafaÈ›Äƒ (mÂ²) *
            </Label>
            <Input
              id="suprafata_m2"
              type="number"
              step="0.01"
              value={formData.suprafata_m2}
              onChange={(e) => handleInputChange('suprafata_m2', e.target.value)}
              required
              className="min-h-[48px] rounded-xl"
            />
          </div>

          {/* Soi Plantat */}
          <div className="space-y-2">
            <Label htmlFor="soi_plantat" className="text-[#312E3F] font-semibold">
              Soi Plantat
            </Label>
            <Select
              value={formData.soi_plantat}
              onValueChange={(value) => handleInputChange('soi_plantat', value)}
            >
              <SelectTrigger className="min-h-[48px] rounded-xl">
                <SelectValue placeholder="SelecteazÄƒ soi..." />
              </SelectTrigger>
              <SelectContent>
                {soiuriDisponibile.map((soi) => (
                  <SelectItem key={soi} value={soi}>
                    {soi}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* An Plantare */}
          <div className="space-y-2">
            <Label htmlFor="an_plantare" className="text-[#312E3F] font-semibold">
              An Plantare *
            </Label>
            <Input
              id="an_plantare"
              type="number"
              min="2000"
              max={new Date().getFullYear()}
              value={formData.an_plantare}
              onChange={(e) => handleInputChange('an_plantare', e.target.value)}
              required
              className="min-h-[48px] rounded-xl"
            />
          </div>

          {/* Nr Plante */}
          <div className="space-y-2">
            <Label htmlFor="nr_plante" className="text-[#312E3F] font-semibold">
              NumÄƒr Plante
            </Label>
            <Input
              id="nr_plante"
              type="number"
              value={formData.nr_plante}
              onChange={(e) => handleInputChange('nr_plante', e.target.value)}
              className="min-h-[48px] rounded-xl"
            />
          </div>

          {/* Status */}
          <div className="space-y-2">
            <Label htmlFor="status" className="text-[#312E3F] font-semibold">
              Status
            </Label>
            <Select
              value={formData.status}
              onValueChange={(value) => handleInputChange('status', value)}
            >
              <SelectTrigger className="min-h-[48px] rounded-xl">
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="Activ">Activ</SelectItem>
                <SelectItem value="Inactiv">Inactiv</SelectItem>
                <SelectItem value="Ãn PregÄƒtire">Ãn PregÄƒtire</SelectItem>
              </SelectContent>
            </Select>
          </div>

          {/* Observatii */}
          <div className="space-y-2">
            <Label htmlFor="observatii" className="text-[#312E3F] font-semibold">
              ObservaÈ›ii
            </Label>
            <Input
              id="observatii"
              value={formData.observatii}
              onChange={(e) => handleInputChange('observatii', e.target.value)}
              className="min-h-[48px] rounded-xl"
            />
          </div>

          {/* Buttons */}
          <div className="flex gap-3 pt-4">
            <Button
              type="button"
              variant="outline"
              onClick={() => onOpenChange(false)}
              disabled={loading}
              className="flex-1 min-h-[48px] rounded-xl"
            >
              AnuleazÄƒ
            </Button>
            <Button
              type="submit"
              disabled={loading}
              className="flex-1 bg-[#F16B6B] hover:bg-[#E85A5A] text-white min-h-[48px] rounded-xl"
            >
              {loading ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  Se salveazÄƒ...
                </>
              ) : (
                <>
                  <Pencil className="mr-2 h-4 w-4" />
                  SalveazÄƒ ModificÄƒri
                </>
              )}
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/recoltari/EditRecoltareDialog.tsx">
'use client'

import { useEffect } from 'react'
import { useForm } from 'react-hook-form'
import { useMutation, useQueryClient } from '@tanstack/react-query'
import { Dialog, DialogContent } from '@/components/ui/dialog'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { updateRecoltare, Recoltare } from '@/lib/supabase/queries/recoltari'

interface Props {
  recoltare: Recoltare | null
  open: boolean
  onOpenChange: (open: boolean) => void
}

export function EditRecoltareDialog({
  recoltare,
  open,
  onOpenChange,
}: Props) {
  const queryClient = useQueryClient()

  const { register, handleSubmit, reset } = useForm()

  useEffect(() => {
    if (recoltare) {
      reset({
        data: recoltare.data,
        nr_caserole: recoltare.nr_caserole,
      })
    }
  }, [recoltare, reset])

  const mutation = useMutation({
    mutationFn: ({ id, data }: any) =>
      updateRecoltare(id, data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['recoltari'] })
      onOpenChange(false)
    },
  })

  const onSubmit = (data: any) => {
    if (!recoltare) return
    mutation.mutate({
      id: recoltare.id,
      data,
    })
  }

  if (!recoltare) return null

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="bg-white">
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-3">
          <Input type="date" {...register('data')} />
          <Input type="number" {...register('nr_caserole')} />
          <Button type="submit">SalveazÄƒ</Button>
        </form>
      </DialogContent>
    </Dialog>
  )
}
</file>

<file path="src/components/vanzari/EditVanzareDialog.tsx">
'use client';

import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';

import { Vanzare } from '@/lib/supabase/queries/vanzari';

interface EditVanzareDialogProps {
  vanzare: Vanzare | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

export function EditVanzareDialog({
  vanzare,
  open,
  onOpenChange,
}: EditVanzareDialogProps) {
  if (!vanzare) return null;

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>
            Editare VÃ¢nzare {vanzare.id_vanzare}
          </DialogTitle>
        </DialogHeader>

        <div className="space-y-2">
          <p><strong>Client:</strong> {vanzare.client_id}</p>
          <p><strong>Cantitate:</strong> {vanzare.cantitate_kg}</p>
          <p><strong>PreÈ› unitar:</strong> {vanzare.pret_unitar_lei} lei</p>
          <p><strong>Data:</strong> {vanzare.data}</p>
        </div>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/lib/supabase/queries/activitati-agricole.ts">
// src/lib/supabase/queries/activitati-agricole.ts
import { createClient } from '../client'

// ===============================
// CONSTANTS
// ===============================

export const TIPURI_ACTIVITATI = [
  'Tratament Fungicid',
  'Tratament Insecticid',
  'Tratament Erbicid',
  'Fertilizare OrganicÄƒ',
  'Fertilizare ChimicÄƒ',
  'Fertilizare FoliarÄƒ',
  'Irigare',
  'Tundere/CurÄƒÈ›are',
  'Altele',
] as const

// ===============================
// TYPES
// ===============================

export interface ActivitateAgricola {
  id: string
  id_activitate: string
  data_aplicare: string
  parcela_id: string | null
  tip_activitate: string | null
  produs_utilizat: string | null
  doza: string | null
  timp_pauza_zile: number
  operator: string | null
  observatii: string | null
  created_at: string
  updated_at: string
}

export interface CreateActivitateAgricolaInput {
  data_aplicare: string
  parcela_id?: string
  tip_activitate?: string
  produs_utilizat?: string
  doza?: string
  timp_pauza_zile?: number
  operator?: string
  observatii?: string
}

export interface UpdateActivitateAgricolaInput {
  data_aplicare?: string
  parcela_id?: string
  tip_activitate?: string
  produs_utilizat?: string
  doza?: string
  timp_pauza_zile?: number
  operator?: string
  observatii?: string
}

// ===============================
// INTERNAL HELPERS
// ===============================

async function generateNextId(): Promise<string> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from('activitati_agricole')
    .select('id_activitate')
    .order('created_at', { ascending: false })
    .limit(1)

  if (error) {
    console.error('Error fetching last activitate ID:', error)
    throw error
  }

  if (!data || data.length === 0) {
    return 'AA001'
  }

  const lastId = data[0].id_activitate
  const numericPart = parseInt(lastId.replace('AA', ''), 10)

  if (isNaN(numericPart)) {
    throw new Error(`Invalid id_activitate format: ${lastId}`)
  }

  const nextNumber = numericPart + 1
  return `AA${nextNumber.toString().padStart(3, '0')}`
}

// ===============================
// QUERIES (RLS-FIRST)
// ===============================

export async function getActivitatiAgricole(): Promise<ActivitateAgricola[]> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from('activitati_agricole')
    .select('*')
    .order('data_aplicare', { ascending: false })

  if (error) {
    console.error('Error fetching activitati:', error)
    throw error
  }

  return data ?? []
}

/**
 * CREATE ACTIVITATE AGRICOLA (RLS-FIRST)
 * 
 * ğŸ” RLS REQUIREMENTS:
 * - tenant_id MUST be set automatically via BEFORE INSERT trigger OR RLS WITH CHECK policy
 * - INSERT policy must exist with WITH CHECK validating tenant_id matches current user's tenant
 * 
 * ğŸ“‹ DB SCHEMA EXPECTATIONS:
 * - tenant_id: NOT NULL (required)
 * - tenant_id: No DEFAULT value (set via trigger)
 * 
 * ğŸ”§ REQUIRED TRIGGER (if not using RLS WITH CHECK to set):
 * CREATE FUNCTION set_tenant_id_activitati()
 * RETURNS trigger AS $$
 * BEGIN
 *   NEW.tenant_id := (
 *     SELECT id FROM tenants
 *     WHERE owner_user_id = auth.uid()
 *   );
 *   RETURN NEW;
 * END;
 * $$ LANGUAGE plpgsql;
 * 
 * CREATE TRIGGER set_tenant_before_insert_activitati
 * BEFORE INSERT ON activitati_agricole
 * FOR EACH ROW EXECUTE FUNCTION set_tenant_id_activitati();
 * 
 * ğŸ”’ REQUIRED RLS POLICY:
 * CREATE POLICY tenant_isolation_insert_activitati
 * ON activitati_agricole
 * FOR INSERT
 * WITH CHECK (
 *   tenant_id = (
 *     SELECT id FROM tenants
 *     WHERE owner_user_id = auth.uid()
 *   )
 * );
 */
export async function createActivitateAgricola(
  input: CreateActivitateAgricolaInput
): Promise<ActivitateAgricola> {
  const supabase = createClient()
  const nextId = await generateNextId()

  const { data, error } = await supabase
    .from('activitati_agricole')
    .insert({
      id_activitate: nextId,
      data_aplicare: input.data_aplicare,
      parcela_id: input.parcela_id ?? null,
      tip_activitate: input.tip_activitate ?? null,
      produs_utilizat: input.produs_utilizat ?? null,
      doza: input.doza ?? null,
      timp_pauza_zile: input.timp_pauza_zile ?? 0,
      operator: input.operator ?? null,
      observatii: input.observatii ?? null,
      // tenant_id is NOT included - must be set by trigger or RLS policy
    })
    .select()
    .single()

  if (error) {
    console.error('Error creating activitate:', error)
    throw error
  }

  return data
}

export async function updateActivitateAgricola(
  id: string,
  input: UpdateActivitateAgricolaInput
): Promise<ActivitateAgricola> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from('activitati_agricole')
    .update({
      ...input,
      updated_at: new Date().toISOString(),
    })
    .eq('id', id)
    .select()
    .single()

  if (error) {
    console.error('Error updating activitate:', error)
    throw error
  }

  return data
}

export async function deleteActivitateAgricola(id: string): Promise<void> {
  const supabase = createClient()

  const { error } = await supabase
    .from('activitati_agricole')
    .delete()
    .eq('id', id)

  if (error) {
    console.error('Error deleting activitate:', error)
    throw error
  }
}

// ===============================
// DOMAIN LOGIC
// ===============================

export function calculatePauseStatus(
  dataAplicare: string,
  timpPauzaZile: number
): {
  dataRecoltarePermisa: string
  status: 'OK' | 'PauzÄƒ'
} {
  const aplicareDate = new Date(dataAplicare)
  const recoltareDate = new Date(aplicareDate)
  recoltareDate.setDate(recoltareDate.getDate() + timpPauzaZile)

  const today = new Date()
  today.setHours(0, 0, 0, 0)

  return {
    dataRecoltarePermisa: recoltareDate.toISOString().split('T')[0],
    status: today >= recoltareDate ? 'OK' : 'PauzÄƒ',
  }
}
</file>

<file path="src/lib/supabase/queries/cheltuieli.ts">
// src/lib/supabase/queries/cheltuieli.ts
import { createClient } from '../client';

export interface Cheltuiala {
  id: string;
  id_cheltuiala: string;
  data: string;
  categorie: string | null;
  descriere: string | null;
  suma_lei: number;
  furnizor: string | null;
  document_url: string | null;
  created_at: string;
  updated_at: string;
}

export interface CreateCheltuialaInput {
  data: string;
  categorie?: string;
  descriere?: string;
  suma_lei: number;
  furnizor?: string;
  document_url?: string;
}

export interface UpdateCheltuialaInput {
  data?: string;
  categorie?: string;
  descriere?: string;
  suma_lei?: number;
  furnizor?: string;
  document_url?: string;
}

/**
 * ğŸ” RLS-FIRST ARCHITECTURE
 * 
 * tenant_id is NOT sent from client code.
 * RLS policies + database triggers handle tenant isolation.
 */

async function generateNextId(): Promise<string> {
  const supabase = createClient();

  const { data, error } = await supabase
    .from('cheltuieli_diverse')
    .select('id_cheltuiala')
    .order('created_at', { ascending: false })
    .limit(1);

  if (error) {
    console.error('Error fetching last cheltuiala ID:', error);
    return 'CH001';
  }

  if (!data || data.length === 0) {
    return 'CH001';
  }

  const lastId = data[0].id_cheltuiala;
  const numericPart = parseInt(lastId.replace('CH', ''), 10);

  if (isNaN(numericPart)) {
    console.error('Invalid ID format:', lastId);
    return 'CH001';
  }

  const nextNumber = numericPart + 1;
  return `CH${nextNumber.toString().padStart(3, '0')}`;
}

export async function getCheltuieli(): Promise<Cheltuiala[]> {
  const supabase = createClient();

  const { data, error } = await supabase
    .from('cheltuieli_diverse')
    .select('*')
    .order('data', { ascending: false });

  if (error) {
    console.error('Error fetching cheltuieli:', error);
    throw error;
  }

  return data ?? [];
}

/**
 * CREATE CHELTUIALA (RLS-FIRST)
 * 
 * ğŸ” RLS REQUIREMENTS:
 * - tenant_id MUST be set automatically via BEFORE INSERT trigger OR RLS WITH CHECK policy
 * - INSERT policy must exist with WITH CHECK validating tenant_id matches current user's tenant
 * 
 * ğŸ“‹ DB SCHEMA EXPECTATIONS:
 * - tenant_id: NOT NULL (required)
 * - tenant_id: No DEFAULT value (set via trigger)
 * 
 * ğŸ”§ REQUIRED TRIGGER (if not using RLS WITH CHECK to set):
 * CREATE FUNCTION set_tenant_id_cheltuieli()
 * RETURNS trigger AS $$
 * BEGIN
 *   NEW.tenant_id := (
 *     SELECT id FROM tenants
 *     WHERE owner_user_id = auth.uid()
 *   );
 *   RETURN NEW;
 * END;
 * $$ LANGUAGE plpgsql;
 * 
 * CREATE TRIGGER set_tenant_before_insert_cheltuieli
 * BEFORE INSERT ON cheltuieli_diverse
 * FOR EACH ROW EXECUTE FUNCTION set_tenant_id_cheltuieli();
 * 
 * ğŸ”’ REQUIRED RLS POLICY:
 * CREATE POLICY tenant_isolation_insert_cheltuieli
 * ON cheltuieli_diverse
 * FOR INSERT
 * WITH CHECK (
 *   tenant_id = (
 *     SELECT id FROM tenants
 *     WHERE owner_user_id = auth.uid()
 *   )
 * );
 */
export async function createCheltuiala(
  input: CreateCheltuialaInput
): Promise<Cheltuiala> {
  const supabase = createClient();
  const nextId = await generateNextId();

  const { data, error } = await supabase
    .from('cheltuieli_diverse')
    .insert({
      id_cheltuiala: nextId,
      data: input.data,
      categorie: input.categorie || null,
      descriere: input.descriere || null,
      suma_lei: input.suma_lei,
      furnizor: input.furnizor || null,
      document_url: input.document_url || null,
      // tenant_id is NOT included - must be set by trigger or RLS policy
    })
    .select()
    .single();

  if (error) {
    console.error('Error creating cheltuiala:', error);
    throw error;
  }

  return data;
}

export async function updateCheltuiala(
  id: string,
  input: UpdateCheltuialaInput
): Promise<Cheltuiala> {
  const supabase = createClient();

  const { data, error } = await supabase
    .from('cheltuieli_diverse')
    .update({
      ...input,
      updated_at: new Date().toISOString(),
    })
    .eq('id', id)
    .select()
    .single();

  if (error) {
    console.error('Error updating cheltuiala:', error);
    throw error;
  }

  return data;
}

export async function deleteCheltuiala(id: string): Promise<void> {
  const supabase = createClient();

  const { error } = await supabase
    .from('cheltuieli_diverse')
    .delete()
    .eq('id', id);

  if (error) {
    console.error('Error deleting cheltuiala:', error);
    throw error;
  }
}
</file>

<file path="src/lib/supabase/queries/clienti.ts">
import { createClient } from "@/lib/supabase/client"
import type { Tables } from "@/types/supabase"

export type Client = Tables<"clienti">

export interface CreateClientInput {
  nume_client: string
  telefon?: string | null
  email?: string | null
  adresa?: string | null
  pret_negociat_lei_kg?: number | null
  observatii?: string | null
}

export interface UpdateClientInput {
  nume_client?: string
  telefon?: string | null
  email?: string | null
  adresa?: string | null
  pret_negociat_lei_kg?: number | null
  observatii?: string | null
}

async function generateNextId(supabase: ReturnType<typeof createClient>): Promise<string> {
  const { data, error } = await supabase
    .from("clienti")
    .select("id_client")
    .order("created_at", { ascending: true })

  if (error) throw error

  const ids = (data ?? [])
    .map((r) => r.id_client)
    .filter((id) => id && /^C\d+$/.test(id))
    .map((id) => parseInt(id!.substring(1)))

  const maxId = ids.length > 0 ? Math.max(...ids) : 0
  return `C${String(maxId + 1).padStart(3, "0")}`
}

export async function getClienti(): Promise<Client[]> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from("clienti")
    .select("*")
    .order("created_at", { ascending: false })

  if (error) throw error
  return data ?? []
}

export async function createClienti(input: CreateClientInput): Promise<Client> {
  const supabase = createClient()

  const id_client = await generateNextId(supabase)

  const { data, error } = await supabase
    .from("clienti")
    .insert({
      id_client,
      nume_client: input.nume_client,
      telefon: input.telefon ?? null,
      email: input.email ?? null,
      adresa: input.adresa ?? null,
      pret_negociat_lei_kg: input.pret_negociat_lei_kg ?? null,
      observatii: input.observatii ?? null,
    })
    .select()
    .single()

  if (error) throw error
  return data
}

export async function updateClienti(
  id: string,
  input: UpdateClientInput
): Promise<Client> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from("clienti")
    .update({
      ...input,
      updated_at: new Date().toISOString(),
    })
    .eq("id", id)
    .select()
    .single()

  if (error) throw error
  return data
}

export async function deleteClienti(id: string): Promise<void> {
  const supabase = createClient()

  const { error } = await supabase
    .from("clienti")
    .delete()
    .eq("id", id)

  if (error) throw error
}
</file>

<file path="src/lib/supabase/queries/culegatori.ts">
import { createClient } from '../client'

// ========================================
// TYPES
// ========================================

export interface Culegator {
  id: string
  id_culegator: string
  nume_prenume: string
  tarif_lei_kg: number
  data_angajare: string | null
  status_activ: boolean
  telefon: string | null
  tip_angajare: string | null
  observatii: string | null
  created_at: string
  updated_at: string
}

export interface CreateCulegatorInput {
  nume_prenume: string
  tarif_lei_kg: number
  data_angajare?: string | null
  status_activ?: boolean
  telefon?: string | null
  tip_angajare?: string | null
  observatii?: string | null
}

export interface UpdateCulegatorInput {
  nume_prenume?: string
  tarif_lei_kg?: number
  data_angajare?: string | null
  status_activ?: boolean
  telefon?: string | null
  tip_angajare?: string | null
  observatii?: string | null
}

// ========================================
// GENERATE NEXT ID
// ========================================

async function generateNextId(
  supabase: ReturnType<typeof createClient>
): Promise<string> {
  const { data, error } = await supabase
    .from('culegatori')
    .select('id_culegator')
    .order('created_at', { ascending: true })

  if (error) throw error

  const ids = (data ?? [])
    .map((r) => r.id_culegator)
    .filter((id) => id && /^CUL\d+$/.test(id))
    .map((id) => parseInt(id!.substring(3)))

  const maxId = ids.length > 0 ? Math.max(...ids) : 0

  return `CUL${String(maxId + 1).padStart(3, '0')}`
}

// ========================================
// GET
// ========================================

export async function getCulegatori(): Promise<Culegator[]> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from('culegatori')
    .select('*')
    .order('created_at', { ascending: false })

  if (error) throw error

  return data ?? []
}

// ========================================
// CREATE (FIXED VERSION)
// ========================================

export async function createCulegator(
  input: CreateCulegatorInput
): Promise<Culegator> {
  const supabase = createClient()
  const id_culegator = await generateNextId(supabase)

  const payload = {
    id_culegator,
    nume_prenume: input.nume_prenume,
    tarif_lei_kg: input.tarif_lei_kg,
    data_angajare:
      input.data_angajare && input.data_angajare !== ''
        ? input.data_angajare
        : null,
    status_activ: input.status_activ ?? true,
    telefon:
      input.telefon && input.telefon !== '' ? input.telefon : null,
    tip_angajare:
      input.tip_angajare && input.tip_angajare !== ''
        ? input.tip_angajare
        : null,
    observatii:
      input.observatii && input.observatii !== ''
        ? input.observatii
        : null,
  }

  const { data, error } = await supabase
    .from('culegatori')
    .insert(payload)
    .select()
    .single()

  if (error) throw error

  return data
}

// ========================================
// UPDATE
// ========================================

export async function updateCulegator(
  id: string,
  input: UpdateCulegatorInput
): Promise<Culegator> {
  const supabase = createClient()

  const payload = {
    ...input,
    data_angajare:
      input.data_angajare && input.data_angajare !== ''
        ? input.data_angajare
        : null,
    telefon:
      input.telefon && input.telefon !== '' ? input.telefon : null,
    tip_angajare:
      input.tip_angajare && input.tip_angajare !== ''
        ? input.tip_angajare
        : null,
    observatii:
      input.observatii && input.observatii !== ''
        ? input.observatii
        : null,
    updated_at: new Date().toISOString(),
  }

  const { data, error } = await supabase
    .from('culegatori')
    .update(payload)
    .eq('id', id)
    .select()
    .single()

  if (error) throw error

  return data
}

// ========================================
// DELETE
// ========================================

export async function deleteCulegator(id: string): Promise<void> {
  const supabase = createClient()

  const { error } = await supabase
    .from('culegatori')
    .delete()
    .eq('id', id)

  if (error) throw error
}
</file>

<file path="src/lib/supabase/queries/investitii.ts">
// src/lib/supabase/queries/investitii.ts

import { createClient } from '../client'

// ===============================
// CONSTANTS
// ===============================

export const CATEGORII_INVESTITII = [
  'ButaÈ™i',
  'Sistem IrigaÈ›ie',
  'Solar / Tunel',
  'Utilaje',
  'Depozitare',
  'Ambalaje',
  'Altele',
] as const

// ğŸ”µ BADGE COLORS (pentru UI)
export const BADGE_COLORS: Record<string, string> = {
  'ButaÈ™i': 'bg-green-100 text-green-700',
  'Sistem IrigaÈ›ie': 'bg-blue-100 text-blue-700',
  'Solar / Tunel': 'bg-purple-100 text-purple-700',
  Utilaje: 'bg-yellow-100 text-yellow-700',
  Depozitare: 'bg-indigo-100 text-indigo-700',
  Ambalaje: 'bg-pink-100 text-pink-700',
  Altele: 'bg-gray-100 text-gray-700',
}

// ===============================
// TYPES
// ===============================

export interface Investitie {
  id: string
  id_investitie: string
  data: string
  parcela_id: string | null
  categorie: string | null
  furnizor: string | null
  descriere: string | null
  suma_lei: number
  created_at: string
  updated_at: string
}

export interface CreateInvestitieInput {
  data: string
  parcela_id?: string
  categorie: string
  furnizor?: string
  descriere?: string
  suma_lei: number
}

export interface UpdateInvestitieInput {
  data?: string
  parcela_id?: string
  categorie?: string
  furnizor?: string
  descriere?: string
  suma_lei?: number
}

// ===============================
// INTERNAL ID GENERATOR
// ===============================

async function generateNextId(): Promise<string> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from('investitii')
    .select('id_investitie')
    .order('created_at', { ascending: false })
    .limit(1)

  if (error) throw error

  if (!data || data.length === 0) return 'INV001'

  const lastId = data[0].id_investitie
  const numericPart = parseInt(lastId.replace('INV', ''), 10)

  if (isNaN(numericPart)) throw new Error('Invalid id_investitie format')

  const nextNumber = numericPart + 1
  return `INV${nextNumber.toString().padStart(3, '0')}`
}

// ===============================
// QUERIES (RLS-FIRST)
// ===============================

export async function getInvestitii(): Promise<Investitie[]> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from('investitii')
    .select('*')
    .order('data', { ascending: false })

  if (error) throw error

  return data ?? []
}

/**
 * CREATE INVESTITIE (RLS-FIRST)
 * 
 * ğŸ” RLS REQUIREMENTS:
 * - tenant_id MUST be set automatically via BEFORE INSERT trigger OR RLS WITH CHECK policy
 * - INSERT policy must exist with WITH CHECK validating tenant_id matches current user's tenant
 * 
 * ğŸ“‹ DB SCHEMA EXPECTATIONS:
 * - tenant_id: NOT NULL (required)
 * - tenant_id: No DEFAULT value (set via trigger)
 * 
 * ğŸ”§ REQUIRED TRIGGER (if not using RLS WITH CHECK to set):
 * CREATE FUNCTION set_tenant_id_investitii()
 * RETURNS trigger AS $$
 * BEGIN
 *   NEW.tenant_id := (
 *     SELECT id FROM tenants
 *     WHERE owner_user_id = auth.uid()
 *   );
 *   RETURN NEW;
 * END;
 * $$ LANGUAGE plpgsql;
 * 
 * CREATE TRIGGER set_tenant_before_insert_investitii
 * BEFORE INSERT ON investitii
 * FOR EACH ROW EXECUTE FUNCTION set_tenant_id_investitii();
 * 
 * ğŸ”’ REQUIRED RLS POLICY:
 * CREATE POLICY tenant_isolation_insert_investitii
 * ON investitii
 * FOR INSERT
 * WITH CHECK (
 *   tenant_id = (
 *     SELECT id FROM tenants
 *     WHERE owner_user_id = auth.uid()
 *   )
 * );
 */
export async function createInvestitie(
  input: CreateInvestitieInput
): Promise<Investitie> {
  const supabase = createClient()
  const nextId = await generateNextId()

  const { data, error } = await supabase
    .from('investitii')
    .insert({
      id_investitie: nextId,
      data: input.data,
      parcela_id: input.parcela_id ?? null,
      categorie: input.categorie,
      furnizor: input.furnizor ?? null,
      descriere: input.descriere ?? null,
      suma_lei: input.suma_lei,
      // tenant_id is NOT included - must be set by trigger or RLS policy
    })
    .select()
    .single()

  if (error) throw error

  return data
}

export async function updateInvestitie(
  id: string,
  input: UpdateInvestitieInput
): Promise<Investitie> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from('investitii')
    .update({
      ...input,
      updated_at: new Date().toISOString(),
    })
    .eq('id', id)
    .select()
    .single()

  if (error) throw error

  return data
}

export async function deleteInvestitie(id: string): Promise<void> {
  const supabase = createClient()

  const { error } = await supabase
    .from('investitii')
    .delete()
    .eq('id', id)

  if (error) throw error
}
</file>

<file path="src/lib/supabase/queries/recoltari.ts">
import { createClient } from '../client'

// ===============================
// TYPES (ALINIATE LA DB REAL)
// ===============================

export interface Recoltare {
  id: string
  id_recoltare: string
  data: string

  parcela_id: string | null
  culegator_id: string | null

  nr_caserole: number
  tara_kg: number

  observatii: string | null

  created_at: string
  updated_at: string
}

export interface CreateRecoltareInput {
  data: string
  parcela_id: string
  culegator_id: string

  nr_caserole: number
  tara_kg: number

  observatii?: string
}

export interface UpdateRecoltareInput {
  data?: string
  parcela_id?: string
  culegator_id?: string

  nr_caserole?: number
  tara_kg?: number

  observatii?: string
}

// ===============================
// INTERNAL ID GENERATOR
// ===============================

async function generateNextId(): Promise<string> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from('recoltari')
    .select('id_recoltare')
    .order('created_at', { ascending: false })
    .limit(1)

  if (error) throw error

  if (!data || data.length === 0) return 'REC001'

  const lastId = data[0].id_recoltare
  const numericPart = parseInt(lastId.replace('REC', ''), 10)

  if (isNaN(numericPart)) throw new Error('Invalid id_recoltare format')

  const nextNumber = numericPart + 1
  return `REC${nextNumber.toString().padStart(3, '0')}`
}

// ===============================
// QUERIES (RLS-FIRST)
// ===============================

export async function getRecoltari(): Promise<Recoltare[]> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from('recoltari')
    .select('*')
    .order('data', { ascending: false })

  if (error) throw error

  return data ?? []
}

export async function createRecoltare(
  input: CreateRecoltareInput
): Promise<Recoltare> {
  const supabase = createClient()
  const nextId = await generateNextId()

  const { data, error } = await supabase
    .from('recoltari')
    .insert({
      id_recoltare: nextId,
      data: input.data,
      parcela_id: input.parcela_id,
      culegator_id: input.culegator_id,
      nr_caserole: input.nr_caserole,
      tara_kg: input.tara_kg,
      observatii: input.observatii ?? null,
    })
    .select()
    .single()

  if (error) throw error

  return data
}

export async function updateRecoltare(
  id: string,
  input: UpdateRecoltareInput
): Promise<Recoltare> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from('recoltari')
    .update({
      ...input,
      updated_at: new Date().toISOString(),
    })
    .eq('id', id)
    .select()
    .single()

  if (error) throw error

  return data
}

export async function deleteRecoltare(id: string): Promise<void> {
  const supabase = createClient()

  const { error } = await supabase
    .from('recoltari')
    .delete()
    .eq('id', id)

  if (error) throw error
}
</file>

<file path="src/lib/supabase/queries/vanzari.ts">
// src/lib/supabase/queries/vanzari.ts
import { createClient } from '../client';

// Constants
export const STATUS_PLATA = ['PlÄƒtit', 'RestanÈ›Äƒ', 'Avans'] as const;

export interface Vanzare {
  id: string;
  id_vanzare: string;
  data: string;
  client_id: string | null;
  cantitate_kg: number;
  pret_lei_kg: number;
  pret_unitar_lei: number;
  status_plata: string;
  observatii_ladite: string | null;
  created_at: string;
  updated_at: string;
}

export interface CreateVanzareInput {
  data: string;
  client_id?: string;
  cantitate_kg: number;
  pret_lei_kg: number;
  status_plata?: string;
  observatii_ladite?: string;
}

export interface UpdateVanzareInput {
  data?: string;
  client_id?: string;
  cantitate_kg?: number;
  pret_lei_kg?: number;
  status_plata?: string;
  observatii_ladite?: string;
}

async function generateNextId(): Promise<string> {
  const supabase = createClient();

  const { data, error } = await supabase
    .from('vanzari')
    .select('id_vanzare')
    .order('created_at', { ascending: false })
    .limit(1);

  if (error) {
    console.error('Error fetching last vanzare ID:', error);
    return 'V001';
  }

  if (!data || data.length === 0) {
    return 'V001';
  }

  const lastId = data[0].id_vanzare;
  const numericPart = parseInt(lastId.replace('V', ''), 10);
  
  if (isNaN(numericPart)) {
    console.error('Invalid ID format:', lastId);
    return 'V001';
  }
  
  const nextNumber = numericPart + 1;
  return `V${nextNumber.toString().padStart(3, '0')}`;
}

export async function getVanzari(): Promise<Vanzare[]> {
  const supabase = createClient();

  const { data, error } = await supabase
    .from('vanzari')
    .select('*')
    .order('data', { ascending: false });

  if (error) {
    console.error('Error fetching vanzari:', error);
    throw error;
  }

  return data || [];
}

export async function createVanzare(input: CreateVanzareInput): Promise<Vanzare> {
  const supabase = createClient();
  const nextId = await generateNextId();

  const { data, error } = await supabase
    .from('vanzari')
    .insert({
      id_vanzare: nextId,
      data: input.data,
      client_id: input.client_id || null,
      cantitate_kg: input.cantitate_kg,
      pret_lei_kg: input.pret_lei_kg,
      status_plata: input.status_plata || 'PlÄƒtit',
      observatii_ladite: input.observatii_ladite || null,
    })
    .select()
    .single();

  if (error) {
    console.error('Error creating vanzare:', error);
    throw error;
  }

  return data;
}

export async function updateVanzare(id: string, input: UpdateVanzareInput): Promise<Vanzare> {
  const supabase = createClient();

  const { data, error } = await supabase
    .from('vanzari')
    .update({
      ...input,
      updated_at: new Date().toISOString(),
    })
    .eq('id', id)
    .select()
    .single();

  if (error) {
    console.error('Error updating vanzare:', error);
    throw error;
  }

  return data;
}

export async function deleteVanzare(id: string): Promise<void> {
  const supabase = createClient();

  const { error } = await supabase.from('vanzari').delete().eq('id', id);

  if (error) {
    console.error('Error deleting vanzare:', error);
    throw error;
  }
}
</file>

<file path="package.json">
{
  "name": "zmeurel",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "lint": "eslint",
    "typecheck": "tsc --noEmit",
    "prebuild": "node scripts/check-env.js",
    "build": "next build",
    "check": "npm run lint && npm run typecheck && npm run build",
    "start": "next start"
  },
  "dependencies": {
    "@hookform/resolvers": "^5.2.2",
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-label": "^2.1.8",
    "@radix-ui/react-slot": "^1.2.4",
    "@supabase/auth-helpers-nextjs": "^0.15.0",
    "@supabase/ssr": "^0.8.0",
    "@supabase/supabase-js": "^2.95.3",
    "@tanstack/react-query": "^5.90.20",
    "@tanstack/react-table": "^8.21.3",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "dotenv": "^17.3.1",
    "lucide-react": "^0.563.0",
    "next": "16.1.6",
    "next-themes": "^0.4.6",
    "radix-ui": "^1.4.3",
    "react": "19.2.3",
    "react-dom": "19.2.3",
    "react-hook-form": "^7.71.1",
    "sonner": "^2.0.7",
    "tailwind-merge": "^3.4.0",
    "zod": "^4.3.6",
    "zustand": "^5.0.11"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.1.6",
    "shadcn": "^3.8.4",
    "tailwindcss": "^4",
    "tw-animate-css": "^1.4.0",
    "typescript": "^5"
  }
}
</file>

<file path="PROGRES.md">
# ğŸ“Š PROGRES ZMEUREL OS - ERP Agricol

**Proiect:** Zmeurel OS - AplicaÈ›ie ERP pentru plantaÈ›ii zmeurÄƒ/mure  
**Developer:** Popa Andrei (cu asistenÈ›Äƒ Claude AI)  
**Tech Stack:** Next.js 15, Supabase, TypeScript, Tailwind CSS v4 alpha, shadcn/ui  
**Ãšltima actualizare:** 13 Februarie 2026

---

## ğŸ¯ STATUS GENERAL: **~60% MVP COMPLET** ğŸ”¥

### âœ… **GATA (100% funcÈ›ional):**
- **Authentication system** (Supabase Auth)
- **Database setup** (11 tabele + RLS policies)
- **Layout & Providers** (QueryClient global, Toast notifications)
- **Modul Parcele** - CRUD complet âœ…
- **Modul CulegÄƒtori** - CRUD complet âœ…
- **Modul ClienÈ›i** - CRUD complet âœ…
- **Modul Cheltuieli Diverse** - CRUD complet âœ…
- **DeleteConfirmDialog** - Generic pentru toate modulele âœ…

### ğŸš§ **NEXT STEPS:**
- Modul InvestiÈ›ii (CAPEX)
- Modul VÃ¢nzÄƒri ButaÈ™i
- Modul RecoltÄƒri (complex - cu calcule)
- Modul VÃ¢nzÄƒri (complex - cu calcule)
- Modul ActivitÄƒÈ›i Agricole (complex - cu TIMP PAUZÄ‚)
- Dashboard cu KPIs

---

## ğŸ“… ISTORIC SESIUNI DEZVOLTARE

### **SESIUNEA 13 FEBRUARIE 2026** â­ 3 MODULE NOI COMPLETE

**DuratÄƒ:** ~3 ore  
**RealizÄƒri majore:**

#### âœ… **1. MODUL CULEGÄ‚TORI** (Complet)

**FiÈ™iere create:**
- `src/lib/supabase/queries/culegatori.ts` - CRUD functions
- `src/components/culegatori/CulegatorCard.tsx` - Display card
- `src/components/culegatori/AddCulegatorDialog.tsx` - Create dialog
- `src/components/culegatori/EditCulegatorDialog.tsx` - Edit dialog
- `src/app/(dashboard)/culegatori/page.tsx` - Server component
- `src/app/(dashboard)/culegatori/CulegatorPageClient.tsx` - Client component

**Features implementate:**
- âœ… ID auto-generat: C001, C002, C003...
- âœ… CRUD complet (Create, Read, Update, Delete)
- âœ… CÃ¢mpuri: Nume, Telefon, Tip angajare, Tarif lei/kg, Data angajare, Status activ
- âœ… Separare vizualÄƒ: Activi vs Inactivi
- âœ… Badge colors: Permanent (verde), Sezonier (albastru)
- âœ… Display "Salarizat fix" pentru tarif 0
- âœ… Stats cards: Total, Activi, Inactivi
- âœ… Search: Nume, telefon, ID

---

#### âœ… **2. MODUL CLIENÈšI** (Complet)

**FiÈ™iere create:**
- `src/lib/supabase/queries/clienti.ts` - CRUD functions (âš ï¸ FIX import conflict)
- `src/components/clienti/ClientCard.tsx` - Display card
- `src/components/clienti/AddClientDialog.tsx` - Create dialog
- `src/components/clienti/EditClientDialog.tsx` - Edit dialog
- `src/app/(dashboard)/clienti/page.tsx` - Server component
- `src/app/(dashboard)/clienti/ClientPageClient.tsx` - Client component

**Features implementate:**
- âœ… ID auto-generat: CL001, CL002, CL003...
- âœ… CRUD complet
- âœ… CÃ¢mpuri: Nume, Telefon, Email, AdresÄƒ, PreÈ› negociat, ObservaÈ›ii
- âœ… Separare: ClienÈ›i cu preÈ› special vs PreÈ› standard
- âœ… Badge "PreÈ› Special" (verde) pentru clienÈ›i cu preÈ› negociat
- âœ… Click-to-call (telefon), Click-to-mail (email)
- âœ… Stats cards: Total, Cu preÈ› special, PreÈ› standard
- âœ… Search: Nume, telefon, email, adresÄƒ, ID
- âœ… Validare email cu Zod

**FIX aplicat:**
- Import conflict `createClient` â†’ `createClient as createSupabaseClient`
- 7 locaÈ›ii actualizate Ã®n `clienti.ts`

---

#### âœ… **3. MODUL CHELTUIELI DIVERSE** (Complet)

**FiÈ™iere create:**
- `src/lib/supabase/queries/cheltuieli.ts` - CRUD functions + helpers
- `src/components/cheltuieli/CheltuialaCard.tsx` - Display card
- `src/components/cheltuieli/AddCheltuialaDialog.tsx` - Create dialog
- `src/components/cheltuieli/EditCheltuialaDialog.tsx` - Edit dialog
- `src/app/(dashboard)/cheltuieli/page.tsx` - Server component
- `src/app/(dashboard)/cheltuieli/CheltuialaPageClient.tsx` - Client component

**Features implementate:**
- âœ… ID auto-generat: CH001, CH002, CH003...
- âœ… CRUD complet
- âœ… CÃ¢mpuri: Data, Categorie (14 opÈ›iuni), SumÄƒ, Furnizor, Descriere
- âœ… 14 categorii OPEX: Electricitate, MotorinÄƒ, Ambalaje, Pesticide, etc.
- âœ… Badge colors: Fiecare categorie are culoare specificÄƒ
- âœ… Sortare: Cele mai recente primero (data DESC)
- âœ… Stats cards: Total cheltuieli, SumÄƒ totalÄƒ (roÈ™u), Medie/cheltuialÄƒ
- âœ… Filtru pe lunÄƒ: Dropdown cu toate lunile disponibile
- âœ… Search: Categorie, furnizor, descriere, ID
- âœ… Data precompletatÄƒ: Formular cu data de azi automat
- âœ… SumÄƒ highlight roÈ™u: -XXX lei (evidenÈ›iat ca expense)

**FuncÈ›ii bonus:**
- âœ… `getCheltuieliByPeriod(startDate, endDate)` - Filtru Ã®ntre 2 date
- âœ… `getTotalByCategorie(categorie)` - Total sumÄƒ per categorie

---

#### âœ… **4. LAYOUT & PROVIDERS** (InfrastructurÄƒ globalÄƒ)

**FiÈ™iere create:**
- `src/app/(dashboard)/layout.tsx` - Layout comun pentru toate paginile
- `src/app/(dashboard)/providers.tsx` - QueryClient + Toaster wrapper

**Ce rezolvÄƒ:**
- âœ… QueryClient disponibil pe TOATE paginile dashboard
- âœ… Toast notifications funcÈ›ionale global
- âœ… Header comun: "ğŸ“ Zmeurel OS" (sticky top)
- âœ… Background gri: bg-gray-50
- âœ… Eliminat eroarea "No QueryClient set"

**Fix aplicat:**
- Eroare QueryClient â†’ Wrapping cu Providers Ã®n layout.tsx

---

#### âœ… **5. DELETE CONFIRMATION GENERIC**

**FiÈ™ier actualizat:**
- `src/components/parcele/DeleteConfirmDialog.tsx` - Versiune genericÄƒ

**FIX aplicat:**
- Hard-coded text "Parcela va fi È™tearsÄƒ..." â†’ Dynamic bazat pe `itemType`
- Suport pentru: parcelÄƒ, culegÄƒtor, client, cheltuialÄƒ, etc.
- Mesaje custom pentru fiecare tip de item

**Utilizare:**
```tsx
<DeleteConfirmDialog
  itemName="Popescu Ion"
  itemType="culegÄƒtor"  // â¬…ï¸ Mesaj automat: "CulegÄƒtorul va fi È™ters..."
/>
```

---

### ğŸ“Š **METRICI SESIUNE 13 FEBRUARIE:**

**FiÈ™iere create/modificate:** ~25 fiÈ™iere  
**Module complete:** 3 noi (CulegÄƒtori, ClienÈ›i, Cheltuieli)  
**Erori critice rezolvate:** 2 majore  
**Timp total:** ~3 ore  
**Rezultat:** 60% MVP complet âœ…

---

### **SESIUNEA 12 FEBRUARIE 2026** (Recap)

**RealizÄƒri:**
- âœ… Modul Parcele 100% funcÈ›ional
- âœ… Fix Supabase connection (@supabase/ssr)
- âœ… Fix Dialog backdrop (Tailwind v4 alpha issue)
- âœ… Fix Delete handler (state management)
- âœ… Fix Dropdown soiuri (native HTML select)
- âœ… Fix Hydration errors
- âœ… Query Client Provider setup

---

## ğŸ—‚ï¸ STRUCTURÄ‚ PROIECT CURENTÄ‚

```
zmeurel/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ (auth)/
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ register/
â”‚   â”‚   â””â”€â”€ (dashboard)/
â”‚   â”‚       â”œâ”€â”€ layout.tsx           âœ… Layout global dashboard
â”‚   â”‚       â”œâ”€â”€ providers.tsx        âœ… QueryClient + Toaster
â”‚   â”‚       â”œâ”€â”€ parcele/
â”‚   â”‚       â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚       â”‚   â””â”€â”€ ParcelaPageClient.tsx
â”‚   â”‚       â”œâ”€â”€ culegatori/          âœ… NOU
â”‚   â”‚       â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚       â”‚   â””â”€â”€ CulegatorPageClient.tsx
â”‚   â”‚       â”œâ”€â”€ clienti/             âœ… NOU
â”‚   â”‚       â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚       â”‚   â””â”€â”€ ClientPageClient.tsx
â”‚   â”‚       â””â”€â”€ cheltuieli/          âœ… NOU
â”‚   â”‚           â”œâ”€â”€ page.tsx
â”‚   â”‚           â””â”€â”€ CheltuialaPageClient.tsx
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                      âœ… shadcn components
â”‚   â”‚   â”œâ”€â”€ parcele/
â”‚   â”‚   â”‚   â”œâ”€â”€ ParcelaCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AddParcelaDialog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EditParcelaDialog.tsx
â”‚   â”‚   â”‚   â””â”€â”€ DeleteConfirmDialog.tsx  âœ… GENERIC
â”‚   â”‚   â”œâ”€â”€ culegatori/              âœ… NOU
â”‚   â”‚   â”‚   â”œâ”€â”€ CulegatorCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AddCulegatorDialog.tsx
â”‚   â”‚   â”‚   â””â”€â”€ EditCulegatorDialog.tsx
â”‚   â”‚   â”œâ”€â”€ clienti/                 âœ… NOU
â”‚   â”‚   â”‚   â”œâ”€â”€ ClientCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AddClientDialog.tsx
â”‚   â”‚   â”‚   â””â”€â”€ EditClientDialog.tsx
â”‚   â”‚   â””â”€â”€ cheltuieli/              âœ… NOU
â”‚   â”‚       â”œâ”€â”€ CheltuialaCard.tsx
â”‚   â”‚       â”œâ”€â”€ AddCheltuialaDialog.tsx
â”‚   â”‚       â””â”€â”€ EditCheltuialaDialog.tsx
â”‚   â””â”€â”€ lib/
â”‚       â””â”€â”€ supabase/
â”‚           â”œâ”€â”€ client.ts            âœ… Browser client
â”‚           â”œâ”€â”€ server.ts            âœ… Server client
â”‚           â””â”€â”€ queries/
â”‚               â”œâ”€â”€ parcele.ts
â”‚               â”œâ”€â”€ culegatori.ts    âœ… NOU
â”‚               â”œâ”€â”€ clienti.ts       âœ… NOU (cu fix import)
â”‚               â””â”€â”€ cheltuieli.ts    âœ… NOU
```

---

## ğŸ—„ï¸ DATABASE SCHEMA (Supabase)

### **Tabele active cu date:**

**1. tenants** - Multi-tenancy âœ…
- Tenant ID: `b68a19a7-c5fc-4f30-94a2-b3c17af68f76`
- Owner: popa.andrei.sv@gmail.com

**2. nomenclatoare** - Dropdown values âœ…
- 5 soiuri: Polka, Tulameen, Heritage, Loch Ness, Chester
- Categorii InvestiÈ›ii (6)
- Tipuri ActivitÄƒÈ›i (9)
- Categorii Cheltuieli (14) âœ…

**3. parcele** - PlantaÈ›ii âœ… CRUD FUNCÈšIONAL
- Auto ID: P001, P002...
- Calcule: densitate plante/mÂ², vÃ¢rstÄƒ ani

**4. culegatori** - EchipÄƒ recoltare âœ… CRUD FUNCÈšIONAL
- Auto ID: C001, C002...
- Status activ/inactiv
- Tarif lei/kg sau salarizat fix

**5. clienti** - BazÄƒ cumpÄƒrÄƒtori âœ… CRUD FUNCÈšIONAL
- Auto ID: CL001, CL002...
- PreÈ› negociat opÈ›ional
- Email validation

**6. cheltuieli_diverse** - OPEX tracking âœ… CRUD FUNCÈšIONAL
- Auto ID: CH001, CH002...
- 14 categorii cheltuieli
- Sortare dupÄƒ datÄƒ (DESC)

**7-11. Tabele create, nefolosite Ã®ncÄƒ:**
- recoltari (producÈ›ie zilnicÄƒ)
- vanzari (vÃ¢nzÄƒri fructe)
- vanzari_butasi (vÃ¢nzÄƒri material sÄƒditor)
- investitii (CAPEX)
- activitati_agricole (tratamente, fertilizÄƒri)

---

## ğŸ” AUTENTIFICARE È˜I SECURITATE

**Status:** âœ… FuncÈ›ional

**Setup:**
- Supabase Auth enabled
- Email/password authentication
- Row Level Security (RLS) policies active pe TOATE tabelele
- Tenant isolation: users vÄƒd doar datele tenant-ului lor

**CredenÈ›iale test:**
- Email: popa.andrei.sv@gmail.com
- Tenant ID: b68a19a7-c5fc-4f30-94a2-b3c17af68f76

**Policy example:**
```sql
CREATE POLICY "tenant_isolation" ON parcele
FOR ALL
USING (
  tenant_id IN (
    SELECT id FROM tenants 
    WHERE owner_user_id = auth.uid()
  )
);
```

**Indexes pentru performanÈ›Äƒ:**
- `idx_parcele_tenant` ON parcele(tenant_id)
- `idx_culegatori_tenant` ON culegatori(tenant_id)
- `idx_clienti_tenant` ON clienti(tenant_id)
- `idx_cheltuieli_tenant` ON cheltuieli_diverse(tenant_id)

---

## ğŸ¨ DESIGN & UI

**Status:** FuncÈ›ional MVP (fÄƒrÄƒ branding complet)

**Culori branded (partial implementate):**
- Primary: #F16B6B (Bittersweet) - folosit Ã®n butoane "AdaugÄƒ"
- Secondary: #312E3F (Charade) - folosit Ã®n header
- Background: #FFFFFF

**Font:** System fonts (Nunito/Quicksand pentru versiunea branded viitoare)

**Componente UI:**
- shadcn/ui components (Tailwind CSS v4 alpha)
- Responsive design (mobile-first)
- Dialog overlays funcÈ›ionale cu inline styles (workaround Tailwind v4 alpha)
- Native HTML selects (workaround Radix UI compatibility issues)

**Header global:**
- Logo: ğŸ“ Zmeurel OS
- Sticky top, white background
- Border bottom gri

---

## ğŸ“¦ DEPENDINÈšE INSTALATE

```json
{
  "dependencies": {
    "next": "16.1.6",
    "@supabase/ssr": "latest",
    "@tanstack/react-query": "^5.x",
    "react-hook-form": "^7.x",
    "zod": "^3.x",
    "@hookform/resolvers": "^3.x",
    "sonner": "^1.x",
    "lucide-react": "^0.x",
    "tailwindcss": "4.0.0-alpha",
    "class-variance-authority": "^0.7.x",
    "@radix-ui/react-label": "^2.x",
    "@radix-ui/react-slot": "^1.x",
    "@radix-ui/react-dialog": "^1.x",
    "@radix-ui/react-alert-dialog": "^1.x"
  }
}
```

---

## ğŸ› ERORI REZOLVATE & LESSONS LEARNED

### **1. Import name conflicts**

**Simptom:** `createClient` definit de 2 ori Ã®n acelaÈ™i fiÈ™ier

**SoluÈ›ie:** 
```typescript
// Redenumire import Supabase
import { createClient as createSupabaseClient } from '../client';

// FuncÈ›ia noastrÄƒ rÄƒmÃ¢ne cu acelaÈ™i nume
export async function createClient(client: CreateClientInput) {
  const supabase = createSupabaseClient(); // âœ…
}
```

**Aplicat Ã®n:** `clienti.ts` (7 locaÈ›ii)

---

### **2. QueryClient Provider lipsÄƒ**

**Simptom:** `No QueryClient set, use QueryClientProvider to set one`

**SoluÈ›ie:** Layout wrapper cu Providers pentru toate paginile dashboard

**FiÈ™iere create:**
- `src/app/(dashboard)/layout.tsx`
- `src/app/(dashboard)/providers.tsx`

**Rezultat:** QueryClient + Toaster disponibile global

---

### **3. Delete confirmation hard-coded**

**Simptom:** Dialog delete afiÈ™a "Parcela va fi È™tearsÄƒ..." pentru TOATE tipurile

**SoluÈ›ie:** Component generic cu `itemType` prop

```tsx
const getDeleteMessage = (itemType: string) => {
  switch (itemType) {
    case 'parcelÄƒ': return 'Parcela va fi È™tearsÄƒ...';
    case 'culegÄƒtor': return 'CulegÄƒtorul va fi È™ters...';
    case 'client': return 'Clientul va fi È™ters...';
    // etc.
  }
};
```

---

### **4. Tailwind v4 alpha + Next.js 15 Turbopack = IncompatibilitÄƒÈ›i**

**Simptom:** Clase CSS nu se renderizeazÄƒ (opacity slash notation, backgrounds)

**SoluÈ›ie:** Style inline cu `style={{ ... }}` override Tailwind cÃ¢nd eÈ™ueazÄƒ

**Aplicat Ã®n:** 
- dialog.tsx (backdrop overlay)
- alert-dialog.tsx
- select.tsx (background white forÈ›at)
- Toate dialog-urile din module

---

### **5. Module not found - file not placed**

**Simptom:** `Can't resolve '@/lib/supabase/queries/clienti'`

**CauzÄƒ:** FiÈ™ierul generat nu a fost plasat Ã®n proiect

**SoluÈ›ie:** Verificare folder structure, plasare fiÈ™ier Ã®n locaÈ›ia corectÄƒ

---

### **6. Import paths Ã®n folder structures**

**GreÈ™it:** `import from './client'` din `queries/parcele.ts`  
**Corect:** `import from '../client'` (un nivel sus)

**Lesson:** VerificÄƒ ÃNTOTDEAUNA filepath relative cÃ¢nd ai subfolders

---

### **7. Supabase @supabase/ssr vs @supabase/supabase-js**

**Next.js 15 necesitÄƒ:** `@supabase/ssr` pentru Server/Client Components separation

**Metode:**
- Browser: `createBrowserClient()`
- Server: `createServerClient()` cu cookies handler

---

### **8. React Hook Form + Zod validation types**

**ProblemÄƒ:** TypeScript errors cu `z.coerce.number()` â†’ form expects string

**SoluÈ›ie:** Schema cu strings, conversie la submit:
```tsx
const schema = z.object({
  suma_lei: z.string().min(1),  // Form = string
});

const onSubmit = (data) => {
  createCheltuiala({
    suma_lei: Number(data.suma_lei),  // DB = number
  });
};
```

---

## ğŸ¯ PATTERN CONSOLIDAT - MODUL CRUD

DupÄƒ 4 module implementate, avem un **pattern repetat cu succes**:

### **StructurÄƒ standard:**

```
1. queries/[modul].ts
   - Interface TypeScript
   - CRUD functions (get, create, update, delete)
   - Helper functions (generateNextId, filters)
   
2. components/[modul]/
   - [Modul]Card.tsx - Display individual
   - Add[Modul]Dialog.tsx - Create form
   - Edit[Modul]Dialog.tsx - Update form
   
3. app/(dashboard)/[modul]/
   - page.tsx - Server Component (fetch data)
   - [Modul]PageClient.tsx - Client Component (UI + CRUD logic)
```

### **Features standard:**
- âœ… Auto-generated IDs (P001, C001, CL001, CH001)
- âœ… React Query (queries + mutations)
- âœ… Toast notifications (succes/eroare)
- âœ… Search functionality
- âœ… Stats cards
- âœ… Empty states
- âœ… Loading states
- âœ… Form validation (Zod)
- âœ… Delete confirmation

### **Timp mediu implementare:**
- Modul simplu (Cheltuieli): ~25 min
- Modul mediu (ClienÈ›i): ~30 min
- Modul complex (coming soon): ~45 min

---

## ğŸš€ NEXT STEPS (DupÄƒ backup)

### **Prioritate 1: Module CRUD simple** (fast wins)

**A) INVESTIÈšII** (~30 min)
- ID auto: INV001, INV002...
- CÃ¢mpuri: Data, ParcelÄƒ, Categorie, Furnizor, SumÄƒ, Descriere
- 6 categorii CAPEX: ButaÈ™i, Spalieri, Sistem IrigaÈ›ie, Transport, ManoperÄƒ, Alte

**B) VÃ‚NZÄ‚RI BUTAÈ˜I** (~35 min)
- ID auto: VB001, VB002...
- CÃ¢mpuri: Data, Client, ParcelÄƒ sursÄƒ, Soi, Cantitate, PreÈ› unitar
- Calcul automat: Valoare totalÄƒ = Cantitate Ã— PreÈ›

---

### **Prioritate 2: Module complexe** (cu calcule)

**C) RECOLTÄ‚RI** (~45 min)
- ID auto: R001, R002...
- RelaÈ›ii: CulegÄƒtor, ParcelÄƒ
- Calcule automate:
  - Cantitate brutÄƒ kg = Nr caserole Ã— 0.5
  - Cantitate netÄƒ kg = BrutÄƒ - TarÄƒ
  - Valoare muncÄƒ lei = NetÄƒ Ã— Tarif culegÄƒtor

**D) VÃ‚NZÄ‚RI** (~40 min)
- ID auto: V001, V002...
- RelaÈ›ii: Client
- Calcule automate:
  - Valoare totalÄƒ = Cantitate Ã— PreÈ›
  - PreÈ› override cu preÈ› negociat client (dacÄƒ existÄƒ)
- Status platÄƒ: PlÄƒtit, RestanÈ›Äƒ, Avans

**E) ACTIVITÄ‚ÈšI AGRICOLE** (~50 min) - CRITICAL pentru legislaÈ›ie!
- ID auto: AA001, AA002...
- RelaÈ›ii: ParcelÄƒ
- Calcule automate **TIMP PAUZÄ‚**:
  - Data recoltare permisÄƒ = Data aplicare + Zile pauzÄƒ
  - Status: "OK" sau "PauzÄƒ" (pentru harvest safety)
- Tipuri: Fungicid, Insecticid, Erbicid, Fertilizare

---

### **Prioritate 3: Dashboard cu KPIs**

**Metrici esenÈ›iale:**
- Venituri totale (VÃ¢nzÄƒri + VÃ¢nzÄƒri butaÈ™i)
- Cheltuieli totale (CAPEX + OPEX)
- Profit net = Venituri - Cheltuieli
- MarjÄƒ profit %
- Recoltare astÄƒzi/sÄƒptÄƒmÃ¢nÄƒ/lunÄƒ
- Grafice: ProducÈ›ie zilnicÄƒ, DistribuÈ›ie cheltuieli

---

### **Prioritate 4: UI Polish**

- [ ] Branded colors (#F16B6B, #312E3F) Ã®n TOATE componentele
- [ ] Navigare Ã®ntre module (Sidebar sau Top nav)
- [ ] Logo Zmeurel ğŸ“ Ã®n header
- [ ] AnimaÈ›ii, transitions
- [ ] Empty states cu ilustraÈ›ii
- [ ] Mobile optimization (testat pe telefon real)

---

### **Prioritate 5: Features avansate**

- [ ] PWA (offline mode, service workers)
- [ ] Upload facturi PDF (Supabase Storage)
- [ ] Export rapoarte (PDF, Excel)
- [ ] Multi-user (roles: admin, operator)
- [ ] Email notifications
- [ ] Backup automated

---

## ğŸ“Š PROGRES GENERAL MVP

### **Module CRUD:**
- âœ… Parcele (100%)
- âœ… CulegÄƒtori (100%)
- âœ… ClienÈ›i (100%)
- âœ… Cheltuieli Diverse (100%)
- â³ InvestiÈ›ii (0%)
- â³ VÃ¢nzÄƒri ButaÈ™i (0%)
- â³ RecoltÄƒri (0%)
- â³ VÃ¢nzÄƒri (0%)
- â³ ActivitÄƒÈ›i Agricole (0%)

**Completare:** 4/9 module = **~60% MVP** ğŸ¯

### **InfrastructurÄƒ:**
- âœ… Database (100%)
- âœ… Authentication (100%)
- âœ… RLS Policies (100%)
- âœ… Layout & Providers (100%)
- âœ… Supabase connection (100%)
- â³ Dashboard (0%)
- â³ Navigare (0%)
- â³ UI Branding (30%)

**Completare:** ~65% infrastructurÄƒ

### **TOTAL PROGRES:** ~60% MVP ğŸ”¥

---

## ğŸ“ NOTES FINALE

**Ce merge excelent:**
- Pattern CRUD repetat cu succes 4x consecutive
- Supabase queries rapide È™i fiabile
- React Query invalidation funcÈ›ioneazÄƒ perfect
- TypeScript catching errors early
- Auto-generated IDs logic solidÄƒ
- Toast notifications user-friendly

**Ce necesitÄƒ atenÈ›ie:**
- Tailwind v4 alpha instabil â†’ folosim inline styles cÃ¢nd e nevoie
- Radix UI components pot avea issues â†’ fallback la native HTML
- Import paths Ã®n folder structures â†’ verificÄƒ Ã®ntotdeauna
- SQL schema changes â†’ testeazÄƒ mai Ã®ntÃ¢i Ã®n SQL Editor

**LecÈ›ii cheie:**
- Debug sistematic (Console + Terminal + DevTools)
- TesteazÄƒ dupÄƒ FIECARE schimbare
- Git commit frecvent (dupÄƒ fiecare feature funcÈ›ional)
- DocumenteazÄƒ erorile È™i soluÈ›iile
- Pattern-ul CRUD e solid â†’ copy-paste cu Ã®ncredere!

**Velocitate dezvoltare:**
- Sesiune 1 (12 Feb): 1 modul (Parcele) - 4 ore debugging
- Sesiune 2 (13 Feb): 3 module (CulegÄƒtori, ClienÈ›i, Cheltuieli) - 3 ore totale
- **Accelerare:** 3x mai rapid dupÄƒ consolidarea pattern-ului! ğŸš€

---

## ğŸ† ACHIEVEMENTS TOTALE

âœ… 4 module CRUD complete È™i funcÈ›ionale  
âœ… Layout global cu QueryClient  
âœ… Delete confirmation generic  
âœ… Auto-generated IDs pentru toate modulele  
âœ… Multi-tenant architecture activÄƒ  
âœ… RLS policies protecting data  
âœ… Search functionality pe toate modulele  
âœ… Stats cards informative  
âœ… Toast notifications smooth  
âœ… Form validation robustÄƒ (Zod)  
âœ… Mobile-responsive UI  

**Progres general:** 0% â†’ 60% MVP Ã®n 2 sesiuni â¬†ï¸â¬†ï¸â¬†ï¸

---

## ğŸ¯ SUCCESS METRICS (DupÄƒ 4 module)

**Cod scris:**
- ~2,500 linii TypeScript/TSX
- ~25 fiÈ™iere create
- 0 erori critice rÄƒmase

**FuncÈ›ionalitate:**
- 4 module CRUD 100% operaÈ›ionale
- Database queries optimizate
- UI responsive È™i user-friendly

**ExperienÈ›Äƒ dezvoltare:**
- Pattern consolidat È™i repetat cu succes
- Debugging time redus de 4x
- Confidence crescutÄƒ Ã®n stack

---

**NEXT SESSION: InvestiÈ›ii (CAPEX) + eventual VÃ¢nzÄƒri ButaÈ™i** ğŸš€

**Keep the momentum going! 60% â†’ 80% MVP incoming!** ğŸ’ª

---

**Zmeurel OS - De la 0 la 60% Ã®n 2 zile!** ğŸ“ğŸ’»âœ¨
</file>

<file path="src/app/(dashboard)/activitati-agricole/ActivitatiAgricolePageClient.tsx">
// src/app/(dashboard)/activitati-agricole/ActivitatiAgricolePageClient.tsx
'use client'

import { useState, useMemo } from 'react'
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { toast } from 'sonner'
import { Search, Sprout, AlertCircle, CheckCircle } from 'lucide-react'

import { Card, CardContent } from '@/components/ui/card'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'

import {
  ActivitateAgricola,
  getActivitatiAgricole,
  deleteActivitateAgricola,
  calculatePauseStatus,
} from '@/lib/supabase/queries/activitati-agricole'

import { ActivitateAgricolaCard } from '@/components/activitati-agricole/ActivitateAgricolaCard'
import { AddActivitateAgricolaDialog } from '@/components/activitati-agricole/AddActivitateAgricolaDialog'
import { EditActivitateAgricolaDialog } from '@/components/activitati-agricole/EditActivitateAgricolaDialog'
import { DeleteConfirmDialog } from '@/components/parcele/DeleteConfirmDialog'

interface Parcela {
  id: string
  id_parcela: string
  nume_parcela: string
}

interface ActivitatiAgricolePageClientProps {
  initialActivitati: ActivitateAgricola[]
  parcele: Parcela[]
}

export function ActivitatiAgricolePageClient({
  initialActivitati,
  parcele,
}: ActivitatiAgricolePageClientProps) {
  const queryClient = useQueryClient()

  const [searchTerm, setSearchTerm] = useState('')
  const [selectedMonth, setSelectedMonth] = useState<string>('all')
  const [editingActivitate, setEditingActivitate] =
    useState<ActivitateAgricola | null>(null)
  const [deletingActivitate, setDeletingActivitate] =
    useState<ActivitateAgricola | null>(null)

  const { data: activitati = initialActivitati } = useQuery({
    queryKey: ['activitati-agricole'],
    queryFn: getActivitatiAgricole,
    initialData: initialActivitati,
  })

  const deleteMutation = useMutation({
    mutationFn: deleteActivitateAgricola,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['activitati-agricole'] })
      toast.success('Activitate stearsa cu succes!')
      setDeletingActivitate(null)
    },
    onError: (error) => {
      console.error('Error deleting activitate:', error)
      toast.error('Eroare la stergerea activitatii')
    },
  })

  const parcelaMap = useMemo(() => {
    const map: Record<string, string> = {}
    parcele.forEach((p) => {
      map[p.id] = `${p.id_parcela} - ${p.nume_parcela}`
    })
    return map
  }, [parcele])

  const availableMonths = useMemo(() => {
    const months = new Set<string>()
    activitati.forEach((a) => {
      const date = new Date(a.data_aplicare)
      const monthKey = `${date.getFullYear()}-${(date.getMonth() + 1)
        .toString()
        .padStart(2, '0')}`
      months.add(monthKey)
    })
    return Array.from(months).sort().reverse()
  }, [activitati])

  const formatMonth = (monthKey: string) => {
    const [year, month] = monthKey.split('-')
    const date = new Date(parseInt(year), parseInt(month) - 1)
    return date.toLocaleDateString('ro-RO', {
      year: 'numeric',
      month: 'long',
    })
  }

  const filteredActivitati = useMemo(() => {
    let filtered = activitati

    if (searchTerm) {
      const term = searchTerm.toLowerCase()
      filtered = filtered.filter(
        (a) =>
          a.id_activitate.toLowerCase().includes(term) ||
          a.tip_activitate?.toLowerCase().includes(term) ||
          a.produs_utilizat?.toLowerCase().includes(term) ||
          (a.parcela_id &&
            parcelaMap[a.parcela_id]?.toLowerCase().includes(term)) ||
          a.operator?.toLowerCase().includes(term) ||
          a.observatii?.toLowerCase().includes(term)
      )
    }

    if (selectedMonth !== 'all') {
      filtered = filtered.filter((a) => {
        const date = new Date(a.data_aplicare)
        const monthKey = `${date.getFullYear()}-${(date.getMonth() + 1)
          .toString()
          .padStart(2, '0')}`
        return monthKey === selectedMonth
      })
    }

    return filtered
  }, [activitati, searchTerm, selectedMonth, parcelaMap])

  const stats = useMemo(() => {
    const total = filteredActivitati.length
    let totalOK = 0
    let totalPauza = 0

    filteredActivitati.forEach((a) => {
      if (a.timp_pauza_zile > 0) {
        const { status } = calculatePauseStatus(
          a.data_aplicare,
          a.timp_pauza_zile
        )
        if (status === 'OK') totalOK++
        else totalPauza++
      }
    })

    return { total, totalOK, totalPauza }
  }, [filteredActivitati])

  const handleEdit = (activitate: ActivitateAgricola) => {
    setEditingActivitate(activitate)
  }

  const handleDelete = (activitate: ActivitateAgricola) => {
    setDeletingActivitate(activitate)
  }

  const confirmDelete = () => {
    if (deletingActivitate) {
      deleteMutation.mutate(deletingActivitate.id)
    }
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-gray-900">
            Activitati Agricole
          </h1>
          <p className="text-gray-600 mt-1">
            Gestioneaza tratamente, fertilizari si alte activitati
          </p>
        </div>
        <AddActivitateAgricolaDialog />
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">Total Activitati</p>
                <p className="text-3xl font-bold text-gray-900 mt-1">
                  {stats.total}
                </p>
              </div>
              <div className="h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center">
                <Sprout className="h-6 w-6 text-purple-600" />
              </div>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">
                  Recoltare Permisa (OK)
                </p>
                <p className="text-3xl font-bold text-green-600 mt-1">
                  {stats.totalOK}
                </p>
              </div>
              <div className="h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center">
                <CheckCircle className="h-6 w-6 text-green-600" />
              </div>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600">
                  In Pauza (ATENTIE)
                </p>
                <p className="text-3xl font-bold text-yellow-600 mt-1">
                  {stats.totalPauza}
                </p>
              </div>
              <div className="h-12 w-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                <AlertCircle className="h-6 w-6 text-yellow-600" />
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {filteredActivitati.length === 0 ? (
        <Card>
          <CardContent className="p-12 text-center">
            <Sprout className="h-12 w-12 text-gray-400 mx-auto mb-4" />
            <h3 className="text-lg font-semibold text-gray-900 mb-2">
              Nicio activitate gasita
            </h3>
            <p className="text-gray-600">
              Adauga prima activitate agricola pentru a incepe tracking-ul
            </p>
          </CardContent>
        </Card>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {filteredActivitati.map((activitate) => (
            <ActivitateAgricolaCard
              key={activitate.id}
              activitate={activitate}
              parcelaNume={
                activitate.parcela_id
                  ? parcelaMap[activitate.parcela_id]
                  : undefined
              }
              onEdit={handleEdit}
              onDelete={handleDelete}
            />
          ))}
        </div>
      )}

      <EditActivitateAgricolaDialog
        activitate={editingActivitate}
        open={!!editingActivitate}
        onOpenChange={(open) => !open && setEditingActivitate(null)}
      />

      <DeleteConfirmDialog
        open={!!deletingActivitate}
        onOpenChange={(open) => !open && setDeletingActivitate(null)}
        onConfirm={confirmDelete}
        itemName={deletingActivitate?.id_activitate || ''}
        itemType="activitate agricola"
      />
    </div>
  )
}
</file>

<file path="src/app/(dashboard)/clienti/ClientPageClient.tsx">
'use client';

import { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { toast } from 'sonner';
import { UserCheck, Plus } from 'lucide-react';
import {
  getClienti,
  createClienti,
  deleteClienti,
  type Client,
} from '@/lib/supabase/queries/clienti';
import { AddClientDialog } from '@/components/clienti/AddClientDialog';
import { Button } from '@/components/ui/button';
import { Card, CardContent } from '@/components/ui/card';

interface ClientPageClientProps {
  initialClienti: Client[];
}

export function ClientPageClient({ initialClienti }: ClientPageClientProps) {
  const queryClient = useQueryClient();
  const [dialogOpen, setDialogOpen] = useState(false);

  const { data: clienti = initialClienti } = useQuery({
    queryKey: ['clienti'],
    queryFn: getClienti,
    initialData: initialClienti,
  });

  const createMutation = useMutation({
    mutationFn: createClienti,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['clienti'] });
      toast.success('Client adÄƒugat cu succes!');
      setDialogOpen(false);
    },
    onError: (error: Error) => {
      toast.error(`Eroare: ${error.message}`);
    },
  });

  const deleteMutation = useMutation({
    mutationFn: deleteClienti,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['clienti'] });
      toast.success('Client È™ters!');
    },
  });

  return (
    <div className="min-h-screen bg-gray-50 p-6">
      <div className="max-w-7xl mx-auto">
        <div className="flex justify-between items-center mb-6">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">ClienÈ›i</h1>
            <p className="text-gray-600 mt-1">{clienti.length} clienÈ›i</p>
          </div>
          <Button
            onClick={() => setDialogOpen(true)}
            className="bg-[#F16B6B] hover:bg-[#ef4444]"
          >
            <Plus className="h-4 w-4 mr-2" />
            AdaugÄƒ Client
          </Button>
        </div>

        {clienti.length === 0 ? (
          <Card>
            <CardContent className="p-12 text-center">
              <UserCheck className="h-12 w-12 text-gray-400 mx-auto mb-4" />
              <h3 className="text-lg font-semibold text-gray-900 mb-2">
                Niciun client adÄƒugat Ã®ncÄƒ
              </h3>
              <p className="text-gray-600">
                Ãncepe prin a adÄƒuga primul client folosind butonul de mai sus
              </p>
            </CardContent>
          </Card>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {clienti.map((client) => (
              <Card key={client.id}>
                <CardContent className="p-4">
                  <div className="flex justify-between items-start">
                    <div>
                      <h3 className="font-semibold text-gray-900">
                        {client.nume_client}
                      </h3>
                      {client.telefon && (
                        <p className="text-sm text-gray-600">
                          ğŸ“ {client.telefon}
                        </p>
                      )}
                      {client.email && (
                        <p className="text-sm text-gray-600">
                          âœ‰ï¸ {client.email}
                        </p>
                      )}
                      {client.pret_negociat_lei_kg && (
                        <p className="text-sm text-gray-600">
                          ğŸ’° {client.pret_negociat_lei_kg} lei/kg
                        </p>
                      )}
                    </div>
                    <button
                      onClick={() => deleteMutation.mutate(client.id)}
                      className="text-red-400 hover:text-red-600 text-sm"
                    >
                      È˜terge
                    </button>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        )}

        <AddClientDialog
          open={dialogOpen}
          onOpenChange={setDialogOpen}
          onSubmit={async (data) => {
            await createMutation.mutateAsync({
              nume_client: data.nume_client,
              telefon: data.telefon,
              email: data.email,
              adresa: data.adresa,
            });
          }}
        />
      </div>
    </div>
  );
}
</file>

<file path="src/components/investitii/AddInvestitieDialog.tsx">
// src/components/investitii/AddInvestitieDialog.tsx
'use client'

import { useState } from 'react'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import * as z from 'zod'
import { useMutation, useQueryClient, useQuery } from '@tanstack/react-query'
import { toast } from 'sonner'
import { Plus } from 'lucide-react'

import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Textarea } from '@/components/ui/textarea'

import {
  createInvestitie,
  CATEGORII_INVESTITII,
} from '@/lib/supabase/queries/investitii'

import { getParcele } from '@/lib/supabase/queries/parcele'

// ===============================
// VALIDATION
// ===============================

const investitieSchema = z.object({
  data: z.string().min(1, 'Data este obligatorie'),
  parcela_id: z.string().optional(),
  categorie: z.string().min(1, 'Categoria este obligatorie'),
  furnizor: z.string().optional(),
  descriere: z.string().optional(),
  suma_lei: z.string().min(1, 'Suma este obligatorie'),
})

type InvestitieFormData = z.infer<typeof investitieSchema>

// ===============================
// COMPONENT
// ===============================

export function AddInvestitieDialog() {
  const [open, setOpen] = useState(false)
  const queryClient = useQueryClient()

  // RLS-first
  const { data: parcele = [] } = useQuery({
    queryKey: ['parcele'],
    queryFn: getParcele,
  })

  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<InvestitieFormData>({
    resolver: zodResolver(investitieSchema),
    defaultValues: {
      data: new Date().toISOString().split('T')[0],
      parcela_id: '',
      categorie: '',
      furnizor: '',
      descriere: '',
      suma_lei: '',
    },
  })

  const createMutation = useMutation({
    mutationFn: createInvestitie,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['investitii'] })
      toast.success('InvestiÈ›ie adÄƒugatÄƒ cu succes!')
      reset()
      setOpen(false)
    },
    onError: (error) => {
      console.error('Error creating investitie:', error)
      toast.error('Eroare la adÄƒugarea investiÈ›iei')
    },
  })

  const onSubmit = (data: InvestitieFormData) => {
    createMutation.mutate({
      data: data.data,
      parcela_id: data.parcela_id || undefined,
      categorie: data.categorie,
      furnizor: data.furnizor || undefined,
      descriere: data.descriere || undefined,
      suma_lei: Number(data.suma_lei),
    })
  }

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button className="bg-[#F16B6B] hover:bg-[#E05A5A]">
          <Plus className="h-4 w-4 mr-2" />
          AdaugÄƒ InvestiÈ›ie
        </Button>
      </DialogTrigger>

      <DialogContent
        className="max-w-md max-h-[75vh] overflow-y-auto"
        style={{ backgroundColor: 'white' }}
      >
        <DialogHeader>
          <DialogTitle>AdaugÄƒ InvestiÈ›ie NouÄƒ (CAPEX)</DialogTitle>
        </DialogHeader>

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-3">
          <div className="space-y-1">
            <Label htmlFor="data" className="text-sm">
              Data investiÈ›iei <span className="text-red-500">*</span>
            </Label>
            <Input
              id="data"
              type="date"
              {...register('data')}
              className={errors.data ? 'border-red-500' : ''}
            />
          </div>

          <div className="space-y-1">
            <Label htmlFor="categorie" className="text-sm">
              Categorie investiÈ›ie <span className="text-red-500">*</span>
            </Label>
            <select
              id="categorie"
              {...register('categorie')}
              className={`flex h-10 w-full rounded-md border px-3 py-2 text-sm ${
                errors.categorie
                  ? 'border-red-500'
                  : 'border-gray-300'
              }`}
              style={{ backgroundColor: 'white' }}
            >
              <option value="">SelecteazÄƒ categoria...</option>
              {CATEGORII_INVESTITII.map((cat) => (
                <option key={cat} value={cat}>
                  {cat}
                </option>
              ))}
            </select>
          </div>

          <div className="space-y-1">
            <Label htmlFor="parcela_id" className="text-sm">
              ParcelÄƒ
            </Label>
            <select
              id="parcela_id"
              {...register('parcela_id')}
              className="flex h-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm"
              style={{ backgroundColor: 'white' }}
            >
              <option value="">FÄƒrÄƒ legÄƒturÄƒ cu parcelÄƒ</option>
              {parcele.map((parcela: any) => (
                <option key={parcela.id} value={parcela.id}>
                  {parcela.id_parcela} - {parcela.nume_parcela}
                </option>
              ))}
            </select>
          </div>

          <div className="space-y-1">
            <Label htmlFor="suma_lei" className="text-sm">
              SumÄƒ investitÄƒ (lei) <span className="text-red-500">*</span>
            </Label>
            <Input
              id="suma_lei"
              type="number"
              step="0.01"
              {...register('suma_lei')}
              className={errors.suma_lei ? 'border-red-500' : ''}
            />
          </div>

          <div className="space-y-1">
            <Label htmlFor="furnizor" className="text-sm">
              Furnizor
            </Label>
            <Input id="furnizor" type="text" {...register('furnizor')} />
          </div>

          <div className="space-y-1">
            <Label htmlFor="descriere" className="text-sm">
              Descriere
            </Label>
            <Textarea id="descriere" rows={2} {...register('descriere')} />
          </div>

          <div className="flex justify-end gap-3 pt-2">
            <Button
              type="button"
              variant="outline"
              onClick={() => {
                reset()
                setOpen(false)
              }}
            >
              AnuleazÄƒ
            </Button>
            <Button
              type="submit"
              disabled={createMutation.isPending}
              className="bg-[#F16B6B] hover:bg-[#E05A5A]"
            >
              {createMutation.isPending
                ? 'Se salveazÄƒ...'
                : 'SalveazÄƒ'}
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  )
}
</file>

<file path="src/components/investitii/EditInvestitieDialog.tsx">
// src/components/investitii/EditInvestitieDialog.tsx
'use client'

import { useEffect } from 'react'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import * as z from 'zod'
import { useMutation, useQueryClient, useQuery } from '@tanstack/react-query'
import { toast } from 'sonner'

import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Textarea } from '@/components/ui/textarea'

import {
  Investitie,
  updateInvestitie,
  CATEGORII_INVESTITII,
} from '@/lib/supabase/queries/investitii'

import { getParcele } from '@/lib/supabase/queries/parcele'

// ===============================
// VALIDATION
// ===============================

const investitieSchema = z.object({
  data: z.string().min(1, 'Data este obligatorie'),
  parcela_id: z.string().optional(),
  categorie: z.string().min(1, 'Categoria este obligatorie'),
  furnizor: z.string().optional(),
  descriere: z.string().optional(),
  suma_lei: z.string().min(1, 'Suma este obligatorie'),
})

type InvestitieFormData = z.infer<typeof investitieSchema>

interface EditInvestitieDialogProps {
  investitie: Investitie | null
  open: boolean
  onOpenChange: (open: boolean) => void
}

// ===============================
// COMPONENT
// ===============================

export function EditInvestitieDialog({
  investitie,
  open,
  onOpenChange,
}: EditInvestitieDialogProps) {
  const queryClient = useQueryClient()

  const { data: parcele = [] } = useQuery({
    queryKey: ['parcele'],
    queryFn: getParcele,
  })

  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<InvestitieFormData>({
    resolver: zodResolver(investitieSchema),
  })

  useEffect(() => {
    if (investitie && open) {
      reset({
        data: investitie.data.split('T')[0],
        parcela_id: investitie.parcela_id ?? '',
        categorie: investitie.categorie ?? '',
        furnizor: investitie.furnizor ?? '',
        descriere: investitie.descriere ?? '',
        suma_lei: investitie.suma_lei.toString(),
      })
    }
  }, [investitie, open, reset])

  const updateMutation = useMutation({
    mutationFn: ({
      id,
      data,
    }: {
      id: string
      data: {
        data: string
        parcela_id?: string
        categorie: string
        furnizor?: string
        descriere?: string
        suma_lei: number
      }
    }) => updateInvestitie(id, data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['investitii'] })
      toast.success('InvestiÈ›ie actualizatÄƒ cu succes!')
      onOpenChange(false)
    },
    onError: (error) => {
      console.error('Error updating investitie:', error)
      toast.error('Eroare la actualizarea investiÈ›iei')
    },
  })

  const onSubmit = (data: InvestitieFormData) => {
    if (!investitie) return

    updateMutation.mutate({
      id: investitie.id,
      data: {
        data: data.data,
        parcela_id: data.parcela_id || undefined,
        categorie: data.categorie,
        furnizor: data.furnizor || undefined,
        descriere: data.descriere || undefined,
        suma_lei: Number(data.suma_lei),
      },
    })
  }

  if (!investitie) return null

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-md bg-white">
        <DialogHeader>
          <DialogTitle>
            EditeazÄƒ InvestiÈ›ie: {investitie.id_investitie}
          </DialogTitle>
        </DialogHeader>

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-3">
          <div>
            <Label>Data</Label>
            <Input type="date" {...register('data')} />
          </div>

          <div>
            <Label>Categorie</Label>
            <select
              {...register('categorie')}
              className="flex h-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm bg-white"
            >
              <option value="">SelecteazÄƒ categoria...</option>
              {CATEGORII_INVESTITII.map((cat) => (
                <option key={cat} value={cat}>
                  {cat}
                </option>
              ))}
            </select>
          </div>

          <div>
            <Label>ParcelÄƒ</Label>
            <select
              {...register('parcela_id')}
              className="flex h-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm bg-white"
            >
              <option value="">FÄƒrÄƒ legÄƒturÄƒ cu parcelÄƒ</option>
              {parcele.map((parcela: any) => (
                <option key={parcela.id} value={parcela.id}>
                  {parcela.id_parcela} - {parcela.nume_parcela}
                </option>
              ))}
            </select>
          </div>

          <div>
            <Label>SumÄƒ (lei)</Label>
            <Input type="number" step="0.01" {...register('suma_lei')} />
          </div>

          <div>
            <Label>Furnizor</Label>
            <Input type="text" {...register('furnizor')} />
          </div>

          <div>
            <Label>Descriere</Label>
            <Textarea rows={2} {...register('descriere')} />
          </div>

          <div className="flex justify-end gap-3 pt-3">
            <Button
              type="button"
              variant="outline"
              onClick={() => onOpenChange(false)}
            >
              AnuleazÄƒ
            </Button>
            <Button
              type="submit"
              disabled={updateMutation.isPending}
              className="bg-[#F16B6B] hover:bg-[#E05A5A]"
            >
              {updateMutation.isPending
                ? 'Se salveazÄƒ...'
                : 'SalveazÄƒ'}
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  )
}
</file>

<file path="src/components/layout/Sidebar.tsx">
'use client';

import { useState } from 'react';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
import {
  MapPin,
  Users,
  UserCheck,
  PackageOpen,
  ShoppingCart,
  TrendingUp,
  Sprout,
  Receipt,
  LayoutDashboard,
  Menu,
  X,
  LogOut,
  Leaf,
  ShoppingBag,
} from 'lucide-react';

const navGroups = [
  {
    label: 'OPERAÈšIUNI',
    items: [
      { href: '/dashboard', label: 'Dashboard', icon: LayoutDashboard },
      { href: '/parcele', label: 'Parcele', icon: MapPin },
      { href: '/recoltari', label: 'RecoltÄƒri', icon: PackageOpen },
      { href: '/activitati-agricole', label: 'ActivitÄƒÈ›i Agricole', icon: Sprout },
    ],
  },
  {
    label: 'RELAÈšII',
    items: [
      { href: '/culegatori', label: 'CulegÄƒtori', icon: Users },
      { href: '/clienti', label: 'ClienÈ›i', icon: UserCheck },
    ],
  },
  {
    label: 'FINANCIAR',
    items: [
      { href: '/vanzari', label: 'VÃ¢nzÄƒri Fructe', icon: ShoppingCart },
      { href: '/vanzari-butasi', label: 'VÃ¢nzÄƒri ButaÈ™i', icon: ShoppingBag },
      { href: '/investitii', label: 'InvestiÈ›ii', icon: TrendingUp },
      { href: '/cheltuieli', label: 'Cheltuieli', icon: Receipt },
    ],
  },
];

type SidebarContentProps = {
  isActive: (href: string) => boolean;
  onNavigate: () => void;
};

function SidebarContent({ isActive, onNavigate }: SidebarContentProps) {
  return (
    <div className="flex flex-col h-full">
      {/* Logo */}
      <div className="px-6 py-7 border-b border-white/10">
        <div className="flex items-center gap-3">
          <div className="w-9 h-9 rounded-xl bg-[#F16B6B] flex items-center justify-center shadow-lg shadow-[#F16B6B]/30">
            <Leaf className="w-5 h-5 text-white" />
          </div>
          <div>
            <span
              className="text-xl font-bold text-white tracking-wide"
              style={{ fontFamily: "'Georgia', serif", letterSpacing: '0.03em' }}
            >
              Zmeurel
            </span>
            <span className="text-xs text-slate-400 block -mt-0.5 font-medium tracking-widest uppercase">
              OS
            </span>
          </div>
        </div>
      </div>

      {/* Navigation */}
      <nav className="flex-1 px-3 py-5 overflow-y-auto space-y-6">
        {navGroups.map((group) => (
          <div key={group.label}>
            <p className="text-[10px] font-semibold text-slate-500 tracking-widest px-3 mb-2">
              {group.label}
            </p>
            <ul className="space-y-0.5">
              {group.items.map(({ href, label, icon: Icon }) => {
                const active = isActive(href);
                return (
                  <li key={href}>
                    <Link
                      href={href}
                      onClick={onNavigate}
                      className={`flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium transition-all duration-200 group
                        ${
                          active
                            ? 'bg-[#F16B6B]/15 text-[#F16B6B]'
                            : 'text-slate-400 hover:text-white hover:bg-white/5'
                        }`}
                    >
                      <div
                        className={`w-8 h-8 rounded-lg flex items-center justify-center transition-all duration-200
                        ${
                          active ? 'bg-[#F16B6B]/20' : 'bg-transparent group-hover:bg-white/5'
                        }`}
                      >
                        <Icon className={`w-4 h-4 ${active ? 'text-[#F16B6B]' : ''}`} />
                      </div>
                      {label}
                      {active && <div className="ml-auto w-1.5 h-1.5 rounded-full bg-[#F16B6B]" />}
                    </Link>
                  </li>
                );
              })}
            </ul>
          </div>
        ))}
      </nav>

      {/* Footer */}
      <div className="px-3 py-4 border-t border-white/10">
        <button className="flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium text-slate-400 hover:text-white hover:bg-white/5 transition-all w-full">
          <div className="w-8 h-8 rounded-lg flex items-center justify-center">
            <LogOut className="w-4 h-4" />
          </div>
          Deconectare
        </button>
      </div>
    </div>
  );
}

export function Sidebar() {
  const pathname = usePathname();
  const [mobileOpen, setMobileOpen] = useState(false);

  const isActive = (href: string) => {
    if (href === '/dashboard') return pathname === '/dashboard';
    return pathname.startsWith(href);
  };

  return (
    <>
      {/* Mobile hamburger */}
      <button
        onClick={() => setMobileOpen(true)}
        className="lg:hidden fixed top-4 left-4 z-50 w-10 h-10 rounded-xl bg-[#312E3F] text-white flex items-center justify-center shadow-lg"
      >
        <Menu className="w-5 h-5" />
      </button>

      {/* Mobile overlay */}
      {mobileOpen && (
        <div
          className="lg:hidden fixed inset-0 z-40 bg-black/60 backdrop-blur-sm"
          onClick={() => setMobileOpen(false)}
        />
      )}

      {/* Mobile drawer */}
      <aside
        className={`lg:hidden fixed top-0 left-0 z-50 h-full w-72 bg-[#312E3F] transition-transform duration-300 ease-in-out
          ${mobileOpen ? 'translate-x-0' : '-translate-x-full'}`}
      >
        <button
          onClick={() => setMobileOpen(false)}
          className="absolute top-4 right-4 w-8 h-8 rounded-lg bg-white/10 text-white flex items-center justify-center"
        >
          <X className="w-4 h-4" />
        </button>

        <SidebarContent
          isActive={isActive}
          onNavigate={() => setMobileOpen(false)}
        />
      </aside>

      {/* Desktop sidebar */}
      <aside className="hidden lg:flex flex-col w-64 h-screen bg-[#312E3F] fixed top-0 left-0 z-30">
        <SidebarContent
          isActive={isActive}
          onNavigate={() => setMobileOpen(false)}
        />
      </aside>
    </>
  );
}
</file>

<file path="src/components/parcele/AddParcelaDialog.tsx">
'use client';

import { useState } from 'react';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { toast } from 'sonner';
import { Plus, Loader2 } from 'lucide-react';
import { createClient } from '@/lib/supabase/client';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Button } from '@/components/ui/button';
import { Label } from '@/components/ui/label';

const parcelaSchema = z.object({
  nume_parcela: z.string().min(1, 'Numele parcelei este obligatoriu'),
  suprafata_m2: z.string().min(1, 'Suprafata este obligatorie'),
  soi_plantat: z.string().optional(),
  an_plantare: z.string().min(1, 'Anul plantarii este obligatoriu'),
  nr_plante: z.string().optional(),
  observatii: z.string().optional(),
});

type ParcelaFormData = z.infer<typeof parcelaSchema>;

interface AddParcelaDialogProps {
  soiuriDisponibile: string[];
  onSuccess: () => void;
}

export function AddParcelaDialog({
  soiuriDisponibile,
  onSuccess,
}: AddParcelaDialogProps) {
  const [open, setOpen] = useState(false);
  const queryClient = useQueryClient();

  const form = useForm<ParcelaFormData>({
    resolver: zodResolver(parcelaSchema),
    defaultValues: {
      nume_parcela: '',
      suprafata_m2: '',
      soi_plantat: '',
      an_plantare: String(new Date().getFullYear()),
      nr_plante: '',
      observatii: '',
    },
  });

  const createMutation = useMutation({
    mutationFn: async (data: ParcelaFormData) => {
      const supabase = createClient();

      const nextId = `P${Date.now()}`;

      const { data: result, error: insertError } = await supabase
        .from('parcele')
        .insert({
          id_parcela: nextId,
          nume_parcela: data.nume_parcela,
          suprafata_m2: Number(data.suprafata_m2),
          soi_plantat: data.soi_plantat || null,
          an_plantare: Number(data.an_plantare),
          nr_plante: data.nr_plante ? Number(data.nr_plante) : null,
          status: 'Activ',
          gps_lat: null,
          gps_lng: null,
          observatii: data.observatii || null,
        })
        .select()
        .single();

      if (insertError) throw insertError;
      return result;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['parcele'] });
      toast.success('Parcela a fost adaugata cu succes!');
      form.reset();
      setOpen(false);
      onSuccess();
    },
    onError: (error: Error) => {
      toast.error(`Eroare: ${error.message}`);
    },
  });

  const onSubmit = (data: ParcelaFormData) => {
    createMutation.mutate(data);
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button size="lg" className="bg-[#F16B6B] hover:bg-[#ef4444] min-h-12">
          <Plus className="h-5 w-5 mr-2" />
          Adauga Parcela
        </Button>
      </DialogTrigger>

      <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle>Adauga Parcela Noua</DialogTitle>
          <DialogDescription>
            Completeaza detaliile parcelei. ID-ul se va genera automat.
          </DialogDescription>
        </DialogHeader>

        <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="nume_parcela">Nume Parcela *</Label>
            <Input id="nume_parcela" {...form.register('nume_parcela')} />
          </div>

          <div className="space-y-2">
            <Label htmlFor="suprafata_m2">Suprafata (m2) *</Label>
            <Input id="suprafata_m2" type="number" {...form.register('suprafata_m2')} />
          </div>

          <div className="space-y-2">
            <Label htmlFor="soi_plantat">Soi Plantat</Label>
            <select id="soi_plantat" {...form.register('soi_plantat')}>
              <option value="">Selecteaza soi...</option>
              {soiuriDisponibile.map((soi, index) => (
                <option key={`${soi}-${index}`} value={soi}>
                  {soi}
                </option>
              ))}
            </select>
          </div>

          <div className="space-y-2">
            <Label htmlFor="an_plantare">An Plantare *</Label>
            <Input id="an_plantare" type="number" {...form.register('an_plantare')} />
          </div>

          <div className="space-y-2">
            <Label htmlFor="nr_plante">Numar Plante</Label>
            <Input id="nr_plante" type="number" {...form.register('nr_plante')} />
          </div>

          <div className="space-y-2">
            <Label htmlFor="observatii">Observatii</Label>
            <Textarea id="observatii" {...form.register('observatii')} />
          </div>

          <DialogFooter>
            <Button type="button" variant="outline" onClick={() => setOpen(false)}>
              Anuleaza
            </Button>
            <Button type="submit" disabled={createMutation.isPending}>
              {createMutation.isPending ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  Se salveaza...
                </>
              ) : (
                'Salveaza Parcela'
              )}
            </Button>
          </DialogFooter>
        </form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/recoltari/AddRecoltareDialog.tsx">
'use client'

import { useState, useMemo } from 'react'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import * as z from 'zod'
import { useMutation, useQueryClient, useQuery } from '@tanstack/react-query'
import { toast } from 'sonner'
import { Plus } from 'lucide-react'

import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'

import { createRecoltare } from '@/lib/supabase/queries/recoltari'
import { getParcele } from '@/lib/supabase/queries/parcele'
import { getCulegatori } from '@/lib/supabase/queries/culegatori'

const schema = z.object({
  data: z.string().min(1),
  parcela_id: z.string().min(1),
  culegator_id: z.string().min(1),
  nr_caserole: z.string().min(1),
  tara_per_caserola: z.string().min(1),
})

type FormData = z.infer<typeof schema>

export function AddRecoltareDialog() {
  const [open, setOpen] = useState(false)
  const queryClient = useQueryClient()

  const { data: parcele = [] } = useQuery({
    queryKey: ['parcele'],
    queryFn: getParcele,
  })

  const { data: culegatori = [] } = useQuery({
    queryKey: ['culegatori'],
    queryFn: getCulegatori,
  })

  const {
    register,
    handleSubmit,
    watch,
    reset,
  } = useForm<FormData>({
    resolver: zodResolver(schema),
    defaultValues: {
      data: new Date().toISOString().split('T')[0],
    },
  })

  const nr = Number(watch('nr_caserole') || 0)
  const taraPer = Number(watch('tara_per_caserola') || 0)
  const culegatorId = watch('culegator_id')

  const culegator = culegatori.find((c: any) => c.id === culegatorId)
  const tarif = culegator?.tarif_lei_kg || 0

  const brut = nr * 0.5
  const taraTotala = nr * taraPer
  const net = brut - taraTotala
  const valoare = net * tarif

  const mutation = useMutation({
    mutationFn: createRecoltare,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['recoltari'] })
      toast.success('Recoltare adÄƒugatÄƒ!')
      reset()
      setOpen(false)
    },
  })

  const onSubmit = (data: FormData) => {
    mutation.mutate({
      data: data.data,
      parcela_id: data.parcela_id,
      culegator_id: data.culegator_id,
      nr_caserole: Number(data.nr_caserole),
      tara_kg: taraTotala,
    })
  }

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button>
          <Plus className="h-4 w-4 mr-2" />
          AdaugÄƒ Recoltare
        </Button>
      </DialogTrigger>

      <DialogContent className="bg-white max-w-md">
        <DialogHeader>
          <DialogTitle>Recoltare NouÄƒ</DialogTitle>
        </DialogHeader>

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-3">

          <Label>CulegÄƒtor</Label>
          <select {...register('culegator_id')} className="w-full border p-2">
            <option value="">SelecteazÄƒ...</option>
            {culegatori.map((c: any) => (
              <option key={c.id} value={c.id}>
                {c.nume_prenume} ({c.tarif_lei_kg} lei/kg)
              </option>
            ))}
          </select>

          <Label>ParcelÄƒ</Label>
          <select {...register('parcela_id')} className="w-full border p-2">
            <option value="">SelecteazÄƒ...</option>
            {parcele.map((p: any) => (
              <option key={p.id} value={p.id}>
                {p.id_parcela} - {p.nume_parcela}
              </option>
            ))}
          </select>

          <Label>Nr. caserole</Label>
          <Input type="number" {...register('nr_caserole')} />

          <Label>Tara per caserolÄƒ (kg)</Label>
          <Input type="number" step="0.001" {...register('tara_per_caserola')} />

          <div className="bg-gray-100 p-3 rounded text-sm">
            Brut: {brut.toFixed(2)} kg<br/>
            Tara totalÄƒ: {taraTotala.toFixed(2)} kg<br/>
            Net: {net.toFixed(2)} kg<br/>
            Valoare muncÄƒ: {valoare.toFixed(2)} lei
          </div>

          <Button type="submit" disabled={mutation.isPending}>
            SalveazÄƒ
          </Button>

        </form>
      </DialogContent>
    </Dialog>
  )
}
</file>

<file path="src/components/vanzari-butasi/AddVanzareButasiDialog.tsx">
// src/components/vanzari-butasi/AddVanzareButasiDialog.tsx
'use client';

import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import { useMutation, useQueryClient, useQuery } from '@tanstack/react-query';
import { toast } from 'sonner';
import { Plus } from 'lucide-react';

import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';

import { createVanzareButasi } from '@/lib/supabase/queries/vanzari-butasi';
import { getClienti } from '@/lib/supabase/queries/clienti';
import { getParcele } from '@/lib/supabase/queries/parcele';

// ===============================
// VALIDATION
// ===============================

const vanzareButasiSchema = z.object({
  data: z.string().min(1, 'Data este obligatorie'),
  client_id: z.string().optional(),
  parcela_sursa_id: z.string().optional(),
  soi_butasi: z.string().min(1, 'Soiul este obligatoriu'),
  cantitate_butasi: z.string().min(1, 'Cantitatea este obligatorie'),
  pret_unitar_lei: z.string().min(1, 'PreÈ›ul este obligatoriu'),
  observatii: z.string().optional(),
});

type VanzareButasiFormData = z.infer<typeof vanzareButasiSchema>;

// ===============================
// COMPONENT (RLS-FIRST)
// ===============================

export function AddVanzareButasiDialog() {
  const [open, setOpen] = useState(false);
  const queryClient = useQueryClient();

  // RLS-first queries
  const { data: clienti = [] } = useQuery({
    queryKey: ['clienti'],
    queryFn: getClienti,
  });

  const { data: parcele = [] } = useQuery({
    queryKey: ['parcele'],
    queryFn: getParcele,
  });

  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<VanzareButasiFormData>({
    resolver: zodResolver(vanzareButasiSchema),
    defaultValues: {
      data: new Date().toISOString().split('T')[0],
      client_id: '',
      parcela_sursa_id: '',
      soi_butasi: '',
      cantitate_butasi: '',
      pret_unitar_lei: '',
      observatii: '',
    },
  });

  const createMutation = useMutation({
    mutationFn: createVanzareButasi,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['vanzari-butasi'] });
      toast.success('VÃ¢nzare butaÈ™i adÄƒugatÄƒ cu succes!');
      reset();
      setOpen(false);
    },
    onError: (error) => {
      console.error('Error creating vanzare butasi:', error);
      toast.error('Eroare la adÄƒugarea vÃ¢nzÄƒrii');
    },
  });

  const onSubmit = (data: VanzareButasiFormData) => {
    createMutation.mutate({
      data: data.data,
      client_id: data.client_id || undefined,
      parcela_sursa_id: data.parcela_sursa_id || undefined,
      soi_butasi: data.soi_butasi,
      cantitate_butasi: Number(data.cantitate_butasi),
      pret_unitar_lei: Number(data.pret_unitar_lei),
      observatii: data.observatii || undefined,
    });
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button className="bg-[#F16B6B] hover:bg-[#E05A5A]">
          <Plus className="h-4 w-4 mr-2" />
          AdaugÄƒ VÃ¢nzare ButaÈ™i
        </Button>
      </DialogTrigger>

      <DialogContent className="max-w-md max-h-[75vh] overflow-y-auto bg-white">
        <DialogHeader>
          <DialogTitle>AdaugÄƒ VÃ¢nzare ButaÈ™i NouÄƒ</DialogTitle>
        </DialogHeader>

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-3">

          <div>
            <Label>Data</Label>
            <Input type="date" {...register('data')} />
          </div>

          <div>
            <Label>Soi butaÈ™i</Label>
            <Input {...register('soi_butasi')} />
          </div>

          <div className="grid grid-cols-2 gap-3">
            <div>
              <Label>Cantitate</Label>
              <Input type="number" {...register('cantitate_butasi')} />
            </div>
            <div>
              <Label>PreÈ›/buc (lei)</Label>
              <Input type="number" step="0.01" {...register('pret_unitar_lei')} />
            </div>
          </div>

          <div>
            <Label>Client</Label>
            <select {...register('client_id')} className="flex h-10 w-full rounded-md border px-3 py-2 text-sm bg-white">
              <option value="">FÄƒrÄƒ client</option>
              {clienti.map((client: any) => (
                <option key={client.id} value={client.id}>
                  {client.id_client} - {client.nume_client}
                </option>
              ))}
            </select>
          </div>

          <div>
            <Label>ParcelÄƒ sursÄƒ</Label>
            <select {...register('parcela_sursa_id')} className="flex h-10 w-full rounded-md border px-3 py-2 text-sm bg-white">
              <option value="">FÄƒrÄƒ parcelÄƒ</option>
              {parcele.map((parcela: any) => (
                <option key={parcela.id} value={parcela.id}>
                  {parcela.id_parcela} - {parcela.nume_parcela}
                </option>
              ))}
            </select>
          </div>

          <div>
            <Label>ObservaÈ›ii</Label>
            <Textarea rows={2} {...register('observatii')} />
          </div>

          <div className="flex justify-end gap-3 pt-3">
            <Button type="button" variant="outline" onClick={() => setOpen(false)}>
              AnuleazÄƒ
            </Button>
            <Button type="submit" disabled={createMutation.isPending}>
              {createMutation.isPending ? 'Se salveazÄƒ...' : 'SalveazÄƒ'}
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/vanzari-butasi/EditVanzareButasiDialog.tsx">
'use client';

import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { VanzareButasi } from '@/lib/supabase/queries/vanzari-butasi';

interface EditVanzareButasiDialogProps {
  vanzare: VanzareButasi | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

export function EditVanzareButasiDialog({
  vanzare,
  open,
  onOpenChange,
}: EditVanzareButasiDialogProps) {
  if (!vanzare) return null;

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>
            Editare VÃ¢nzare {vanzare.id_vanzare_butasi}
          </DialogTitle>
        </DialogHeader>

        <div className="space-y-2">
          <p><strong>Soi:</strong> {vanzare.soi_butasi}</p>
          <p><strong>Cantitate:</strong> {vanzare.cantitate_butasi}</p>
          <p><strong>PreÈ› unitar:</strong> {vanzare.pret_unitar_lei} lei</p>
        </div>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/vanzari/AddVanzareDialog.tsx">
// src/components/vanzari/AddVanzareDialog.tsx
'use client';

import { useState } from 'react';
import { useForm, useWatch } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import { useMutation, useQueryClient, useQuery } from '@tanstack/react-query';
import { toast } from 'sonner';
import { Plus } from 'lucide-react';

import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';

import { createVanzare, STATUS_PLATA } from '@/lib/supabase/queries/vanzari';
import { getClienti } from '@/lib/supabase/queries/clienti';

// Schema validare cu Zod
const vanzareSchema = z.object({
  data: z.string().min(1, 'Data este obligatorie'),
  client_id: z.string().optional(),
  cantitate_kg: z.string().min(1, 'Cantitatea este obligatorie'),
  pret_lei_kg: z.string().min(1, 'PreÈ›ul este obligatoriu'),
  status_plata: z.string().optional(),
  observatii_ladite: z.string().optional(),
});

type VanzareFormData = z.infer<typeof vanzareSchema>;

interface AddVanzareDialogProps {}

export function AddVanzareDialog({}: AddVanzareDialogProps) {
  const [open, setOpen] = useState(false);
  const queryClient = useQueryClient();

  // Fetch clienti pentru dropdown
  const { data: clienti = [] } = useQuery({
    queryKey: ['clienti'],
    queryFn: () => getClienti(),
  });

  // Form setup
  const {
    register,
    handleSubmit,
    reset,
    control,
    setValue,
    formState: { errors },
  } = useForm<VanzareFormData>({
    resolver: zodResolver(vanzareSchema),
    defaultValues: {
      data: new Date().toISOString().split('T')[0],
      client_id: '',
      cantitate_kg: '',
      pret_lei_kg: '',
      status_plata: 'PlÄƒtit',
      observatii_ladite: '',
    },
  });

  // Watch client selection pentru preÈ› negociat (useWatch -> evitÄƒ warning React Compiler)
  const selectedClientId = useWatch({ control, name: 'client_id' }) ?? '';

  // Auto-populate preÈ› cÃ¢nd se selecteazÄƒ client cu preÈ› negociat
  const handleClientChange = (clientId: string) => {
    setValue('client_id', clientId);

    if (clientId) {
      const client = clienti.find((c) => c.id === clientId);
      if (client && client.pret_negociat_lei_kg) {
        setValue('pret_lei_kg', client.pret_negociat_lei_kg.toString());
      }
    }
  };

  // Mutation pentru creare
  const createMutation = useMutation({
    mutationFn: createVanzare,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['vanzari'] });
      toast.success('VÃ¢nzare adÄƒugatÄƒ cu succes!');
      reset();
      setOpen(false);
    },
    onError: (error) => {
      console.error('Error creating vanzare:', error);
      toast.error('Eroare la adÄƒugarea vÃ¢nzÄƒrii');
    },
  });

  // Submit handler
  const onSubmit = (data: VanzareFormData) => {
    createMutation.mutate({
      data: data.data,
      client_id: data.client_id || undefined,
      cantitate_kg: Number(data.cantitate_kg),
      pret_lei_kg: Number(data.pret_lei_kg),
      status_plata: data.status_plata || 'PlÄƒtit',
      observatii_ladite: data.observatii_ladite || undefined,
    });
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button className="bg-[#F16B6B] hover:bg-[#E05A5A]">
          <Plus className="h-4 w-4 mr-2" />
          AdaugÄƒ VÃ¢nzare
        </Button>
      </DialogTrigger>

      <DialogContent
        className="max-w-md max-h-[75vh] overflow-y-auto"
        style={{ backgroundColor: 'white' }}
      >
        <DialogHeader>
          <DialogTitle>AdaugÄƒ VÃ¢nzare NouÄƒ</DialogTitle>
        </DialogHeader>

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-3">
          {/* Data */}
          <div className="space-y-1">
            <Label htmlFor="data" className="text-sm">
              Data vÃ¢nzÄƒrii <span className="text-red-500">*</span>
            </Label>
            <Input
              id="data"
              type="date"
              {...register('data')}
              className={errors.data ? 'border-red-500' : ''}
            />
            {errors.data && (
              <p className="text-xs text-red-500">{errors.data.message}</p>
            )}
          </div>

          {/* Client (opÈ›ional dar cu auto-preÈ›) */}
          <div className="space-y-1">
            <Label htmlFor="client_id" className="text-sm">Client</Label>
            <select
              id="client_id"
              value={selectedClientId}
              onChange={(e) => handleClientChange(e.target.value)}
              className="flex h-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm"
              style={{ backgroundColor: 'white' }}
            >
              <option value="">FÄƒrÄƒ client specificat</option>
              {clienti.map((client) => (
                <option key={client.id} value={client.id}>
                  {client.id} - {client.nume_client}
                  {client.pret_negociat_lei_kg && ` (${client.pret_negociat_lei_kg} lei/kg)`}
                </option>
              ))}
            </select>
          </div>

          {/* Cantitate È™i PreÈ› */}
          <div className="grid grid-cols-2 gap-3">
            <div className="space-y-1">
              <Label htmlFor="cantitate_kg" className="text-sm">
                Cantitate (kg) <span className="text-red-500">*</span>
              </Label>
              <Input
                id="cantitate_kg"
                type="number"
                step="0.01"
                min="0.01"
                placeholder="50.00"
                {...register('cantitate_kg')}
                className={errors.cantitate_kg ? 'border-red-500' : ''}
              />
              {errors.cantitate_kg && (
                <p className="text-xs text-red-500">
                  {errors.cantitate_kg.message}
                </p>
              )}
            </div>

            <div className="space-y-1">
              <Label htmlFor="pret_lei_kg" className="text-sm">
                PreÈ› lei/kg <span className="text-red-500">*</span>
              </Label>
              <Input
                id="pret_lei_kg"
                type="number"
                step="0.01"
                min="0.01"
                placeholder="25.00"
                {...register('pret_lei_kg')}
                className={errors.pret_lei_kg ? 'border-red-500' : ''}
              />
              {errors.pret_lei_kg && (
                <p className="text-xs text-red-500">
                  {errors.pret_lei_kg.message}
                </p>
              )}
            </div>
          </div>

          {/* Status PlatÄƒ */}
          <div className="space-y-1">
            <Label htmlFor="status_plata" className="text-sm">Status platÄƒ</Label>
            <select
              id="status_plata"
              {...register('status_plata')}
              className="flex h-10 w-full rounded-md border border-gray-300 px-3 py-2 text-sm"
              style={{ backgroundColor: 'white' }}
            >
              {STATUS_PLATA.map((status) => (
                <option key={status} value={status}>
                  {status}
                </option>
              ))}
            </select>
          </div>

          {/* ObservaÈ›ii LÄƒdiÈ›e */}
          <div className="space-y-1">
            <Label htmlFor="observatii_ladite" className="text-sm">ObservaÈ›ii lÄƒdiÈ›e</Label>
            <Textarea
              id="observatii_ladite"
              rows={2}
              placeholder="LÄƒsat 15 lÄƒdiÈ›e, returnat 10"
              {...register('observatii_ladite')}
            />
          </div>

          {/* Butoane */}
          <div className="flex justify-end gap-3 pt-2">
            <Button
              type="button"
              variant="outline"
              onClick={() => {
                reset();
                setOpen(false);
              }}
            >
              AnuleazÄƒ
            </Button>
            <Button
              type="submit"
              disabled={createMutation.isPending}
              className="bg-[#F16B6B] hover:bg-[#E05A5A]"
            >
              {createMutation.isPending ? 'Se salveazÄƒ...' : 'SalveazÄƒ'}
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/lib/supabase/queries/parcele.ts">
import { createClient } from "@/lib/supabase/client"
import type { Tables, Inserts, Updates } from "@/types/supabase"

export type Parcela = Tables<"parcele">
export type ParcelaInsert = Inserts<"parcele">
export type ParcelaUpdate = Updates<"parcele">

// =====================
// GET
// =====================

export async function getParcele(): Promise<Parcela[]> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from("parcele")
    .select("*")
    .order("created_at", { ascending: false })

  if (error) throw error

  return data ?? []
}

// =====================
// CREATE
// =====================

export async function createParcela(
  input: ParcelaInsert
): Promise<Parcela> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from("parcele")
    .insert(input)
    .select("*")
    .single()

  if (error) throw error

  return data
}

// =====================
// UPDATE
// =====================

export async function updateParcela(
  id: string,
  input: ParcelaUpdate
): Promise<Parcela> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from("parcele")
    .update(input)
    .eq("id", id)
    .select("*")
    .single()

  if (error) throw error

  return data
}

// =====================
// DELETE
// =====================

export async function deleteParcela(id: string): Promise<void> {
  const supabase = createClient()

  const { error } = await supabase
    .from("parcele")
    .delete()
    .eq("id", id)

  if (error) throw error
}
</file>

<file path="src/lib/supabase/queries/vanzari-butasi.ts">
// src/lib/supabase/queries/vanzari-butasi.ts

import { createClient } from '../client'

// ===============================
// TYPES
// ===============================

export interface VanzareButasi {
  id: string
  id_vanzare_butasi: string
  data: string

  client_id: string | null
  parcela_sursa_id: string | null

  soi_butasi: string
  cantitate_butasi: number
  pret_unitar_lei: number

  observatii: string | null

  created_at: string
  updated_at: string
}

export interface CreateVanzareButasiInput {
  data: string
  client_id?: string
  parcela_sursa_id?: string
  soi_butasi: string
  cantitate_butasi: number
  pret_unitar_lei: number
  observatii?: string
}

export interface UpdateVanzareButasiInput {
  data?: string
  client_id?: string | null
  parcela_sursa_id?: string | null
  soi_butasi?: string
  cantitate_butasi?: number
  pret_unitar_lei?: number
  observatii?: string | null
}

// ===============================
// GENERATE NEXT ID
// ===============================

async function generateNextId(): Promise<string> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from('vanzari_butasi')
    .select('id_vanzare_butasi')
    .order('created_at', { ascending: false })
    .limit(1)

  if (error) {
    console.error('Error fetching last vanzare butasi ID:', error)
    return 'VB001'
  }

  if (!data || data.length === 0) {
    return 'VB001'
  }

  const lastId = data[0].id_vanzare_butasi
  const numericPart = parseInt(lastId.replace('VB', ''), 10)

  if (isNaN(numericPart)) {
    console.error('Invalid ID format:', lastId)
    return 'VB001'
  }

  const nextNumber = numericPart + 1
  return `VB${nextNumber.toString().padStart(3, '0')}`
}

// ===============================
// GET
// ===============================

export async function getVanzariButasi(): Promise<VanzareButasi[]> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from('vanzari_butasi')
    .select('*')
    .order('data', { ascending: false })

  if (error) throw error

  return data ?? []
}

// ===============================
// CREATE
// ===============================

export async function createVanzareButasi(
  input: CreateVanzareButasiInput
): Promise<VanzareButasi> {
  const supabase = createClient()
  const nextId = await generateNextId()

  const { data, error } = await supabase
    .from('vanzari_butasi')
    .insert({
      id_vanzare_butasi: nextId,
      data: input.data,
      client_id: input.client_id || null,
      parcela_sursa_id: input.parcela_sursa_id || null,
      soi_butasi: input.soi_butasi,
      cantitate_butasi: input.cantitate_butasi,
      pret_unitar_lei: input.pret_unitar_lei,
      observatii: input.observatii || null,
    })
    .select()
    .single()

  if (error) throw error

  return data
}

// ===============================
// UPDATE
// ===============================

export async function updateVanzareButasi(
  id: string,
  input: UpdateVanzareButasiInput
): Promise<VanzareButasi> {
  const supabase = createClient()

  const { data, error } = await supabase
    .from('vanzari_butasi')
    .update({
      ...input,
      updated_at: new Date().toISOString(),
    })
    .eq('id', id)
    .select()
    .single()

  if (error) throw error

  return data
}

// ===============================
// DELETE
// ===============================

export async function deleteVanzareButasi(
  id: string
): Promise<void> {
  const supabase = createClient()

  const { error } = await supabase
    .from('vanzari_butasi')
    .delete()
    .eq('id', id)

  if (error) throw error
}
</file>

</files>
